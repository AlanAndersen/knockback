/*
  knockback-validation.js 0.16.7
  (c) 2011, 2012 Kevin Malakoff - http://kmalakoff.github.com/knockback/
  License: MIT (http://www.opensource.org/licenses/mit-license.php)
  Dependencies: Knockout.js, Backbone.js, and Underscore.js.
*/(function(){return function(e){return typeof define=="function"&&define.amd?define("knockback-validation",["underscore","backbone","knockout","knockback"],e):e.call(this)}(function(){var e,t,n,r,i,s,o,u,a;return o=!this.kb&&typeof require!="undefined"?require("knockback"):this.kb,a=o._,e=o.Backbone,u=o.ko,this.Knockback=this.kb=o,typeof exports!="undefined"&&(module.exports=o),r=/^(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?$/,t=/^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,4}$/,n=/^\s*(\-|\+)?(\d+|(\d*(\.\d*)))\s*$/,s=function(e){return e=u.utils.unwrapObservable(e),typeof e=="function"?e.apply(null,i.call(arguments,1)):e},i=Array.prototype.slice,o.validators={required:function(e){return!e},url:function(e){return!r.test(e)},email:function(e){return!t.test(e)},number:function(e){return!n.test(e)}},o.valueValidator=function(e,t,n){return n==null&&(n={}),n&&typeof n!="function"||(n={}),u.dependentObservable(function(){var r,i,o,f,l,c,h,p;h={error_count:0},i=u.utils.unwrapObservable(e),!n.disable||(o=s(n.disable)),c=n.priorities||[],a.isArray(c)||(c=[c]),r=c.length;for(f in t)p=t[f],h[f]=!o&&s(p,i),h[f]&&(h.error_count++,h.active_error&&c.length&&(l=a.indexOf(c,f))>=0?r<l||(r=l,h.active_error=f):h.active_error||(h.active_error=f));return h.valid=h.error_count===0,h})},o.inputValidator=function(e,t,n){var r,i,s,u,f,l,c,h;return n&&typeof n!="function"||(n={}),r=$(t),(u=r.attr("name"))&&!a.isString(u)&&(u=null),(i=r.attr("data-bind"))?(f=(new Function("sc","with(sc[0]) { return { "+i+" } }"))([e]),!f||!f.value?null:(!f.validation_options||(a.defaults(f.validation_options,n),n=f.validation_options),i={},!o.validators[c=r.attr("type")]||(i[c]=o.validators[c]),!r.attr("required")||(i.required=o.validators.required),!n.disable||(i.disable=n.disable),!f.validations||function(){var e,t;e=f.validations,t=[];for(s in e)h=e[s],t.push(i[s]=h);return t}(),l=o.valueValidator(f.value,i,n),!u&&!n.skip_attach||(e["$"+u]=l),l)):null},o.formValidator=function(e,t){var n,r,i,s,f,l,c,h,p,d,v,m,g;c={error_count:0},d=[],n=$(t),(i=n.attr("name"))&&!a.isString(i)&&(i=null);if(r=n.attr("data-bind"))l=(new Function("sc","with(sc[0]) { return { "+r+" } }"))([e]),h=l.validation_options;h||(h={}),h.skip_attach=!!i,g=n.find("input");for(v=0,m=g.length;v<m;v++){s=g[v];if(!(f=$(s).attr("name")))continue;p=o.inputValidator(e,s,h),!p||d.push(c[f]=p)}return c.valid=u.dependentObservable(function(){var e,t,n;e=!0;for(t=0,n=d.length;t<n;t++)p=d[t],c.error_count+=p().error_count,e&=p().valid;return e}),i&&(e["$"+i]=c),c},o})}).call(this);