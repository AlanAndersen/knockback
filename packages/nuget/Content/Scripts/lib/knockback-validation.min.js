/*
  knockback-validation.js 0.16.7
  (c) 2011, 2012 Kevin Malakoff - http://kmalakoff.github.com/knockback/
  License: MIT (http://www.opensource.org/licenses/mit-license.php)
  Dependencies: Knockout.js, Backbone.js, and Underscore.js.
*/(function(){return function(e){return typeof define=="function"&&define.amd?define("knockback-validation",["underscore","backbone","knockout","knockback"],e):e.call(this)}(function(){var e,t,n,r,i,s,o,u,a;return o=!this.kb&&typeof require!="undefined"?require("knockback"):this.kb,a=o._,e=o.Backbone,u=o.ko,this.Knockback=this.kb=o,typeof exports!="undefined"&&(module.exports=o),r=/^(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?$/,t=/^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,4}$/,n=/^\s*(\-|\+)?(\d+|(\d*(\.\d*)))\s*$/,s=function(e){return e=u.utils.unwrapObservable(e),typeof e=="function"?e.apply(null,i.call(arguments,1)):e},i=Array.prototype.slice,o.validators={required:function(e){return!e},url:function(e){return!r.test(e)},email:function(e){return!t.test(e)},number:function(e){return!n.test(e)}},o.valueValidator=function(e,t){return u.dependentObservable(function(){var n,r,i,o,a;o={error_count:0},n=u.utils.unwrapObservable(e),"disable"in t&&(r=s(t.disable));for(i in t){a=t[i];if(i==="disable")continue;o[i]=!r&&s(a,n),o[i]&&(o.error_count++,o.active_error||(o.active_error=i))}return o.valid=o.error_count===0,o})},o.inputValidator=function(e,t,n){var r,i,s,u,f,l,c,h,p,d,v;r=$(t),(f=r.attr("name"))&&!a.isString(f)&&(f=null),n&&(h=n.skip_attach,s=n.disable);if(!(i=r.attr("data-bind")))return null;l=(new Function("sc","with(sc[0]) { return { "+i+" } }"))([e]);if(!l||!l.value)return null;i={},o.validators[p=r.attr("type")]&&(i[p]=o.validators[p]),r.attr("required")&&(i.required=o.validators.required),s&&(i.disable=s);if(l.validations){v=l.validations;for(u in v)d=v[u],i[u]=d}return c=o.valueValidator(l.value,i),f&&!h&&(e["$"+f]=c),c},o.formValidator=function(e,t){var n,r,i,s,f,l,c,h,p,d,v,m,g;h={error_count:0},d=[],n=$(t),(s=n.attr("name"))&&!a.isString(s)&&(s=null);if(r=n.attr("data-bind"))c=(new Function("sc","with(sc[0]) { return { "+r+" } }"))([e]),c&&c.validations&&c.validations.disable&&(i=c.validations.disable);g=n.find("input");for(v=0,m=g.length;v<m;v++){f=g[v];if(!(l=$(f).attr("name")))continue;p=o.inputValidator(e,f,s?{skip_attach:!0,disable:i}:{disable:i}),!p||d.push(h[l]=p)}return h.valid=u.dependentObservable(function(){var e,t,n;e=!0;for(t=0,n=d.length;t<n;t++)p=d[t],h.error_count+=p().error_count,e&=p().valid;return e}),s&&(e["$"+s]=h),h},o})}).call(this);