/*
 knockback.js 0.15.0
 (c) 2011 Kevin Malakoff.
 Knockback.js is freely distributable under the MIT license.
 See the following for full license details:
 https://github.com/kmalakoff/knockback/blob/master/LICENSE
 Dependencies: Knockout.js, Backbone.js, and Underscore.js.
 Optional dependency: Backbone.ModelRef.js.
*/
var fn,key,_ref;if(!this.ko){throw new Error("Knockback: Dependency alert! Knockout.js must be included before this file")}if(!this.Backbone){throw new Error("Knockback: Dependency alert! Backbone.js must be included before this file")}if(!this._||!this._.VERSION){throw new Error("Knockback: Dependency alert! Underscore.js must be included before this file")}this.Knockback||(this.Knockback={});this.kb||(this.kb=this.Knockback);Knockback.VERSION="0.15.0";Knockback.locale_manager;Knockback.utils={};Knockback.utils.legacyWarning=function(a,c){var b;kb._legacy_warnings||(kb._legacy_warnings={});(b=kb._legacy_warnings)[a]||(b[a]=0);kb._legacy_warnings[a]++;return console.warn("Legacy warning! '"+a+"' has been deprecated. "+c)};Knockback.utils.wrappedObservable=function(a,b){if(arguments.length===1){if(!(a&&a.__kb&&a.__kb.observable)){throw new Error("Knockback: instance is not wrapping an observable")}return a.__kb.observable}if(!a){throw new Error("Knockback: no instance for wrapping a observable")}a.__kb||(a.__kb={});a.__kb.observable=b;return b};Knockback.utils.wrappedModel=function(a,b){if(arguments.length===1){if(a&&a.__kb&&a.__kb.hasOwnProperty("model")){return a.__kb.model}else{return a}}if(!a){throw new Error("Knockback: no instance for wrapping a model")}a.__kb||(a.__kb={});a.__kb.model=b;return b};Knockback.viewModelGetModel=Knockback.vmModel=function(a){kb.utils.legacyWarning("kb.vmModel","Please use kb.utils.wrappedModel instead");return kb.utils.wrappedModel(a)};Knockback.utils.setToDefault=function(d){var b,c,a;if(!d){return}if(ko.isObservable(d)){if(d.setToDefault){return d.setToDefault()}}else{if(_.isObject(d)){a=[];for(b in d){c=d[b];a.push((c&&c.setToDefault?kb.utils.setToDefault(c):void 0))}return a}}};Knockback.vmSetToDefault=function(a){kb.utils.legacyWarning("kb.vmSetToDefault","Please use kb.utils.release instead");return kb.utils.setToDefault(a)};Knockback.utils.release=function(d){var b,c,a;if(ko.isObservable(d)||(d instanceof kb.Observables)||(d instanceof kb.ViewModel_RCBase)){if(d.release){return d.release()}else{if(d.destroy){return d.destroy()}else{if(d.dispose){return d.dispose()}}}}else{if(!_.isFunction(d)){a=[];for(b in d){c=d[b];if(!c||(b==="__kb")){continue}if(!(ko.isObservable(c)||(c instanceof kb.Observables)||(c instanceof kb.ViewModel_RCBase))){continue}d[b]=null;a.push(kb.utils.release(c))}return a}}};Knockback.utils.vmRelease=function(a){kb.utils.legacyWarning("kb.vmRelease","Please use kb.utils.release instead");return kb.utils.release(a)};Knockback.utils.vmReleaseObservable=function(a){kb.utils.legacyWarning("kb.vmReleaseObservable","Please use kb.utils.release instead");return kb.utils.release(a)};_ref=Knockback.utils;for(key in _ref){fn=_ref[key];Knockback[key]=function(){kb.utils.legacyWarning("kb."+key,"Please use kb.utils."+key+" instead");return kb.utils[key].apply(null,arguments)}}var __hasProp=Object.prototype.hasOwnProperty,__extends=function(d,b){for(var a in b){if(__hasProp.call(b,a)){d[a]=b[a]}}function c(){this.constructor=d}c.prototype=b.prototype;d.prototype=new c;d.__super__=b.prototype;return d},__bind=function(a,b){return function(){return a.apply(b,arguments)}};if(!this.Knockback){throw new Error("Knockback: Dependency alert! knockback_core.js must be included before this file")}Knockback.CollectionObservable=(function(){__extends(a,kb.RefCountable);function a(d,b){var c;if(b==null){b={}}if(!d){throw new Error("CollectionObservable: collection is missing")}a.__super__.constructor.apply(this,arguments);if(ko.isObservable(b)&&b.hasOwnProperty("indexOf")){kb.utils.legacyWarning("kb.collectionObservable with an external ko.observableArray","Please use the kb.collectionObservable directly instead of passing a ko.observableArray");c=kb.utils.wrappedObservable(this,b);b=arguments[2]||{}}else{c=kb.utils.wrappedObservable(this,ko.observableArray([]))}this.__kb.store=b.__kb_store||new kb.Store();if(b.__kb_store_key){this.__kb.store.add(b.__kb_store_key,kb.utils.wrappedObservable(this))}if(b.hasOwnProperty("view_model")){this.view_model_create_fn=b.view_model;this.view_model_create_with_new=true}else{if(b.hasOwnProperty("view_model_create")){this.view_model_create_fn=b.view_model_create}}this.sort_attribute=b.sort_attribute;this.sorted_index=b.sorted_index;this.__kb._onCollectionReset=_.bind(this._onCollectionReset,this);this.__kb._onCollectionResort=_.bind(this._onCollectionResort,this);this.__kb._onModelAdd=_.bind(this._onModelAdd,this);this.__kb._onModelRemove=_.bind(this._onModelRemove,this);this.__kb._onModelChange=_.bind(this._onModelChange,this);c.retain=_.bind(this.retain,this);c.refCount=_.bind(this.refCount,this);c.release=_.bind(this.release,this);c.collection=_.bind(this.collection,this);c.viewModelByModel=_.bind(this.viewModelByModel,this);c.sortedIndex=_.bind(this.sortedIndex,this);c.sortAttribute=_.bind(this.sortAttribute,this);c.hasViewModels=_.bind(this.hasViewModels,this);c.bind=_.bind(this.bind,this);c.unbind=_.bind(this.unbind,this);c.trigger=_.bind(this.trigger,this);this.collection(d,{silent:true,defer:b.defer});return c}a.prototype.__destroy=function(){this.collection(null);kb.utils.wrappedObservable(this).destroyAll();kb.utils.wrappedObservable(this,null);this.view_model_create_fn=null;this.__kb.store=null;this.__kb.co=null;return a.__super__.__destroy.apply(this,arguments)};a.prototype.collection=function(b,c){var f,e,d;f=kb.utils.wrappedObservable(this);if(arguments.length===0){f();return this.__kb.collection}if(b===this.__kb.collection){return}if(this.__kb.collection){this._clear();this._collectionUnbind(this.__kb.collection);if(typeof(e=this.__kb.collection).release==="function"){e.release()}this.__kb.collection=null}this.__kb.collection=b;if(this.__kb.collection){if(typeof(d=this.__kb.collection).retain==="function"){d.retain()}this._collectionBind(this.__kb.collection);return this.sortedIndex(this.sorted_index,this.sort_attribute,c)}};a.prototype.sortedIndex=function(e,b,c){var d;if(c==null){c={}}if(e){this.sorted_index=e;this.sort_attribute=b}else{if(b){this.sort_attribute=b;this.sorted_index=this._sortAttributeFn(b)}else{this.sort_attribute=null;this.sorted_index=null}}d=__bind(function(){var f;f=kb.utils.wrappedObservable(this);if((this.__kb.collection.models.length===0)&&(f().length===0)){return}this._collectionResync(true);if(!c.silent){return this.trigger("resort",f())}},this);if(c.defer){_.defer(d)}else{d()}return this};a.prototype.sortAttribute=function(c,d,b){return this.sortedIndex(d,c,b)};a.prototype.viewModelByModel=function(c){var b,d;if(!this.hasViewModels()){return null}d=kb.utils.wrappedObservable(this);b=c.hasOwnProperty(c.idAttribute)?c.idAttribute:"cid";return _.find(d(),function(e){return e.__kb.model[b]===c[b]})};a.prototype.hasViewModels=function(){return !!this.view_model_create_fn};a.prototype._collectionBind=function(h){var e,g,d,c,b,f,i;if(!h){return}h.bind("reset",this.__kb._onCollectionReset);if(!this.sorted_index){h.bind("resort",this.__kb._onCollectionResort)}f=["new","add"];for(g=0,c=f.length;g<c;g++){e=f[g];h.bind(e,this.__kb._onModelAdd)}i=["remove","destroy"];for(d=0,b=i.length;d<b;d++){e=i[d];h.bind(e,this.__kb._onModelRemove)}return h.bind("change",this.__kb._onModelChange)};a.prototype._collectionUnbind=function(h){var e,g,d,c,b,f,i;if(!h){return}h.unbind("reset",this.__kb._onCollectionReset);if(!this.sorted_index){h.unbind("resort",this.__kb._onCollectionResort)}f=["new","add"];for(g=0,c=f.length;g<c;g++){e=f[g];h.unbind(e,this.__kb._onModelAdd)}i=["remove","destroy"];for(d=0,b=i.length;d<b;d++){e=i[d];h.unbind(e,this.__kb._onModelRemove)}return h.unbind("change",this.__kb._onModelChange)};a.prototype._onCollectionReset=function(){return this._collectionResync()};a.prototype._onCollectionResort=function(c){var b;if(this.sorted_index){throw new Error("CollectionObservable: collection sorted_index unexpected")}if(_.isArray(c)){this(true);b=kb.utils.wrappedObservable(this);return this.trigger("resort",b())}else{return this._onModelResort(c)}};a.prototype._onModelAdd=function(c){var b,e,d;d=this.hasViewModels()?this._createTarget(c):c;e=kb.utils.wrappedObservable(this);if(this.sorted_index){b=this.sorted_index(e(),d)}else{b=this.__kb.collection.indexOf(c)}e.splice(b,0,d);return this.trigger("add",d,e())};a.prototype._onModelRemove=function(b){var d,c;c=this.hasViewModels()?this.viewModelByModel(b):b;if(!c){return}d=kb.utils.wrappedObservable(this);d.remove(c);this.trigger("remove",c,d);if(!this.hasViewModels()){return}kb.utils.release(c);return kb.utils.wrappedModel(c,null)};a.prototype._onModelChange=function(b){if(this.sorted_index&&(!this.sort_attribute||b.hasChanged(this.sort_attribute))){this._onModelResort(b)}return kb.utils.wrappedObservable(this).valueHasMutated()};a.prototype._onModelResort=function(c){var b,f,e,g,d;f=kb.utils.wrappedObservable(this);d=this.hasViewModels()?this.viewModelByModel(c):c;e=f.indexOf(d);if(this.sorted_index){g=_.clone(f());g.splice(e,1);b=this.sorted_index(g,d)}else{b=this.__kb.collection.indexOf(c)}if(e===b){return}f.splice(e,1);f.splice(b,0,d);return this.trigger("resort",d,f(),b)};a.prototype._clear=function(f){var h,d,e,g,c,b;h=kb.utils.wrappedObservable(this);if(!f){this.trigger("remove",h())}d=h.removeAll();if(!this.hasViewModels()){return}b=[];for(g=0,c=d.length;g<c;g++){e=d[g];b.push(kb.utils.release(e))}return b};a.prototype._collectionResync=function(i){var c,f,b,h,g,d,j,e;this._clear(i);b=kb.utils.wrappedObservable(this);if(this.sorted_index){g=[];e=this.__kb.collection.models;for(d=0,j=e.length;d<j;d++){f=e[d];h=this._createTarget(f);c=this.sorted_index(g,h);g.splice(c,0,h)}}else{g=this.hasViewModels()?_.map(this.__kb.collection.models,__bind(function(k){return this._createTarget(k)},this)):_.clone(this.__kb.collection.models)}b(g);if(!i){return this.trigger("add",b())}};a.prototype._sortAttributeFn=function(b){if(this.hasViewModels()){return function(d,c){return _.sortedIndex(d,c,function(e){return kb.utils.wrappedModel(e).get(b)})}}else{return function(d,c){return _.sortedIndex(d,c,function(e){return e.get(b)})}}};a.prototype._createTarget=function(b){if(!this.view_model_create_fn){return b}return this.__kb.store.resolve(b,__bind(function(){var c;c=this.view_model_create_with_new?new this.view_model_create_fn(b,{__kb_store:this.__kb.store,__kb_store_key:b}):this.view_model_create_fn(b,{__kb_store:this.__kb.store});kb.utils.wrappedModel(c,b);return c},this))};return a})();__extends(Knockback.CollectionObservable.prototype,Backbone.Events);Knockback.collectionObservable=function(c,b,a){return new Knockback.CollectionObservable(c,b,a)};Knockback.sortedIndexWrapAttr=Knockback.siwa=function(a,b){return function(d,c){return _.sortedIndex(d,c,function(e){return new b(kb.utils.wrappedModel(e).get(a))})}};var __bind=function(a,b){return function(){return a.apply(b,arguments)}};if(!this.Knockback){throw new Error("Knockback: Dependency alert! knockback_core.js must be included before this file")}Knockback.defaultWrapper=function(a,c){var b;b=ko.dependentObservable({read:__bind(function(){var d,e;e=ko.utils.unwrapObservable(a());d=ko.utils.unwrapObservable(c);if(e){return e}else{return d}},this),write:function(d){return a(d)}});b.setToDefault=function(){return b(c)};return b};if(!this.Knockback){throw new Error("Knockback: Dependency alert! knockback_core.js must be included before this file")}Knockback.toFormattedString=function(g){var b,e,d,c,a,f;a=g.slice();e=Array.prototype.slice.call(arguments,1);for(d in e){b=e[d];f=ko.utils.unwrapObservable(b);if(!f){f=""}c=g.indexOf("{"+d+"}");while(c>=0){a=a.replace("{"+d+"}",f);c=g.indexOf("{"+d+"}",c+1)}}return a};Knockback.parseFormattedString=function(h,m){var i,a,j,k,g,p,o,f,l,b,e,n,d,c;b=m.slice();j=0;p=0;f={};while(b.search("\\{"+j+"\\}")>=0){o=m.indexOf("{"+j+"}");while(o>=0){b=b.replace("{"+j+"}","(.*)");f[o]=j;p++;o=m.indexOf("{"+j+"}",o+1)}j++}i=j;l=new RegExp(b);g=l.exec(h);if(g){g.shift()}if(!g||(g.length!==p)){return _.map((function(){c=[];for(var q=1;1<=i?q<=i:q>=i;1<=i?q++:q--){c.push(q)}return c}).apply(this),function(){return""})}n=_.sortBy(_.keys(f),function(q,r){return parseInt(q,10)});a={};for(k in n){o=n[k];j=f[o];if(a.hasOwnProperty(j)){continue}a[j]=k}e=[];j=0;while(j<i){e.push(g[a[j]]);j++}return e};Knockback.formattedObservable=function(d,c){var b,a;b=Array.prototype.slice.call(arguments,1);a=ko.dependentObservable({read:function(){var e,g,f;c=[ko.utils.unwrapObservable(d)];for(g=0,f=b.length;g<f;g++){e=b[g];c.push(ko.utils.unwrapObservable(e))}return kb.toFormattedString.apply(null,c)},write:function(h){var f,g,i,e;g=kb.parseFormattedString(h,ko.utils.unwrapObservable(d));i=Math.min(b.length,g.length);f=0;e=[];while(f<i){b[f](g[f]);e.push(f++)}return e}});return a};if(!this.Knockback){throw new Error("Knockback: Dependency alert! knockback_core.js must be included before this file")}Knockback.LocalizedObservable=(function(){function a(d,c,b){var e;this.value=d;this.options=c!=null?c:{};this.view_model=b!=null?b:{};if(!(this.options.read||this.read)){throw new Error("LocalizedObservable: options.read is missing")}if(this.options.read&&this.read){throw new Error("LocalizedObservable: options.read and read class function exist. You need to choose one.")}if(this.options.write&&this.write){throw new Error("LocalizedObservable: options.write and write class function exist. You need to choose one.")}if(!kb.locale_manager){throw new Error("LocalizedObservable: Knockback.locale_manager is not defined")}this.__kb={};this.__kb._onLocaleChange=_.bind(this._onLocaleChange,this);this.__kb.read=this.options.read?this.options.read:this.read;this.__kb.write=this.options.write?this.options.write:this.write;this.__kb["default"]=this.options["default"]?this.options["default"]:this["default"];if(this.value){d=ko.utils.unwrapObservable(this.value)}this.__kb.value_observable=ko.observable(!d?this._getDefaultValue():this.__kb.read.call(this,d,null));if(this.__kb.write&&!_.isFunction(this.__kb.write)){throw new Error("LocalizedObservable: options.write is not a function for read_write model attribute")}e=kb.utils.wrappedObservable(this,ko.dependentObservable({read:_.bind(this._onGetValue,this),write:this.__kb.write?_.bind(this._onSetValue,this):(function(){throw new Error("Knockback.LocalizedObservable: value is read only")}),owner:this.view_model}));e.destroy=_.bind(this.destroy,this);e.observedValue=_.bind(this.observedValue,this);e.setToDefault=_.bind(this.setToDefault,this);e.resetToCurrent=_.bind(this.resetToCurrent,this);kb.locale_manager.bind("change",this.__kb._onLocaleChange);return e}a.prototype.destroy=function(){kb.locale_manager.unbind("change",this.__kb._onLocaleChange);this.__kb.value_observable=null;kb.utils.wrappedObservable(this).dispose();kb.utils.wrappedObservable(this,null);this.options={};this.view_model=null;return this.__kb=null};a.prototype.setToDefault=function(){var c,b;if(!this.__kb["default"]){return}b=this._getDefaultValue();c=this.__kb.value_observable();if(c!==b){return this._onSetValue(b)}else{return this.__kb.value_observable.valueHasMutated()}};a.prototype.resetToCurrent=function(){this.__kb.value_observable(null);return this._onSetValue(this._getCurrentValue())};a.prototype.observedValue=function(b){if(arguments.length===0){return this.value}this.value=b;this._onLocaleChange();return this};a.prototype._getDefaultValue=function(){if(!this.__kb["default"]){return""}if(_.isFunction(this.__kb["default"])){return this.__kb["default"]()}else{return this.__kb["default"]}};a.prototype._getCurrentValue=function(){var b;b=kb.utils.wrappedObservable(this);if(!(this.value&&b)){return this._getDefaultValue()}return this.__kb.read.call(this,ko.utils.unwrapObservable(this.value))};a.prototype._onGetValue=function(){if(this.value){ko.utils.unwrapObservable(this.value)}return this.__kb.value_observable()};a.prototype._onSetValue=function(b){this.__kb.write.call(this,b,ko.utils.unwrapObservable(this.value));b=this.__kb.read.call(this,ko.utils.unwrapObservable(this.value));this.__kb.value_observable(b);if(this.options.onChange){return this.options.onChange(b)}};a.prototype._onLocaleChange=function(){var b;b=this.__kb.read.call(this,ko.utils.unwrapObservable(this.value));this.__kb.value_observable(b);if(this.options.onChange){return this.options.onChange(b)}};return a})();Knockback.localizedObservable=function(c,b,a){return new Knockback.LocalizedObservable(c,b,a)};if(!this.Knockback){throw new Error("Knockback: Dependency alert! knockback_core.js must be included before this file")}Knockback.Observable=(function(){function a(d,c,b){var e;this.model=d;this.options=c;this.view_model=b!=null?b:{};if(!this.model){throw new Error("Observable: model is missing")}if(!this.options){throw new Error("Observable: options is missing")}if(_.isString(this.options)||ko.isObservable(this.options)){this.options={key:this.options}}if(!this.options.key){throw new Error("Observable: options.key is missing")}this.__kb={};this.__kb._onModelChange=_.bind(this._onModelChange,this);this.__kb._onModelLoaded=_.bind(this._onModelLoaded,this);this.__kb._onModelUnloaded=_.bind(this._onModelUnloaded,this);if(Backbone.ModelRef&&(this.model instanceof Backbone.ModelRef)){this.model_ref=this.model;this.model_ref.retain();this.model_ref.bind("loaded",this.__kb._onModelLoaded);this.model_ref.bind("unloaded",this.__kb._onModelUnloaded);this.model=this.model_ref.wrappedModel()}this.__kb.value_observable=ko.observable();if(this.options.localizer){this.__kb.localizer=new this.options.localizer(this._getCurrentValue())}e=kb.utils.wrappedObservable(this,ko.dependentObservable({read:_.bind(this._onGetValue,this),write:this.options.write?_.bind(this._onSetValue,this):(function(){throw new Error("Knockback.Observable: "+this.options.key+" is read only")}),owner:this.view_model}));e.destroy=_.bind(this.destroy,this);e.setToDefault=_.bind(this.setToDefault,this);if(!this.model_ref||this.model_ref.isLoaded()){this.model.bind("change",this.__kb._onModelChange)}return e}a.prototype.destroy=function(){this.__kb.value_observable=null;kb.utils.wrappedObservable(this).dispose();kb.utils.wrappedObservable(this,null);if(this.model){this.__kb._onModelUnloaded(this.model)}if(this.model_ref){this.model_ref.unbind("loaded",this.__kb._onModelLoaded);this.model_ref.unbind("unloaded",this.__kb._onModelUnloaded);this.model_ref.release();this.model_ref=null}this.options=null;this.view_model=null;return this.__kb=null};a.prototype.setToDefault=function(){var b;b=this._getDefaultValue();if(this.__kb.localizer){this.__kb.localizer.observedValue(b);b=this.__kb.localizer()}return this.__kb.value_observable(b)};a.prototype._getDefaultValue=function(){if(!this.options.hasOwnProperty("default")){return""}if(_.isFunction(this.options["default"])){return this.options["default"]()}else{return this.options["default"]}};a.prototype._getCurrentValue=function(){var b,d,e,g,c,f;if(!this.model){return this._getDefaultValue()}e=ko.utils.unwrapObservable(this.options.key);d=[e];if(!_.isUndefined(this.options.args)){if(_.isArray(this.options.args)){f=this.options.args;for(g=0,c=f.length;g<c;g++){b=f[g];d.push(ko.utils.unwrapObservable(b))}}else{d.push(ko.utils.unwrapObservable(this.options.args))}}if(this.options.read){return this.options.read.apply(this.view_model,d)}else{return this.model.get.apply(this.model,d)}};a.prototype._onGetValue=function(){var b,f,e,c,d;this.__kb.value_observable();ko.utils.unwrapObservable(this.options.key);if(!_.isUndefined(this.options.args)){if(_.isArray(this.options.args)){d=this.options.args;for(e=0,c=d.length;e<c;e++){b=d[e];ko.utils.unwrapObservable(b)}}else{ko.utils.unwrapObservable(this.options.args)}}f=this._getCurrentValue();if(this.__kb.localizer){this.__kb.localizer.observedValue(f);f=this.__kb.localizer()}return f};a.prototype._onSetValue=function(h){var b,e,d,g,c,f;if(this.__kb.localizer){this.__kb.localizer(h);h=this.__kb.localizer.observedValue()}if(this.model){d={};d[ko.utils.unwrapObservable(this.options.key)]=h;e=_.isFunction(this.options.write)?[h]:[d];if(!_.isUndefined(this.options.args)){if(_.isArray(this.options.args)){f=this.options.args;for(g=0,c=f.length;g<c;g++){b=f[g];e.push(ko.utils.unwrapObservable(b))}}else{e.push(ko.utils.unwrapObservable(this.options.args))}}if(_.isFunction(this.options.write)){this.options.write.apply(this.view_model,e)}else{this.model.set.apply(this.model,e)}}if(this.__kb.localizer){return this.__kb.value_observable(this.__kb.localizer())}else{return this.__kb.value_observable(h)}};a.prototype._modelBind=function(b){if(!b){return}b.bind("change",this.__kb._onModelChange);if(Backbone.RelationalModel&&(b instanceof Backbone.RelationalModel)){b.bind("add",this.__kb._onModelChange);b.bind("remove",this.__kb._onModelChange);return b.bind("update",this.__kb._onModelChange)}};a.prototype._modelUnbind=function(b){if(!b){return}b.unbind("change",this.__kb._onModelChange);if(Backbone.RelationalModel&&(b instanceof Backbone.RelationalModel)){b.unbind("add",this.__kb._onModelChange);b.unbind("remove",this.__kb._onModelChange);return b.unbind("update",this.__kb._onModelChange)}};a.prototype._onModelLoaded=function(b){this.model=b;this._modelBind(b);return this._updateValue()};a.prototype._onModelUnloaded=function(b){if(this.__kb.localizer&&this.__kb.localizer.destroy){this.__kb.localizer.destroy();this.__kb.localizer=null}this._modelUnbind(b);return this.model=null};a.prototype._onModelChange=function(){if((this.model&&this.model.hasChanged)&&!this.model.hasChanged(ko.utils.unwrapObservable(this.options.key))){return}return this._updateValue()};a.prototype._updateValue=function(){var b;b=this._getCurrentValue();if(this.__kb.localizer){this.__kb.localizer.observedValue(b);b=this.__kb.localizer()}return this.__kb.value_observable(b)};return a})();Knockback.observable=function(c,b,a){return new Knockback.Observable(c,b,a)};if(!this.Knockback){throw new Error("Knockback: Dependency alert! knockback_core.js must be included before this file")}Knockback.Observables=(function(){function a(e,f,k,d){var g,h,i,j,c,b;this.model=e;this.mappings_info=f;this.view_model=k;if(!this.model){throw new Error("Observables: model is missing")}if(!this.mappings_info){throw new Error("Observables: mappings_info is missing")}if(!!d&&((_.isBoolean(d)&&d)||!!d.write)){j=_.isBoolean(d)?d:!!d.write;c=this.mappings_info;for(i in c){h=c[i];g=_.isString(h);if(g||!h.hasOwnProperty(j)){h=g?{key:h,write:j}:_.extend({write:j},h)}this.view_model[i]=kb.observable(this.model,h,this.view_model)}}else{b=this.mappings_info;for(i in b){h=b[i];this.view_model[i]=kb.observable(this.model,h,this.view_model)}}}a.prototype.destroy=function(){var b,d,c;c=this.mappings_info;for(d in c){b=c[d];if(this.view_model[d]){this.view_model[d].destroy()}this.view_model[d]=null}this.view_model=null;this.mappings_info=null;return this.model=null};a.prototype.setToDefault=function(){var c,e,d,b;d=this.mappings_info;b=[];for(e in d){c=d[e];b.push(this.view_model[e].setToDefault())}return b};return a})();Knockback.observables=function(c,d,a,b){return new Knockback.Observables(c,d,a,b)};if(!this.Knockback){throw new Error("Knockback: Dependency alert! knockback_core.js must be included before this file")}Knockback.TriggeredObservable=(function(){function a(b,d){var c;this.model=b;this.event_name=d;if(!this.model){throw new Error("Observable: model is missing")}if(!this.event_name){throw new Error("Observable: event_name is missing")}this.__kb={};this.__kb._onValueChange=_.bind(this._onValueChange,this);this.__kb._onModelLoaded=_.bind(this._onModelLoaded,this);this.__kb._onModelUnloaded=_.bind(this._onModelUnloaded,this);if(Backbone.ModelRef&&(this.model instanceof Backbone.ModelRef)){this.model_ref=this.model;this.model_ref.retain();this.model_ref.bind("loaded",this.__kb._onModelLoaded);this.model_ref.bind("unloaded",this.__kb._onModelUnloaded);this.model=this.model_ref.wrappedModel()}this.__kb.value_observable=ko.observable();c=kb.utils.wrappedObservable(this,ko.dependentObservable(_.bind(this._onGetValue,this)));c.destroy=_.bind(this.destroy,this);if(!this.model_ref||this.model_ref.isLoaded()){this._onModelLoaded(this.model)}return c}a.prototype.destroy=function(){kb.utils.wrappedObservable(this).dispose();kb.utils.wrappedObservable(this,null);this.__kb.value_observable=null;if(this.model){this._onModelUnloaded(this.model)}if(this.model_ref){this.model_ref.unbind("loaded",this.__kb._onModelLoaded);this.model_ref.unbind("unloaded",this.__kb._onModelUnloaded);this.model_ref.release();this.model_ref=null}this.options=null;this.view_model=null;return this.__kb=null};a.prototype._onGetValue=function(){return this.__kb.value_observable()};a.prototype._onModelLoaded=function(b){this.model=b;this.model.bind(this.event_name,this.__kb._onValueChange);return this._onValueChange()};a.prototype._onModelUnloaded=function(){if(this.__kb.localizer&&this.__kb.localizer.destroy){this.__kb.localizer.destroy();this.__kb.localizer=null}this.model.unbind(this.event_name,this.__kb._onValueChange);return this.model=null};a.prototype._onValueChange=function(){var b;b=this.__kb.value_observable();if(b!==this.model){return this.__kb.value_observable(this.model)}else{return this.__kb.value_observable.valueHasMutated()}};return a})();Knockback.triggeredObservable=function(a,b){return new Knockback.TriggeredObservable(a,b)};var __hasProp=Object.prototype.hasOwnProperty,__extends=function(d,b){for(var a in b){if(__hasProp.call(b,a)){d[a]=b[a]}}function c(){this.constructor=d}c.prototype=b.prototype;d.prototype=new c;d.__super__=b.prototype;return d};if(!this.Knockback){throw new Error("Knockback: Dependency alert! knockback_core.js must be included before this file")}Knockback.ViewModel_RCBase=(function(){__extends(a,Knockback.RefCountable);function a(){a.__super__.constructor.apply(this,arguments)}a.prototype.__destroy=function(){var b,c;for(b in this){c=this[b];if(!c||(b==="__kb")){continue}if(!(ko.isObservable(c)||(c instanceof kb.Observables)||(c instanceof kb.ViewModel_RCBase))){continue}this[b]=null;kb.utils.release(c)}return a.__super__.__destroy.apply(this,arguments)};return a})();Knockback.ViewModel=(function(){__extends(a,Knockback.ViewModel_RCBase);function a(d,c){var f,e,g,b;if(c==null){c={}}a.__super__.constructor.apply(this,arguments);this.__kb.store=c.__kb_store||new kb.Store();if(c.__kb_store_key){this.__kb.store.add(c.__kb_store_key,this)}this.__kb._onModelChange=_.bind(this._onModelChange,this);this.__kb._onModelLoaded=_.bind(this._onModelLoaded,this);this.__kb._onModelUnloaded=_.bind(this._onModelUnloaded,this);this.__kb.internals=c.internals;this.__kb.requires=c.requires;this.__kb.read_only=c.read_only;this.__kb.children=c.children;if(!d){throw new Error("ViewModel: model is missing")}kb.utils.wrappedModel(this,d);if(Backbone.ModelRef&&(d instanceof Backbone.ModelRef)){this.__kb.model_ref=d;this.__kb.model_ref.retain();kb.utils.wrappedModel(this,this.__kb.model_ref.wrappedModel());this.__kb.model_ref.bind("loaded",this.__kb._onModelLoaded);this.__kb.model_ref.bind("unloaded",this.__kb._onModelUnloaded)}if(!this.__kb.model_ref||this.__kb.model_ref.isLoaded()){this._onModelLoaded(this.__kb.model)}if(!this.__kb.internals&&!this.__kb.requires){return this}e=_.union((this.__kb.internals?this.__kb.internals:[]),(this.__kb.requires?this.__kb.requires:[]));if(!this.__kb.model_ref||this.__kb.model_ref.isLoaded()){e=_.difference(e,_.keys(this.__kb.model.attributes))}for(g=0,b=e.length;g<b;g++){f=e[g];this._updateAttributeConnector(this.__kb.model,f)}}a.prototype.__destroy=function(){var b;b=this.__kb.model;kb.utils.wrappedModel(this,null);this._modelUnbind(b);this.__kb.store=null;return a.__super__.__destroy.apply(this,arguments)};a.prototype.model=function(b){var c;c=kb.utils.wrappedModel(this);if(arguments.length===0){return c}if(b===c){return}if(c){this._onModelUnloaded(c)}if(b){return this._onModelLoaded(b)}};a.prototype._modelBind=function(b){if(!b){return}b.bind("change",this.__kb._onModelChange);if(Backbone.RelationalModel&&(b instanceof Backbone.RelationalModel)){b.bind("add",this.__kb._onModelChange);b.bind("remove",this.__kb._onModelChange);return b.bind("update",this.__kb._onModelChange)}};a.prototype._modelUnbind=function(b){if(!b){return}b.unbind("change",this.__kb._onModelChange);if(Backbone.RelationalModel&&(b instanceof Backbone.RelationalModel)){b.unbind("add",this.__kb._onModelChange);b.unbind("remove",this.__kb._onModelChange);return b.unbind("update",this.__kb._onModelChange)}};a.prototype._onModelLoaded=function(c){var d,b;kb.utils.wrappedModel(this,c);this._modelBind(c);b=[];for(d in this.__kb.model.attributes){b.push(this._updateAttributeConnector(this.__kb.model,d))}return b};a.prototype._onModelUnloaded=function(c){var d,b;this._modelUnbind(c);kb.utils.wrappedModel(this,null);b=[];for(d in c.attributes){b.push(this._updateAttributeConnector(null,d))}return b};a.prototype._onModelChange=function(){var d,b,c;if(this.__kb.model._changed){b=[];for(d in this.__kb.model.attributes){b.push((this.__kb.model.hasChanged(d)?this._updateAttributeConnector(this.__kb.model,d):void 0))}return b}else{if(this.__kb.model.changed){c=[];for(d in this.__kb.model.changed){c.push(this._updateAttributeConnector(this.__kb.model,d))}return c}}};a.prototype._updateAttributeConnector=function(b,d){var f,e,c;c=this.__kb.internals&&_.contains(this.__kb.internals,d)?"_"+d:d;e=b?b.get(d):null;if(this.hasOwnProperty(c)){f=this[c];if(!f){throw new Error("Knockback.ViewModel: property '"+c+"' has been unexpectedly removed")}if(f.model()!==b){return f.model(b)}else{return f.update()}}else{if(e instanceof Backbone.Collection){return this[c]=kb.collectionAttributeConnector(b,d,{__kb_store:this.__kb.store,__kb_store_key:e,view_model:this.constructor})}else{if((e instanceof Backbone.Model)||(Backbone.ModelRef&&(e instanceof Backbone.ModelRef))){return this[c]=kb.viewModelAttributeConnector(b,d,{view_model:this.constructor,options:{__kb_store:this.__kb.store,__kb_store_key:e}})}else{return this[c]=kb.simpleAttributeConnector(b,d,{read_only:this.__kb.read_only})}}}};return a})();Knockback.viewModel=function(b,a){return new Knockback.ViewModel(b,a)};