/*
 knockback.js 0.15.0
 (c) 2011 Kevin Malakoff.
 Knockback.js is freely distributable under the MIT license.
 See the following for full license details:
 https://github.com/kmalakoff/knockback/blob/master/LICENSE
 Dependencies: Knockout.js, Backbone.js, and Underscore.js.
 Optional dependency: Backbone.ModelRef.js.
*/
if(!this.ko){throw new Error("Knockback: Dependency alert! Knockout.js must be included before this file")}if(!this.Backbone){throw new Error("Knockback: Dependency alert! Backbone.js must be included before this file")}if(!this._||!this._.VERSION){throw new Error("Knockback: Dependency alert! Underscore.js must be included before this file")}this.Knockback||(this.Knockback={});this.kb||(this.kb=this.Knockback);Knockback.VERSION="0.15.0";Knockback.locale_manager;Knockback.legacyWarning=function(a,c){var b;kb._legacy_warnings||(kb._legacy_warnings={});(b=kb._legacy_warnings)[a]||(b[a]=0);kb._legacy_warnings[a]++;return console.warn("Legacy warning! '"+a+"' has been deprecated. "+c)};Knockback.unwrapObservable=function(a){if(!(a&&a.__kb.observable)){throw new Error("Knockback: instance is not wrapping an observable")}return a.__kb.observable};Knockback.wrappedObservable=function(a){kb.legacyWarning("kb.wrappedObservable","Please use kb.unwrapObservable instead");return kb.unwrapObservable(a)};Knockback.unwrapModel=function(a){if(a&&a.hasOwnProperty("__kb_model")){return a.__kb_model}else{return a}};Knockback.viewModelGetModel=Knockback.vmModel=function(a){kb.legacyWarning("kb.vmModel","Please use kb.unwrapModel instead");return kb.unwrapModel(a)};Knockback.setToDefault=function(a){if(a&&a.setToDefault){return a.setToDefault()}};Knockback.vmSetToDefault=function(b){var c,d,a;a=[];for(c in b){d=b[c];a.push(kb.setToDefault(d))}return a};Knockback.vmRelease=function(a){if(a instanceof kb.ViewModel_RCBase){a.release();return}return Knockback.vmReleaseObservables(a)};Knockback.vmReleaseObservables=function(b,d){var c,e,a;a=[];for(c in b){e=b[c];if(!e){continue}if(!(ko.isObservable(e)||(e instanceof kb.Observables)||(e instanceof kb.ViewModel_RCBase))){continue}if(d&&!_.contains(d,c)){continue}b[c]=null;a.push(kb.vmReleaseObservable(e))}return a};Knockback.vmReleaseObservable=function(a){if(!(ko.isObservable(a)||(a instanceof kb.Observables)||(a instanceof kb.ViewModel_RCBase))){return}if(a.release){return a.release()}else{if(a.destroy){return a.destroy()}else{if(a.dispose){return a.dispose()}}}};var __hasProp=Object.prototype.hasOwnProperty,__extends=function(d,b){for(var a in b){if(__hasProp.call(b,a)){d[a]=b[a]}}function c(){this.constructor=d}c.prototype=b.prototype;d.prototype=new c;d.__super__=b.prototype;return d},__bind=function(a,b){return function(){return a.apply(b,arguments)}};if(!this.Knockback){throw new Error("Knockback: Dependency alert! knockback_core.js must be included before this file")}Knockback.CollectionObservable=(function(){__extends(a,kb.RefCountable);function a(h,j){var b,f,e,i,c,g,d;if(j==null){j={}}if(!h){throw new Error("CollectionObservable: collection is missing")}a.__super__.constructor.apply(this,arguments);if(ko.isObservable(j)&&j.hasOwnProperty("indexOf")){Knockback.legacyWarning("kb.collectionObservable with an external ko.observableArray","Please use the kb.collectionObservable directly instead of passing a ko.observableArray");this.__kb.observable=j;j=arguments[2]||{}}else{this.__kb.observable=ko.observableArray([])}this.__kb.store=j.__kb_store||new kb.Store();if(j.__kb_store_key){this.__kb.store.add(j.__kb_store_key,kb.unwrapObservable(this))}if(j.hasOwnProperty("view_model")||j.hasOwnProperty("view_model_constructor")){this.view_model_create_fn=j.view_model||j.view_model_constructor;this.view_model_create_with_new=true}else{if(j.hasOwnProperty("view_model_create")){this.view_model_create_fn=j.view_model_create}}this.sort_attribute=j.sort_attribute;this.sorted_index=j.sorted_index;this.__kb._onCollectionReset=_.bind(this._onCollectionReset,this);this.__kb._onCollectionResort=_.bind(this._onCollectionResort,this);this.__kb._onModelAdd=_.bind(this._onModelAdd,this);this.__kb._onModelRemove=_.bind(this._onModelRemove,this);this.__kb._onModelChanged=_.bind(this._onModelChanged,this);this.__kb.collection=h;if(this.__kb.collection.retain){this.__kb.collection.retain()}this.__kb.collection.bind("reset",this.__kb._onCollectionReset);if(!this.sorted_index){this.__kb.collection.bind("resort",this.__kb._onCollectionResort)}g=["new","add"];for(f=0,i=g.length;f<i;f++){b=g[f];this.__kb.collection.bind(b,this.__kb._onModelAdd)}d=["remove","destroy"];for(e=0,c=d.length;e<c;e++){b=d[e];this.__kb.collection.bind(b,this.__kb._onModelRemove)}this.__kb.collection.bind("change",this.__kb._onModelChanged);this.__kb.observable.release=_.bind(this.release,this);this.__kb.observable.collection=_.bind(this.collection,this);this.__kb.observable.viewModelByModel=_.bind(this.viewModelByModel,this);this.__kb.observable.sortedIndex=_.bind(this.sortedIndex,this);this.__kb.observable.sortAttribute=_.bind(this.sortAttribute,this);this.__kb.observable.hasViewModels=_.bind(this.hasViewModels,this);this.__kb.observable.bind=_.bind(this.bind,this);this.__kb.observable.unbind=_.bind(this.unbind,this);this.__kb.observable.trigger=_.bind(this.trigger,this);this.sortedIndex(this.sorted_index,this.sort_attribute,{silent:true,defer:j.defer});return kb.unwrapObservable(this)}a.prototype.__destroy=function(){var e,g,d,c,b,f,h;this._clear();this.__kb.collection.unbind("reset",this.__kb._onCollectionReset);if(!this.sorted_index){this.__kb.collection.unbind("resort",this.__kb._onCollectionResort)}f=["new","add"];for(g=0,c=f.length;g<c;g++){e=f[g];this.__kb.collection.unbind(e,this.__kb._onModelAdd)}h=["remove","destroy"];for(d=0,b=h.length;d<b;d++){e=h[d];this.__kb.collection.unbind(e,this.__kb._onModelRemove)}this.__kb.collection.unbind("change",this.__kb._onModelChanged);if(this.__kb.collection.release){this.__kb.collection.release()}this.__kb.collection=null;this.__kb.observable.dispose();this.__kb.observable=null;this.view_model_create_fn=null;this.__kb.store=null;this.__kb.co=null;return a.__super__.__destroy.apply(this,arguments)};a.prototype.collection=function(){this.__kb.observable();return this.__kb.collection};a.prototype.sortedIndex=function(e,b,c){var d;if(c==null){c={}}if(e){this.sorted_index=e;this.sort_attribute=b}else{if(b){this.sort_attribute=b;this.sorted_index=this._sortAttributeFn(b)}else{this.sort_attribute=null;this.sorted_index=null}}d=__bind(function(){if((this.__kb.collection.models.length===0)&&(this.__kb.observable().length===0)){return}this._collectionResync(true);if(!c.silent){return this.trigger("resort",this.__kb.observable())}},this);if(c.defer){_.defer(d)}else{d()}return this};a.prototype.sortAttribute=function(c,d,b){return this.sortedIndex(d,c,b)};a.prototype.viewModelByModel=function(c){var b;if(!this.hasViewModels()){return null}b=c.hasOwnProperty(c.idAttribute)?c.idAttribute:"cid";return _.find(this.__kb.observable(),function(d){return d.__kb_model[b]===c[b]})};a.prototype.hasViewModels=function(){return !!this.view_model_create_fn};a.prototype._onCollectionReset=function(){return this._collectionResync()};a.prototype._onCollectionResort=function(b){if(this.sorted_index){throw new Error("CollectionObservable: collection sorted_index unexpected")}if(_.isArray(b)){this(true);return this.trigger("resort",this.__kb.observable())}else{return this._onModelResort(b)}};a.prototype._onModelAdd=function(c){var b,d;d=this.hasViewModels()?this._createTarget(c):c;if(this.sorted_index){b=this.sorted_index(this.__kb.observable(),d)}else{b=this.__kb.collection.indexOf(c)}this.__kb.observable.splice(b,0,d);return this.trigger("add",d,this.__kb.observable())};a.prototype._onModelRemove=function(b){var c;c=this.hasViewModels()?this.viewModelByModel(b):b;if(!c){return}this.__kb.observable.remove(c);this.trigger("remove",c,this.__kb.observable());if(!this.hasViewModels()){return}kb.vmRelease(c);return c.__kb_model=null};a.prototype._onModelChanged=function(b){if(this.sorted_index&&(!this.sort_attribute||b.hasChanged(this.sort_attribute))){this._onModelResort(b)}return this.__kb.observable.valueHasMutated()};a.prototype._onModelResort=function(c){var b,e,f,d;d=this.hasViewModels()?this.viewModelByModel(c):c;e=this.__kb.observable.indexOf(d);if(this.sorted_index){f=_.clone(this.__kb.observable());f.splice(e,1);b=this.sorted_index(f,d)}else{b=this.__kb.collection.indexOf(c)}if(e===b){return}this.__kb.observable.splice(e,1);this.__kb.observable.splice(b,0,d);return this.trigger("resort",d,this.__kb.observable(),b)};a.prototype._clear=function(f){var d,e,g,c,b;if(!f){this.trigger("remove",this.__kb.observable())}d=this.__kb.observable.removeAll();if(!this.hasViewModels()){return}b=[];for(g=0,c=d.length;g<c;g++){e=d[g];b.push(kb.vmRelease(e))}return b};a.prototype._collectionResync=function(e){var d,f,i,c,h,b,g;this._clear(e);if(this.sorted_index){c=[];g=this.__kb.collection.models;for(h=0,b=g.length;h<b;h++){f=g[h];i=this._createTarget(f);d=this.sorted_index(c,i);c.splice(d,0,i)}}else{c=this.hasViewModels()?_.map(this.__kb.collection.models,__bind(function(j){return this._createTarget(j)},this)):_.clone(this.__kb.collection.models)}this.__kb.observable(c);if(!e){return this.trigger("add",this.__kb.observable())}};a.prototype._sortAttributeFn=function(b){if(this.hasViewModels()){return function(d,c){return _.sortedIndex(d,c,function(e){return kb.unwrapModel(e).get(b)})}}else{return function(d,c){return _.sortedIndex(d,c,function(e){return e.get(b)})}}};a.prototype._createTarget=function(b){if(!this.view_model_create_fn){return b}return this.__kb.store.resolve(b,__bind(function(){var c;c=this.view_model_create_with_new?new this.view_model_create_fn(b,{__kb_store:this.__kb.store,__kb_store_key:b}):this.view_model_create_fn(b,{__kb_store:this.__kb.store});c.__kb_model=b;return c},this))};return a})();__extends(Knockback.CollectionObservable.prototype,Backbone.Events);Knockback.collectionObservable=function(c,b,a){return new Knockback.CollectionObservable(c,b,a)};Knockback.sortedIndexWrapAttr=Knockback.siwa=function(a,b){return function(d,c){return _.sortedIndex(d,c,function(e){return new b(kb.unwrapModel(e).get(a))})}};var __bind=function(a,b){return function(){return a.apply(b,arguments)}};if(!this.Knockback){throw new Error("Knockback: Dependency alert! knockback_core.js must be included before this file")}Knockback.DefaultWrapper=(function(){function a(c,b){this.default_value=b;this.__kb={};this.__kb.observable=ko.dependentObservable({read:__bind(function(){var d;d=ko.utils.unwrapObservable(c());if(!d){return ko.utils.unwrapObservable(this.default_value)}else{return d}},this),write:function(d){return c(d)}});this.__kb.observable.destroy=_.bind(this.destroy,this);this.__kb.observable.setToDefault=_.bind(this.setToDefault,this);return kb.unwrapObservable(this)}a.prototype.destroy=function(){this.__kb.observable=null;return this.default_value=null};a.prototype.setToDefault=function(){return this.__kb.observable(this.default_value)};return a})();Knockback.defaultWrapper=function(b,a){return new Knockback.DefaultWrapper(b,a)};if(!this.Knockback){throw new Error("Knockback: Dependency alert! knockback_core.js must be included before this file")}Knockback.toFormattedString=function(g){var b,e,d,c,a,f;a=g.slice();e=Array.prototype.slice.call(arguments,1);for(d in e){b=e[d];f=ko.utils.unwrapObservable(b);if(!f){f=""}c=g.indexOf("{"+d+"}");while(c>=0){a=a.replace("{"+d+"}",f);c=g.indexOf("{"+d+"}",c+1)}}return a};Knockback.parseFormattedString=function(h,m){var i,a,j,k,g,p,o,f,l,b,e,n,d,c;b=m.slice();j=0;p=0;f={};while(b.search("\\{"+j+"\\}")>=0){o=m.indexOf("{"+j+"}");while(o>=0){b=b.replace("{"+j+"}","(.*)");f[o]=j;p++;o=m.indexOf("{"+j+"}",o+1)}j++}i=j;l=new RegExp(b);g=l.exec(h);if(g){g.shift()}if(!g||(g.length!==p)){return _.map((function(){c=[];for(var q=1;1<=i?q<=i:q>=i;1<=i?q++:q--){c.push(q)}return c}).apply(this),function(){return""})}n=_.sortBy(_.keys(f),function(q,r){return parseInt(q,10)});a={};for(k in n){o=n[k];j=f[o];if(a.hasOwnProperty(j)){continue}a[j]=k}e=[];j=0;while(j<i){e.push(g[a[j]]);j++}return e};Knockback.formattedObservable=function(d,c){var b,a;b=Array.prototype.slice.call(arguments,1);a=ko.dependentObservable({read:function(){var e,g,f;c=[ko.utils.unwrapObservable(d)];for(g=0,f=b.length;g<f;g++){e=b[g];c.push(ko.utils.unwrapObservable(e))}return kb.toFormattedString.apply(null,c)},write:function(h){var f,g,i,e;g=kb.parseFormattedString(h,ko.utils.unwrapObservable(d));i=Math.min(b.length,g.length);f=0;e=[];while(f<i){b[f](g[f]);e.push(f++)}return e}});return a};if(!this.Knockback){throw new Error("Knockback: Dependency alert! knockback_core.js must be included before this file")}Knockback.LocalizedObservable=(function(){function a(d,c,b){this.value=d;this.options=c!=null?c:{};this.view_model=b!=null?b:{};if(!(this.options.read||this.read)){throw new Error("LocalizedObservable: options.read is missing")}if(this.options.read&&this.read){throw new Error("LocalizedObservable: options.read and read class function exist. You need to choose one.")}if(this.options.write&&this.write){throw new Error("LocalizedObservable: options.write and write class function exist. You need to choose one.")}if(!kb.locale_manager){throw new Error("LocalizedObservable: Knockback.locale_manager is not defined")}this.__kb={};this.__kb._onLocaleChange=_.bind(this._onLocaleChange,this);this.__kb.read=this.options.read?this.options.read:this.read;this.__kb.write=this.options.write?this.options.write:this.write;this.__kb["default"]=this.options["default"]?this.options["default"]:this["default"];if(this.value){d=ko.utils.unwrapObservable(this.value)}this.__kb.value_observable=ko.observable(!d?this._getDefaultValue():this.__kb.read.call(this,d,null));if(this.__kb.write&&!_.isFunction(this.__kb.write)){throw new Error("LocalizedObservable: options.write is not a function for read_write model attribute")}this.__kb.observable=ko.dependentObservable({read:_.bind(this._onGetValue,this),write:this.__kb.write?_.bind(this._onSetValue,this):(function(){throw new Error("Knockback.LocalizedObservable: value is read only")}),owner:this.view_model});this.__kb.observable.destroy=_.bind(this.destroy,this);this.__kb.observable.observedValue=_.bind(this.observedValue,this);this.__kb.observable.setToDefault=_.bind(this.setToDefault,this);this.__kb.observable.resetToCurrent=_.bind(this.resetToCurrent,this);kb.locale_manager.bind("change",this.__kb._onLocaleChange);return kb.unwrapObservable(this)}a.prototype.destroy=function(){kb.locale_manager.unbind("change",this.__kb._onLocaleChange);this.__kb.value_observable=null;this.__kb.observable.dispose();this.__kb.observable=null;this.options={};this.view_model=null;return this.__kb=null};a.prototype.setToDefault=function(){var c,b;if(!this.__kb["default"]){return}b=this._getDefaultValue();c=this.__kb.value_observable();if(c!==b){return this._onSetValue(b)}else{return this.__kb.value_observable.valueHasMutated()}};a.prototype.resetToCurrent=function(){this.__kb.value_observable(null);return this._onSetValue(this._getCurrentValue())};a.prototype.observedValue=function(b){if(arguments.length===0){return this.value}this.value=b;this._onLocaleChange();return this};a.prototype._getDefaultValue=function(){if(!this.__kb["default"]){return""}if(_.isFunction(this.__kb["default"])){return this.__kb["default"]()}else{return this.__kb["default"]}};a.prototype._getCurrentValue=function(){if(!(this.value&&this.__kb.observable)){return this._getDefaultValue()}return this.__kb.read.call(this,ko.utils.unwrapObservable(this.value),this.__kb.observable)};a.prototype._onGetValue=function(){if(this.value){ko.utils.unwrapObservable(this.value)}return this.__kb.value_observable()};a.prototype._onSetValue=function(b){this.__kb.write.call(this,b,ko.utils.unwrapObservable(this.value),this.__kb.observable);b=this.__kb.read.call(this,ko.utils.unwrapObservable(this.value),this.__kb.observable);this.__kb.value_observable(b);if(this.options.onChange){return this.options.onChange(b)}};a.prototype._onLocaleChange=function(){var b;b=this.__kb.read.call(this,ko.utils.unwrapObservable(this.value),this.__kb.observable);this.__kb.value_observable(b);if(this.options.onChange){return this.options.onChange(b)}};return a})();Knockback.localizedObservable=function(c,b,a){return new Knockback.LocalizedObservable(c,b,a)};if(!this.Knockback){throw new Error("Knockback: Dependency alert! knockback_core.js must be included before this file")}Knockback.Observable=(function(){function a(d,c,b){this.model=d;this.options=c;this.view_model=b!=null?b:{};if(!this.model){throw new Error("Observable: model is missing")}if(!this.options){throw new Error("Observable: options is missing")}if(_.isString(this.options)||ko.isObservable(this.options)){this.options={key:this.options}}if(!this.options.key){throw new Error("Observable: options.key is missing")}this.__kb={};this.__kb._onModelChange=_.bind(this._onModelChange,this);this.__kb._onModelLoaded=_.bind(this._onModelLoaded,this);this.__kb._onModelUnloaded=_.bind(this._onModelUnloaded,this);if(Backbone.ModelRef&&(this.model instanceof Backbone.ModelRef)){this.model_ref=this.model;this.model_ref.retain();this.model_ref.bind("loaded",this.__kb._onModelLoaded);this.model_ref.bind("unloaded",this.__kb._onModelUnloaded);this.model=this.model_ref.getModel()}this.__kb.value_observable=ko.observable();if(this.options.localizer){this.__kb.localizer=new this.options.localizer(this._getCurrentValue())}this.__kb.observable=ko.dependentObservable({read:_.bind(this._onGetValue,this),write:this.options.write?_.bind(this._onSetValue,this):(function(){throw new Error("Knockback.Observable: "+this.options.key+" is read only")}),owner:this.view_model});this.__kb.observable.destroy=_.bind(this.destroy,this);this.__kb.observable.setToDefault=_.bind(this.setToDefault,this);if(!this.model_ref||this.model_ref.isLoaded()){this.model.bind("change",this.__kb._onModelChange)}return kb.unwrapObservable(this)}a.prototype.destroy=function(){this.__kb.value_observable=null;this.__kb.observable.dispose();this.__kb.observable=null;if(this.model){this.__kb._onModelUnloaded(this.model)}if(this.model_ref){this.model_ref.unbind("loaded",this.__kb._onModelLoaded);this.model_ref.unbind("unloaded",this.__kb._onModelUnloaded);this.model_ref.release();this.model_ref=null}this.options=null;this.view_model=null;return this.__kb=null};a.prototype.setToDefault=function(){var b;b=this._getDefaultValue();if(this.__kb.localizer){this.__kb.localizer.observedValue(b);b=this.__kb.localizer()}return this.__kb.value_observable(b)};a.prototype._getDefaultValue=function(){if(!this.options.hasOwnProperty("default")){return""}if(_.isFunction(this.options["default"])){return this.options["default"]()}else{return this.options["default"]}};a.prototype._getCurrentValue=function(){var b,d,e,g,c,f;if(!this.model){return this._getDefaultValue()}e=ko.utils.unwrapObservable(this.options.key);d=[e];if(!_.isUndefined(this.options.args)){if(_.isArray(this.options.args)){f=this.options.args;for(g=0,c=f.length;g<c;g++){b=f[g];d.push(ko.utils.unwrapObservable(b))}}else{d.push(ko.utils.unwrapObservable(this.options.args))}}if(this.options.read){return this.options.read.apply(this.view_model,d)}else{return this.model.get.apply(this.model,d)}};a.prototype._onGetValue=function(){var b,f,e,c,d;this.__kb.value_observable();ko.utils.unwrapObservable(this.options.key);if(!_.isUndefined(this.options.args)){if(_.isArray(this.options.args)){d=this.options.args;for(e=0,c=d.length;e<c;e++){b=d[e];ko.utils.unwrapObservable(b)}}else{ko.utils.unwrapObservable(this.options.args)}}f=this._getCurrentValue();if(this.__kb.localizer){this.__kb.localizer.observedValue(f);f=this.__kb.localizer()}return f};a.prototype._onSetValue=function(h){var b,e,d,g,c,f;if(this.__kb.localizer){this.__kb.localizer(h);h=this.__kb.localizer.observedValue()}if(this.model){d={};d[ko.utils.unwrapObservable(this.options.key)]=h;e=_.isFunction(this.options.write)?[h]:[d];if(!_.isUndefined(this.options.args)){if(_.isArray(this.options.args)){f=this.options.args;for(g=0,c=f.length;g<c;g++){b=f[g];e.push(ko.utils.unwrapObservable(b))}}else{e.push(ko.utils.unwrapObservable(this.options.args))}}if(_.isFunction(this.options.write)){this.options.write.apply(this.view_model,e)}else{this.model.set.apply(this.model,e)}}if(this.__kb.localizer){return this.__kb.value_observable(this.__kb.localizer())}else{return this.__kb.value_observable(h)}};a.prototype._onModelLoaded=function(b){this.model=b;this.model.bind("change",this.__kb._onModelChange);return this._updateValue()};a.prototype._onModelUnloaded=function(b){if(this.__kb.localizer&&this.__kb.localizer.destroy){this.__kb.localizer.destroy();this.__kb.localizer=null}this.model.unbind("change",this.__kb._onModelChange);return this.model=null};a.prototype._onModelChange=function(){if((this.model&&this.model.hasChanged)&&!this.model.hasChanged(ko.utils.unwrapObservable(this.options.key))){return}return this._updateValue()};a.prototype._updateValue=function(){var b;b=this._getCurrentValue();if(this.__kb.localizer){this.__kb.localizer.observedValue(b);b=this.__kb.localizer()}return this.__kb.value_observable(b)};return a})();Knockback.observable=function(c,b,a){return new Knockback.Observable(c,b,a)};if(!this.Knockback){throw new Error("Knockback: Dependency alert! knockback_core.js must be included before this file")}Knockback.Observables=(function(){function a(e,f,k,d){var g,h,i,j,c,b;this.model=e;this.mappings_info=f;this.view_model=k;if(!this.model){throw new Error("Observables: model is missing")}if(!this.mappings_info){throw new Error("Observables: mappings_info is missing")}if(!!d&&((_.isBoolean(d)&&d)||!!d.write)){j=_.isBoolean(d)?d:!!d.write;c=this.mappings_info;for(i in c){h=c[i];g=_.isString(h);if(g||!h.hasOwnProperty(j)){h=g?{key:h,write:j}:_.extend({write:j},h)}this.view_model[i]=kb.observable(this.model,h,this.view_model)}}else{b=this.mappings_info;for(i in b){h=b[i];this.view_model[i]=kb.observable(this.model,h,this.view_model)}}}a.prototype.destroy=function(){var b,d,c;c=this.mappings_info;for(d in c){b=c[d];if(this.view_model[d]){this.view_model[d].destroy()}this.view_model[d]=null}this.view_model=null;this.mappings_info=null;return this.model=null};a.prototype.setToDefault=function(){var c,e,d,b;d=this.mappings_info;b=[];for(e in d){c=d[e];b.push(this.view_model[e].setToDefault())}return b};return a})();Knockback.observables=function(c,d,a,b){return new Knockback.Observables(c,d,a,b)};if(!this.Knockback){throw new Error("Knockback: Dependency alert! knockback_core.js must be included before this file")}Knockback.TriggeredObservable=(function(){function a(b,c){this.model=b;this.event_name=c;if(!this.model){throw new Error("Observable: model is missing")}if(!this.event_name){throw new Error("Observable: event_name is missing")}this.__kb={};this.__kb._onValueChange=_.bind(this._onValueChange,this);this.__kb._onModelLoaded=_.bind(this._onModelLoaded,this);this.__kb._onModelUnloaded=_.bind(this._onModelUnloaded,this);if(Backbone.ModelRef&&(this.model instanceof Backbone.ModelRef)){this.model_ref=this.model;this.model_ref.retain();this.model_ref.bind("loaded",this.__kb._onModelLoaded);this.model_ref.bind("unloaded",this.__kb._onModelUnloaded);this.model=this.model_ref.getModel()}this.__kb.value_observable=ko.observable();this.__kb.observable=ko.dependentObservable(_.bind(this._onGetValue,this));this.__kb.observable.destroy=_.bind(this.destroy,this);if(!this.model_ref||this.model_ref.isLoaded()){this._onModelLoaded(this.model)}return kb.unwrapObservable(this)}a.prototype.destroy=function(){this.__kb.observable.dispose();this.__kb.observable=null;this.__kb.value_observable=null;if(this.model){this._onModelUnloaded(this.model)}if(this.model_ref){this.model_ref.unbind("loaded",this.__kb._onModelLoaded);this.model_ref.unbind("unloaded",this.__kb._onModelUnloaded);this.model_ref.release();this.model_ref=null}this.options=null;this.view_model=null;return this.__kb=null};a.prototype._onGetValue=function(){return this.__kb.value_observable()};a.prototype._onModelLoaded=function(b){this.model=b;this.model.bind(this.event_name,this.__kb._onValueChange);return this._onValueChange()};a.prototype._onModelUnloaded=function(){if(this.__kb.localizer&&this.__kb.localizer.destroy){this.__kb.localizer.destroy();this.__kb.localizer=null}this.model.unbind(this.event_name,this.__kb._onValueChange);return this.model=null};a.prototype._onValueChange=function(){var b;b=this.__kb.value_observable();if(b!==this.model){return this.__kb.value_observable(this.model)}else{return this.__kb.value_observable.valueHasMutated()}};return a})();Knockback.triggeredObservable=function(a,b){return new Knockback.TriggeredObservable(a,b)};var AttributeConnector;var __bind=function(a,b){return function(){return a.apply(b,arguments)}},__hasProp=Object.prototype.hasOwnProperty,__extends=function(d,b){for(var a in b){if(__hasProp.call(b,a)){d[a]=b[a]}}function c(){this.constructor=d}c.prototype=b.prototype;d.prototype=new c;d.__super__=b.prototype;return d};if(!this.Knockback){throw new Error("Knockback: Dependency alert! knockback_core.js must be included before this file")}AttributeConnector=(function(){function a(b,c,d){this.key=c;this.read_only=d;this.__kb={};this.__kb.observable=ko.observable();this.__kb.observable.subscription=this.__kb.observable.subscribe(__bind(function(f){var e;if(this.read_only){if(this.model){f=this.model.get(this.key);if(this.__kb.observable()===f){return}this.__kb.observable(f)}throw"Cannot write a value to a dependentObservable unless you specify a 'write' option. If you wish to read the current value, don't pass any parameters."}else{if(this.model){e={};e[this.key]=f;return this.model.set(e)}}},this));this.__kb.observable.destroy=_.bind(this.destroy,this);this.__kb.observable.update=_.bind(this.update,this);this.update(b);return kb.unwrapObservable(this)}a.prototype.destroy=function(){this.model=null;return this.__kb.observable=null};a.prototype.update=function(b){var c,d;if(b){d=b.get(this.key);c=(this.model!==b)||!_.isEqual(this.__kb.observable(),d);this.model=b;if(c){return this.__kb.observable(d)}}else{return this.model=null}};return a})();Knockback.ViewModel_RCBase=(function(){__extends(a,Knockback.RefCountable);function a(){a.__super__.constructor.apply(this,arguments)}a.prototype.__destroy=function(){kb.vmReleaseObservables(this);return a.__super__.__destroy.apply(this,arguments)};return a})();Knockback.ViewModel=(function(){__extends(a,Knockback.ViewModel_RCBase);function a(e,d,c){var g,f,h,b;if(d==null){d={}}a.__super__.constructor.apply(this,arguments);this.__kb.store=d.__kb_store||new kb.Store();if(d.__kb_store_key){this.__kb.store.add(d.__kb_store_key,this)}this.__kb._onModelChange=_.bind(this._onModelChange,this);this.__kb._onModelLoaded=_.bind(this._onModelLoaded,this);this.__kb._onModelUnloaded=_.bind(this._onModelUnloaded,this);this.__kb.model=e;this.__kb.internals=d.internals;this.__kb.requires=d.requires;this.__kb.read_only=d.read_only;this.__kb.view_model=c;if(!this.__kb.model){throw new Error("ViewModel: model is missing")}if(!this.__kb.view_model){this.__kb.view_model=this}else{this.__kb.observables=[]}if(Backbone.ModelRef&&(this.__kb.model instanceof Backbone.ModelRef)){this.__kb.model_ref=this.__kb.model;this.__kb.model_ref.retain();this.__kb.model=this.__kb.model_ref.getModel();this.__kb.model_ref.bind("loaded",this.__kb._onModelLoaded);this.__kb.model_ref.bind("unloaded",this.__kb._onModelUnloaded)}if(!this.__kb.model_ref||this.__kb.model_ref.isLoaded()){this._onModelLoaded(this.__kb.model)}if(!this.__kb.internals&&!this.__kb.requires){return this}f=_.union((this.__kb.internals?this.__kb.internals:[]),(this.__kb.requires?this.__kb.requires:[]));if(!this.__kb.model_ref||this.__kb.model_ref.isLoaded()){f=_.difference(f,_.keys(this.__kb.model.attributes))}for(h=0,b=f.length;h<b;h++){g=f[h];this._updateAttributeObservor(this.__kb.model,g)}}a.prototype.__destroy=function(){var b;if(this.__kb.model){this.__kb.model.unbind("change",this.__kb._onModelChange);this.__kb.model=null}b=this.__kb.view_model;this.__kb.view_model=null;kb.vmReleaseObservables(b,this.__kb.observables);this.__kb.store=null;this.__kb.vm=null;return a.__super__.__destroy.apply(this,arguments)};a.prototype._onModelLoaded=function(c){var d,b;this.__kb.model=c;this.__kb.model.bind("change",this.__kb._onModelChange);b=[];for(d in this.__kb.model.attributes){b.push(this._updateAttributeObservor(this.__kb.model,d))}return b};a.prototype._onModelUnloaded=function(c){var d,b;this.__kb.model.unbind("change",this.__kb._onModelChange);c=this.__kb.model;this.__kb.model=null;b=[];for(d in c.attributes){b.push(this._updateAttributeObservor(this.__kb.model,d))}return b};a.prototype._onModelChange=function(){var d,b,c;if(this.__kb.model._changed){b=[];for(d in this.__kb.model.attributes){b.push((this.__kb.model.hasChanged(d)?this._updateAttributeObservor(this.__kb.model,d):void 0))}return b}else{if(this.__kb.model.changed){c=[];for(d in this.__kb.model.changed){c.push(this._updateAttributeObservor(this.__kb.model,d))}return c}}};a.prototype._updateAttributeObservor=function(b,d){var e,c;c=this.__kb.internals&&_.contains(this.__kb.internals,d)?"_"+d:d;if(this.__kb.view_model.hasOwnProperty(c)){if(!this.__kb.view_model[c]){throw new Error("Knockback.ViewModel: property '"+c+"' has been unexpectedly removed")}if(this.__kb.view_model[c].update){return this.__kb.view_model[c].update(b)}}else{if(this.__kb.observables){this.__kb.observables.push(c)}e=b?b.get(d):null;if((e instanceof Backbone.Collection)||(e instanceof Backbone.Model)){return this.__kb.view_model[c]=this.__kb.store.resolve(e,__bind(function(){if(e instanceof Backbone.Collection){return kb.collectionObservable(e,{view_model_constructor:this.constructor,__kb_store:this.__kb.store,__kb_store_key:e})}else{return new this.constructor(e,{__kb_store:this.__kb.store,__kb_store_key:e})}},this))}else{return this.__kb.view_model[c]=new AttributeConnector(b,d,this.__kb.read_only)}}};return a})();Knockback.viewModel=function(c,b,a){return new Knockback.ViewModel(c,b,a)};