/*
  knockback-validation.js 0.16.7
  (c) 2011, 2012 Kevin Malakoff - http://kmalakoff.github.com/knockback/
  License: MIT (http://www.opensource.org/licenses/mit-license.php)
  Dependencies: Knockout.js, Backbone.js, and Underscore.js.
*/(function(){return function(e){return typeof define=="function"&&define.amd?define("knockback-validation",["underscore","backbone","knockout","knockback"],e):e.call(this)}(function(){var e,t,n,r,i,s,o,u;return s=!this.kb&&typeof require!="undefined"?require("knockback"):this.kb,u=s._,e=s.Backbone,o=s.ko,this.Knockback=this.kb=s,typeof exports!="undefined"&&(module.exports=s),i=function(e){return e=o.utils.unwrapObservable(e),typeof e=="function"?e.apply(null,Array.prototype.slice.call(arguments,1)):e},s.Validation=function(){function e(){}return e.valueValidator=function(e,t,n){return n==null&&(n={}),n&&typeof n!="function"||(n={}),o.dependentObservable(function(){var r,s,a,f,l,c,h,p;h={error_count:0},s=o.utils.unwrapObservable(e),!n.disable||(a=i(n.disable)),c=n.priorities||[],u.isArray(c)||(c=[c]),r=c.length;for(f in t)p=t[f],h[f]=!a&&i(p,s),h[f]&&(h.error_count++,h.active_error&&c.length&&(l=u.indexOf(c,f))>=0?r<l||(r=l,h.active_error=f):h.active_error||(h.active_error=f));return h.valid=h.error_count===0,h})},e.inputValidator=function(e,t,n){var r,i,o,a,f,l,c,h,p;return n&&typeof n!="function"||(n={}),p=s.valid,r=$(t),(a=r.attr("name"))&&!u.isString(a)&&(a=null),(i=r.attr("data-bind"))?(f=(new Function("sc","with(sc[0]) { return { "+i+" } }"))([e]),!f||!f.value?null:(!f.validation_options||(u.defaults(f.validation_options,n),n=f.validation_options),i={},!p[c=r.attr("type")]||(i[c]=p[c]),!r.attr("required")||(i.required=p.required),!n.disable||(i.disable=n.disable),!f.validations||function(){var e,t;e=f.validations,t=[];for(o in e)h=e[o],t.push(i[o]=h);return t}(),l=s.valueValidator(f.value,i,n),!a&&!n.no_attach||(e["$"+a]=l),l)):null},e.formValidator=function(e,t){var n,r,i,a,f,l,c,h,p,d,v,m,g;c={error_count:0},d=[],n=$(t),(i=n.attr("name"))&&!u.isString(i)&&(i=null);if(r=n.attr("data-bind"))l=(new Function("sc","with(sc[0]) { return { "+r+" } }"))([e]),h=l.validation_options;h||(h={}),h.no_attach=!!i,g=n.find("input");for(v=0,m=g.length;v<m;v++){a=g[v];if(!(f=$(a).attr("name")))continue;p=s.inputValidator(e,a,h),!p||d.push(c[f]=p)}return c.valid=o.dependentObservable(function(){var e,t,n;e=!0;for(t=0,n=d.length;t<n;t++)p=d[t],c.error_count+=p().error_count,e&=p().valid;return e}),i&&(e["$"+i]=c),c},e}(),s.valueValidator=s.Validation.valueValidator,s.inputValidator=s.Validation.inputValidator,s.formValidator=s.Validation.formValidator,r=/^(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?$/,t=/^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,4}$/,n=/^\s*(\-|\+)?(\d+|(\d*(\.\d*)))\s*$/,s.valid={required:function(e){return!e},url:function(e){return!r.test(e)},email:function(e){return!t.test(e)},number:function(e){return!n.test(e)}},s})}).call(this);