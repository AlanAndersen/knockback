/*
  knockback-validation.js 0.16.7
  (c) 2011, 2012 Kevin Malakoff - http://kmalakoff.github.com/knockback/
  License: MIT (http://www.opensource.org/licenses/mit-license.php)
  Dependencies: Knockout.js, Backbone.js, and Underscore.js.
*/(function(){return function(e){return typeof define=="function"&&define.amd?define("knockback-validation",["underscore","backbone","knockout","knockback"],e):e.call(this)}(function(){var e,t,n,r,i,s,o,u,a;return s=!this.kb&&typeof require!="undefined"?require("knockback"):this.kb,u=s._,e=s.Backbone,o=s.ko,this.Knockback=this.kb=s,typeof exports!="undefined"&&(module.exports=s),a=o.utils.unwrapObservable,i=function(e){return e=a(e),typeof e=="function"?e.apply(null,Array.prototype.slice.call(arguments,1)):e},s.Validation=function(){function e(){}return e}(),s.valueValidator=function(e,t,n){return n==null&&(n={}),n&&typeof n!="function"||(n={}),o.dependentObservable(function(){var r,s,o,f,l,c,h,p;h={$error_count:0},s=a(e),!("disable"in n)||(o=i(n.disable)),!("enable"in n)||(o=!i(n.enable)),c=n.priorities||[],u.isArray(c)||(c=[c]),r=c.length+1;for(f in t)p=t[f],h[f]=!o&&i(p,s),h[f]&&(h.$error_count++,(l=u.indexOf(c,f)>=0)||(l=c.length),h.$active_error&&l<r?(h.$active_error=f,r=l):h.$active_error||(h.$active_error=f,r=l));return h.$enabled=!o,h.$disable=!!o,h.$valid=h.$error_count===0,h})},s.inputValidator=function(e,t,n){var r,i,o,a,f,l,c,h,p;return n==null&&(n={}),n&&typeof n!="function"||(n={}),p=s.valid,r=$(t),(a=r.attr("name"))&&!u.isString(a)&&(a=null),(i=r.attr("data-bind"))?(f=(new Function("sc","with(sc[0]) { return { "+i+" } }"))([e]),!f||!f.value?null:(!f.validation_options||(u.defaults(f.validation_options,n),n=f.validation_options),i={},!p[c=r.attr("type")]||(i[c]=p[c]),!r.attr("required")||(i.required=p.required),!f.validations||function(){var e,t;e=f.validations,t=[];for(o in e)h=e[o],t.push(i[o]=h);return t}(),l=s.valueValidator(f.value,i,n),!a&&!n.no_attach||(e["$"+a]=l),l)):null},s.formValidator=function(e,t){var n,r,i,a,f,l,c,h,p,d,v,m,g;c={},d=[],n=$(t),(i=n.attr("name"))&&!u.isString(i)&&(i=null);if(r=n.attr("data-bind"))l=(new Function("sc","with(sc[0]) { return { "+r+" } }"))([e]),h=l.validation_options;h||(h={}),h.no_attach=!!i,g=n.find("input");for(v=0,m=g.length;v<m;v++){a=g[v];if(!(f=$(a).attr("name")))continue;p=s.inputValidator(e,a,h),!p||d.push(c[f]=p)}return c.$error_count=o.dependentObservable(function(){var e,t,n;e=0;for(t=0,n=d.length;t<n;t++)p=d[t],e+=p().$error_count;return e}),c.$valid=o.dependentObservable(function(){return c.$error_count()===0}),c.$enabled=o.dependentObservable(function(){var e,t,n;e=!0;for(t=0,n=d.length;t<n;t++)p=d[t],e&=p().$enabled;return e}),c.$disabled=o.dependentObservable(function(){return!c.$enabled()}),i&&(e["$"+i]=c),c},r=/^(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?$/,t=/^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,4}$/,n=/^\s*(\-|\+)?(\d+|(\d*(\.\d*)))\s*$/,s.valid={required:function(e){return!e},url:function(e){return!r.test(e)},email:function(e){return!t.test(e)},number:function(e){return!n.test(e)}},s.hasChangedFn=function(e){var t,n;return n=null,t=null,function(){var r;return n!==(r=a(e))?(n=r,t=n?n.toJSON():null,!1):!n||!t?!1:!u.isEqual(n.toJSON(),t)}},s.minLengthFn=function(e){return function(t){return!t||t.length<e}},s.uniqueValueFn=function(e,t,n){return function(r){var i,s,o,f=this;return o=a(e),s=a(t),i=a(n),o&&s&&i?!!u.find(i.models,function(e){return e!==o&&e.get(s)===r}):!1}},s.untilTrueFn=function(e,t,n){var r;return r=!1,n&&o.isObservable(n)&&n.subscribe(function(){return r=!1}),function(n){var i,s;return(i=a(t))?(r|=!!(s=i(a(n))),r?s:a(e)):a(e)}},s.untilFalseFn=function(e,t,n){var r;return r=!1,n&&o.isObservable(n)&&n.subscribe(function(){return r=!1}),function(n){var i,s;return(i=a(t))?(r|=!(s=i(a(n))),r?s:a(e)):a(e)}},s})}).call(this);