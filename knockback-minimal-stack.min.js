//     Underscore.js 1.3.3
//     (c) 2009-2012 Jeremy Ashkenas, DocumentCloud Inc.
//     Underscore is freely distributable under the MIT license.
//     Portions of Underscore are inspired or borrowed from Prototype,
//     Oliver Steele's Functional, and John Resig's Micro-Templating.
//     For all details and documentation:
//     http://documentcloud.github.com/underscore
(function(){function C(e,t,n){if(e===t)return e!==0||1/e==1/t;if(e==null||t==null)return e===t;e._chain&&(e=e._wrapped),t._chain&&(t=t._wrapped);if(e.isEqual&&S.isFunction(e.isEqual))return e.isEqual(t);if(t.isEqual&&S.isFunction(t.isEqual))return t.isEqual(e);var r=a.call(e);if(r!=a.call(t))return!1;switch(r){case"[object String]":return e==String(t);case"[object Number]":return e!=+e?t!=+t:e==0?1/e==1/t:e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object RegExp]":return e.source==t.source&&e.global==t.global&&e.multiline==t.multiline&&e.ignoreCase==t.ignoreCase}if(typeof e!="object"||typeof t!="object")return!1;var i=n.length;while(i--)if(n[i]==e)return!0;n.push(e);var s=0,o=!0;if(r=="[object Array]"){s=e.length,o=s==t.length;if(o)while(s--)if(!(o=s in e==s in t&&C(e[s],t[s],n)))break}else{if("constructor"in e!="constructor"in t||e.constructor!=t.constructor)return!1;for(var u in e)if(S.has(e,u)){s++;if(!(o=S.has(t,u)&&C(e[u],t[u],n)))break}if(o){for(u in t)if(S.has(t,u)&&!(s--))break;o=!s}}return n.pop(),o}var e=this,t=e._,n={},r=Array.prototype,i=Object.prototype,s=Function.prototype,o=r.slice,u=r.unshift,a=i.toString,f=i.hasOwnProperty,l=r.forEach,c=r.map,h=r.reduce,p=r.reduceRight,d=r.filter,v=r.every,m=r.some,g=r.indexOf,y=r.lastIndexOf,b=Array.isArray,w=Object.keys,E=s.bind,S=function(e){return new L(e)};typeof exports!="undefined"?(typeof module!="undefined"&&module.exports&&(exports=module.exports=S),exports._=S):e._=S,S.VERSION="1.3.3";var x=S.each=S.forEach=function(e,t,r){if(e==null)return;if(l&&e.forEach===l)e.forEach(t,r);else if(e.length===+e.length){for(var i=0,s=e.length;i<s;i++)if(i in e&&t.call(r,e[i],i,e)===n)return}else for(var o in e)if(S.has(e,o)&&t.call(r,e[o],o,e)===n)return};S.map=S.collect=function(e,t,n){var r=[];return e==null?r:c&&e.map===c?e.map(t,n):(x(e,function(e,i,s){r[r.length]=t.call(n,e,i,s)}),e.length===+e.length&&(r.length=e.length),r)},S.reduce=S.foldl=S.inject=function(e,t,n,r){var i=arguments.length>2;e==null&&(e=[]);if(h&&e.reduce===h)return r&&(t=S.bind(t,r)),i?e.reduce(t,n):e.reduce(t);x(e,function(e,s,o){i?n=t.call(r,n,e,s,o):(n=e,i=!0)});if(!i)throw new TypeError("Reduce of empty array with no initial value");return n},S.find=S.detect=function(e,t,n){var r;return T(e,function(e,i,s){if(t.call(n,e,i,s))return r=e,!0}),r},S.filter=S.select=function(e,t,n){var r=[];return e==null?r:d&&e.filter===d?e.filter(t,n):(x(e,function(e,i,s){t.call(n,e,i,s)&&(r[r.length]=e)}),r)},S.reject=function(e,t,n){var r=[];return e==null?r:(x(e,function(e,i,s){t.call(n,e,i,s)||(r[r.length]=e)}),r)},S.every=S.all=function(e,t,r){var i=!0;return e==null?i:v&&e.every===v?e.every(t,r):(x(e,function(e,s,o){if(!(i=i&&t.call(r,e,s,o)))return n}),!!i)};var T=S.some=S.any=function(e,t,r){t||(t=S.identity);var i=!1;return e==null?i:m&&e.some===m?e.some(t,r):(x(e,function(e,s,o){if(i||(i=t.call(r,e,s,o)))return n}),!!i)};S.include=S.contains=function(e,t){var n=!1;return e==null?n:g&&e.indexOf===g?e.indexOf(t)!=-1:(n=T(e,function(e){return e===t}),n)},S.pluck=function(e,t){return S.map(e,function(e){return e[t]})},S.sortBy=function(e,t,n){var r=S.isFunction(t)?t:function(e){return e[t]};return S.pluck(S.map(e,function(e,t,i){return{value:e,criteria:r.call(n,e,t,i)}}).sort(function(e,t){var n=e.criteria,r=t.criteria;return n===void 0?1:r===void 0?-1:n<r?-1:n>r?1:0}),"value")},S.groupBy=function(e,t){var n={},r=S.isFunction(t)?t:function(e){return e[t]};return x(e,function(e,t){var i=r(e,t);(n[i]||(n[i]=[])).push(e)}),n},S.sortedIndex=function(e,t,n){n||(n=S.identity);var r=0,i=e.length;while(r<i){var s=r+i>>1;n(e[s])<n(t)?r=s+1:i=s}return r},S.toArray=function(e){return e?S.isArray(e)?o.call(e):S.isArguments(e)?o.call(e):e.toArray&&S.isFunction(e.toArray)?e.toArray():S.values(e):[]},S.size=function(e){return S.isArray(e)?e.length:S.keys(e).length},S.last=function(e,t,n){return t!=null&&!n?o.call(e,Math.max(e.length-t,0)):e[e.length-1]},S.rest=S.tail=function(e,t,n){return o.call(e,t==null||n?1:t)},S.compact=function(e){return S.filter(e,function(e){return!!e})},S.flatten=function(e,t){return S.reduce(e,function(e,n){return S.isArray(n)?e.concat(t?n:S.flatten(n)):(e[e.length]=n,e)},[])},S.without=function(e){return S.difference(e,o.call(arguments,1))},S.uniq=S.unique=function(e,t,n){var r=n?S.map(e,n):e,i=[];return e.length<3&&(t=!0),S.reduce(r,function(n,r,s){if(t?S.last(n)!==r||!n.length:!S.include(n,r))n.push(r),i.push(e[s]);return n},[]),i},S.union=function(){return S.uniq(S.flatten(arguments,!0))},S.intersection=S.intersect=function(e){var t=o.call(arguments,1);return S.filter(S.uniq(e),function(e){return S.every(t,function(t){return S.indexOf(t,e)>=0})})},S.difference=function(e){var t=S.flatten(o.call(arguments,1),!0);return S.filter(e,function(e){return!S.include(t,e)})},S.indexOf=function(e,t,n){if(e==null)return-1;var r,i;if(n)return r=S.sortedIndex(e,t),e[r]===t?r:-1;if(g&&e.indexOf===g)return e.indexOf(t);for(r=0,i=e.length;r<i;r++)if(r in e&&e[r]===t)return r;return-1};var N=function(){};S.bind=function(t,n){var r,i;if(t.bind===E&&E)return E.apply(t,o.call(arguments,1));if(!S.isFunction(t))throw new TypeError;return i=o.call(arguments,2),r=function(){if(this instanceof r){N.prototype=t.prototype;var e=new N,s=t.apply(e,i.concat(o.call(arguments)));return Object(s)===s?s:e}return t.apply(n,i.concat(o.call(arguments)))}},S.bindAll=function(e){var t=o.call(arguments,1);return t.length==0&&(t=S.functions(e)),x(t,function(t){e[t]=S.bind(e[t],e)}),e},S.delay=function(e,t){var n=o.call(arguments,2);return setTimeout(function(){return e.apply(null,n)},t)},S.defer=function(e){return S.delay.apply(S,[e,1].concat(o.call(arguments,1)))},S.keys=w||function(e){if(e!==Object(e))throw new TypeError("Invalid object");var t=[];for(var n in e)S.has(e,n)&&(t[t.length]=n);return t},S.values=function(e){return S.map(e,S.identity)},S.functions=S.methods=function(e){var t=[];for(var n in e)S.isFunction(e[n])&&t.push(n);return t.sort()},S.extend=function(e){return x(o.call(arguments,1),function(t){for(var n in t)e[n]=t[n]}),e},S.defaults=function(e){return x(o.call(arguments,1),function(t){for(var n in t)e[n]==null&&(e[n]=t[n])}),e},S.clone=function(e){return S.isObject(e)?S.isArray(e)?e.slice():S.extend({},e):e},S.isEqual=function(e,t){return C(e,t,[])},S.isEmpty=function(e){if(e==null)return!0;if(S.isArray(e)||S.isString(e))return e.length===0;for(var t in e)if(S.has(e,t))return!1;return!0},S.isElement=function(e){return!!e&&e.nodeType==1},S.isArray=b||function(e){return a.call(e)=="[object Array]"},S.isObject=function(e){return e===Object(e)},S.isArguments=function(e){return a.call(e)=="[object Arguments]"},S.isArguments(arguments)||(S.isArguments=function(e){return!!e&&!!S.has(e,"callee")}),S.isFunction=function(e){return a.call(e)=="[object Function]"},S.isString=function(e){return a.call(e)=="[object String]"},S.isNumber=function(e){return a.call(e)=="[object Number]"},S.isFinite=function(e){return S.isNumber(e)&&isFinite(e)},S.isNaN=function(e){return e!==e},S.isBoolean=function(e){return e===!0||e===!1||a.call(e)=="[object Boolean]"},S.isDate=function(e){return a.call(e)=="[object Date]"},S.isRegExp=function(e){return a.call(e)=="[object RegExp]"},S.isNull=function(e){return e===null},S.isUndefined=function(e){return e===void 0},S.has=function(e,t){return f.call(e,t)},S.noConflict=function(){return e._=t,this},S.identity=function(e){return e},S.escape=function(e){return(""+e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")},S.mixin=function(e){x(S.functions(e),function(t){O(t,S[t]=e[t])})};var k=0;S.uniqueId=function(e){var t=k++;return e?e+t:t},S.chain=function(e){return S(e).chain()};var L=function(e){this._wrapped=e};S.prototype=L.prototype;var A=function(e,t){return t?S(e).chain():e},O=function(e,t){L.prototype[e]=function(){var e=o.call(arguments);return u.call(e,this._wrapped),A(t.apply(S,e),this._chain)}};S.mixin(S),x(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=r[e];L.prototype[e]=function(){var n=this._wrapped;t.apply(n,arguments);var r=n.length;return(e=="shift"||e=="splice")&&r===0&&delete n[0],A(n,this._chain)}}),x(["concat","join","slice"],function(e){var t=r[e];L.prototype[e]=function(){return A(t.apply(this._wrapped,arguments),this._chain)}}),L.prototype.chain=function(){return this._chain=!0,this},L.prototype.value=function(){return this._wrapped}}).call(this);//     Backbone.js 0.9.2
//     (c) 2010-2012 Jeremy Ashkenas, DocumentCloud Inc.
//     Backbone may be freely distributed under the MIT license.
//     For all details and documentation:
//     http://backbonejs.org
(function(){var e=this,t=e.Backbone,n=Array.prototype.slice,r=Array.prototype.splice,i;typeof exports!="undefined"?i=exports:i=e.Backbone={},i.VERSION="0.9.2";var s=e._;!s&&typeof require!="undefined"&&(s=require("underscore"));var o=e.jQuery||e.Zepto||e.ender;i.setDomLibrary=function(e){o=e},i.noConflict=function(){return e.Backbone=t,this},i.emulateHTTP=!1,i.emulateJSON=!1;var u=/\s+/,a=i.Events={on:function(e,t,n){var r,i,s,o,a;if(!t)return this;e=e.split(u),r=this._callbacks||(this._callbacks={});while(i=e.shift())a=r[i],s=a?a.tail:{},s.next=o={},s.context=n,s.callback=t,r[i]={tail:o,next:a?a.next:s};return this},off:function(e,t,n){var r,i,o,a,f,l;if(!(i=this._callbacks))return;if(!(e||t||n))return delete this._callbacks,this;e=e?e.split(u):s.keys(i);while(r=e.shift()){o=i[r],delete i[r];if(!o||!t&&!n)continue;a=o.tail;while((o=o.next)!==a)f=o.callback,l=o.context,(t&&f!==t||n&&l!==n)&&this.on(r,f,l)}return this},trigger:function(e){var t,r,i,s,o,a,f;if(!(i=this._callbacks))return this;a=i.all,e=e.split(u),f=n.call(arguments,1);while(t=e.shift()){if(r=i[t]){s=r.tail;while((r=r.next)!==s)r.callback.apply(r.context||this,f)}if(r=a){s=r.tail,o=[t].concat(f);while((r=r.next)!==s)r.callback.apply(r.context||this,o)}}return this}};a.bind=a.on,a.unbind=a.off;var f=i.Model=function(e,t){var n;e||(e={}),t&&t.parse&&(e=this.parse(e));if(n=x(this,"defaults"))e=s.extend({},n,e);t&&t.collection&&(this.collection=t.collection),this.attributes={},this._escapedAttributes={},this.cid=s.uniqueId("c"),this.changed={},this._silent={},this._pending={},this.set(e,{silent:!0}),this.changed={},this._silent={},this._pending={},this._previousAttributes=s.clone(this.attributes),this.initialize.apply(this,arguments)};s.extend(f.prototype,a,{changed:null,_silent:null,_pending:null,idAttribute:"id",initialize:function(){},toJSON:function(e){return s.clone(this.attributes)},get:function(e){return this.attributes[e]},escape:function(e){var t;if(t=this._escapedAttributes[e])return t;var n=this.get(e);return this._escapedAttributes[e]=s.escape(n==null?"":""+n)},has:function(e){return this.get(e)!=null},set:function(e,t,n){var r,i,o;s.isObject(e)||e==null?(r=e,n=t):(r={},r[e]=t),n||(n={});if(!r)return this;r instanceof f&&(r=r.attributes);if(n.unset)for(i in r)r[i]=void 0;if(!this._validate(r,n))return!1;this.idAttribute in r&&(this.id=r[this.idAttribute]);var u=n.changes={},a=this.attributes,l=this._escapedAttributes,c=this._previousAttributes||{};for(i in r){o=r[i];if(!s.isEqual(a[i],o)||n.unset&&s.has(a,i))delete l[i],(n.silent?this._silent:u)[i]=!0;n.unset?delete a[i]:a[i]=o,!s.isEqual(c[i],o)||s.has(a,i)!=s.has(c,i)?(this.changed[i]=o,n.silent||(this._pending[i]=!0)):(delete this.changed[i],delete this._pending[i])}return n.silent||this.change(n),this},unset:function(e,t){return(t||(t={})).unset=!0,this.set(e,null,t)},clear:function(e){return(e||(e={})).unset=!0,this.set(s.clone(this.attributes),e)},fetch:function(e){e=e?s.clone(e):{};var t=this,n=e.success;return e.success=function(r,i,s){if(!t.set(t.parse(r,s),e))return!1;n&&n(t,r)},e.error=i.wrapError(e.error,t,e),(this.sync||i.sync).call(this,"read",this,e)},save:function(e,t,n){var r,o;s.isObject(e)||e==null?(r=e,n=t):(r={},r[e]=t),n=n?s.clone(n):{};if(n.wait){if(!this._validate(r,n))return!1;o=s.clone(this.attributes)}var u=s.extend({},n,{silent:!0});if(r&&!this.set(r,n.wait?u:n))return!1;var a=this,f=n.success;n.success=function(e,t,i){var o=a.parse(e,i);n.wait&&(delete n.wait,o=s.extend(r||{},o));if(!a.set(o,n))return!1;f?f(a,e):a.trigger("sync",a,e,n)},n.error=i.wrapError(n.error,a,n);var l=this.isNew()?"create":"update",c=(this.sync||i.sync).call(this,l,this,n);return n.wait&&this.set(o,u),c},destroy:function(e){e=e?s.clone(e):{};var t=this,n=e.success,r=function(){t.trigger("destroy",t,t.collection,e)};if(this.isNew())return r(),!1;e.success=function(i){e.wait&&r(),n?n(t,i):t.trigger("sync",t,i,e)},e.error=i.wrapError(e.error,t,e);var o=(this.sync||i.sync).call(this,"delete",this,e);return e.wait||r(),o},url:function(){var e=x(this,"urlRoot")||x(this.collection,"url")||T();return this.isNew()?e:e+(e.charAt(e.length-1)=="/"?"":"/")+encodeURIComponent(this.id)},parse:function(e,t){return e},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return this.id==null},change:function(e){e||(e={});var t=this._changing;this._changing=!0;for(var n in this._silent)this._pending[n]=!0;var r=s.extend({},e.changes,this._silent);this._silent={};for(var n in r)this.trigger("change:"+n,this,this.get(n),e);if(t)return this;while(!s.isEmpty(this._pending)){this._pending={},this.trigger("change",this,e);for(var n in this.changed){if(this._pending[n]||this._silent[n])continue;delete this.changed[n]}this._previousAttributes=s.clone(this.attributes)}return this._changing=!1,this},hasChanged:function(e){return arguments.length?s.has(this.changed,e):!s.isEmpty(this.changed)},changedAttributes:function(e){if(!e)return this.hasChanged()?s.clone(this.changed):!1;var t,n=!1,r=this._previousAttributes;for(var i in e){if(s.isEqual(r[i],t=e[i]))continue;(n||(n={}))[i]=t}return n},previous:function(e){return!arguments.length||!this._previousAttributes?null:this._previousAttributes[e]},previousAttributes:function(){return s.clone(this._previousAttributes)},isValid:function(){return!this.validate(this.attributes)},_validate:function(e,t){if(t.silent||!this.validate)return!0;e=s.extend({},this.attributes,e);var n=this.validate(e,t);return n?(t&&t.error?t.error(this,n,t):this.trigger("error",this,n,t),!1):!0}});var l=i.Collection=function(e,t){t||(t={}),t.model&&(this.model=t.model),t.comparator&&(this.comparator=t.comparator),this._reset(),this.initialize.apply(this,arguments),e&&this.reset(e,{silent:!0,parse:t.parse})};s.extend(l.prototype,a,{model:f,initialize:function(){},toJSON:function(e){return this.map(function(t){return t.toJSON(e)})},add:function(e,t){var n,i,o,u,a,f,l={},c={},h=[];t||(t={}),e=s.isArray(e)?e.slice():[e];for(n=0,o=e.length;n<o;n++){if(!(u=e[n]=this._prepareModel(e[n],t)))throw new Error("Can't add an invalid model to a collection");a=u.cid,f=u.id;if(l[a]||this._byCid[a]||f!=null&&(c[f]||this._byId[f])){h.push(n);continue}l[a]=c[f]=u}n=h.length;while(n--)e.splice(h[n],1);for(n=0,o=e.length;n<o;n++)(u=e[n]).on("all",this._onModelEvent,this),this._byCid[u.cid]=u,u.id!=null&&(this._byId[u.id]=u);this.length+=o,i=t.at!=null?t.at:this.models.length,r.apply(this.models,[i,0].concat(e)),this.comparator&&this.sort({silent:!0});if(t.silent)return this;for(n=0,o=this.models.length;n<o;n++){if(!l[(u=this.models[n]).cid])continue;t.index=n,u.trigger("add",u,this,t)}return this},remove:function(e,t){var n,r,i,o;t||(t={}),e=s.isArray(e)?e.slice():[e];for(n=0,r=e.length;n<r;n++){o=this.getByCid(e[n])||this.get(e[n]);if(!o)continue;delete this._byId[o.id],delete this._byCid[o.cid],i=this.indexOf(o),this.models.splice(i,1),this.length--,t.silent||(t.index=i,o.trigger("remove",o,this,t)),this._removeReference(o)}return this},push:function(e,t){return e=this._prepareModel(e,t),this.add(e,t),e},pop:function(e){var t=this.at(this.length-1);return this.remove(t,e),t},unshift:function(e,t){return e=this._prepareModel(e,t),this.add(e,s.extend({at:0},t)),e},shift:function(e){var t=this.at(0);return this.remove(t,e),t},get:function(e){return e==null?void 0:this._byId[e.id!=null?e.id:e]},getByCid:function(e){return e&&this._byCid[e.cid||e]},at:function(e){return this.models[e]},where:function(e){return s.isEmpty(e)?[]:this.filter(function(t){for(var n in e)if(e[n]!==t.get(n))return!1;return!0})},sort:function(e){e||(e={});if(!this.comparator)throw new Error("Cannot sort a set without a comparator");var t=s.bind(this.comparator,this);return this.comparator.length==1?this.models=this.sortBy(t):this.models.sort(t),e.silent||this.trigger("reset",this,e),this},pluck:function(e){return s.map(this.models,function(t){return t.get(e)})},reset:function(e,t){e||(e=[]),t||(t={});for(var n=0,r=this.models.length;n<r;n++)this._removeReference(this.models[n]);return this._reset(),this.add(e,s.extend({silent:!0},t)),t.silent||this.trigger("reset",this,t),this},fetch:function(e){e=e?s.clone(e):{},e.parse===undefined&&(e.parse=!0);var t=this,n=e.success;return e.success=function(r,i,s){t[e.add?"add":"reset"](t.parse(r,s),e),n&&n(t,r)},e.error=i.wrapError(e.error,t,e),(this.sync||i.sync).call(this,"read",this,e)},create:function(e,t){var n=this;t=t?s.clone(t):{},e=this._prepareModel(e,t);if(!e)return!1;t.wait||n.add(e,t);var r=t.success;return t.success=function(i,s,o){t.wait&&n.add(i,t),r?r(i,s):i.trigger("sync",e,s,t)},e.save(null,t),e},parse:function(e,t){return e},chain:function(){return s(this.models).chain()},_reset:function(e){this.length=0,this.models=[],this._byId={},this._byCid={}},_prepareModel:function(e,t){t||(t={});if(e instanceof f)e.collection||(e.collection=this);else{var n=e;t.collection=this,e=new this.model(n,t),e._validate(e.attributes,t)||(e=!1)}return e},_removeReference:function(e){this==e.collection&&delete e.collection,e.off("all",this._onModelEvent,this)},_onModelEvent:function(e,t,n,r){if((e=="add"||e=="remove")&&n!=this)return;e=="destroy"&&this.remove(t,r),t&&e==="change:"+t.idAttribute&&(delete this._byId[t.previous(t.idAttribute)],this._byId[t.id]=t),this.trigger.apply(this,arguments)}});var c=["forEach","each","map","reduce","reduceRight","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","sortBy","sortedIndex","toArray","size","first","initial","rest","last","without","indexOf","shuffle","lastIndexOf","isEmpty","groupBy"];s.each(c,function(e){l.prototype[e]=function(){return s[e].apply(s,[this.models].concat(s.toArray(arguments)))}});var h=i.Router=function(e){e||(e={}),e.routes&&(this.routes=e.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},p=/:\w+/g,d=/\*\w+/g,v=/[-[\]{}()+?.,\\^$|#\s]/g;s.extend(h.prototype,a,{initialize:function(){},route:function(e,t,n){return i.history||(i.history=new m),s.isRegExp(e)||(e=this._routeToRegExp(e)),n||(n=this[t]),i.history.route(e,s.bind(function(r){var s=this._extractParameters(e,r);n&&n.apply(this,s),this.trigger.apply(this,["route:"+t].concat(s)),i.history.trigger("route",this,t,s)},this)),this},navigate:function(e,t){i.history.navigate(e,t)},_bindRoutes:function(){if(!this.routes)return;var e=[];for(var t in this.routes)e.unshift([t,this.routes[t]]);for(var n=0,r=e.length;n<r;n++)this.route(e[n][0],e[n][1],this[e[n][1]])},_routeToRegExp:function(e){return e=e.replace(v,"\\$&").replace(p,"([^/]+)").replace(d,"(.*?)"),new RegExp("^"+e+"$")},_extractParameters:function(e,t){return e.exec(t).slice(1)}});var m=i.History=function(){this.handlers=[],s.bindAll(this,"checkUrl")},g=/^[#\/]/,y=/msie [\w.]+/;m.started=!1,s.extend(m.prototype,a,{interval:50,getHash:function(e){var t=e?e.location:window.location,n=t.href.match(/#(.*)$/);return n?n[1]:""},getFragment:function(e,t){if(e==null)if(this._hasPushState||t){e=window.location.pathname;var n=window.location.search;n&&(e+=n)}else e=this.getHash();return e.indexOf(this.options.root)||(e=e.substr(this.options.root.length)),e.replace(g,"")},start:function(e){if(m.started)throw new Error("Backbone.history has already been started");m.started=!0,this.options=s.extend({},{root:"/"},this.options,e),this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&window.history&&window.history.pushState);var t=this.getFragment(),n=document.documentMode,r=y.exec(navigator.userAgent.toLowerCase())&&(!n||n<=7);r&&(this.iframe=o('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(t)),this._hasPushState?o(window).bind("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!r?o(window).bind("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=t;var i=window.location,u=i.pathname==this.options.root;if(this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!u)return this.fragment=this.getFragment(null,!0),window.location.replace(this.options.root+"#"+this.fragment),!0;this._wantsPushState&&this._hasPushState&&u&&i.hash&&(this.fragment=this.getHash().replace(g,""),window.history.replaceState({},document.title,i.protocol+"//"+i.host+this.options.root+this.fragment));if(!this.options.silent)return this.loadUrl()},stop:function(){o(window).unbind("popstate",this.checkUrl).unbind("hashchange",this.checkUrl),clearInterval(this._checkUrlInterval),m.started=!1},route:function(e,t){this.handlers.unshift({route:e,callback:t})},checkUrl:function(e){var t=this.getFragment();t==this.fragment&&this.iframe&&(t=this.getFragment(this.getHash(this.iframe)));if(t==this.fragment)return!1;this.iframe&&this.navigate(t),this.loadUrl()||this.loadUrl(this.getHash())},loadUrl:function(e){var t=this.fragment=this.getFragment(e),n=s.any(this.handlers,function(e){if(e.route.test(t))return e.callback(t),!0});return n},navigate:function(e,t){if(!m.started)return!1;if(!t||t===!0)t={trigger:t};var n=(e||"").replace(g,"");if(this.fragment==n)return;this._hasPushState?(n.indexOf(this.options.root)!=0&&(n=this.options.root+n),this.fragment=n,window.history[t.replace?"replaceState":"pushState"]({},document.title,n)):this._wantsHashChange?(this.fragment=n,this._updateHash(window.location,n,t.replace),this.iframe&&n!=this.getFragment(this.getHash(this.iframe))&&(t.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,n,t.replace))):window.location.assign(this.options.root+e),t.trigger&&this.loadUrl(e)},_updateHash:function(e,t,n){n?e.replace(e.toString().replace(/(javascript:|#).*$/,"")+"#"+t):e.hash=t}});var b=function(e,t){var n=S(this,e,t);return n.extend=this.extend,n};f.extend=l.extend=h.extend=b;var w={create:"POST",update:"PUT","delete":"DELETE",read:"GET"};i.sync=function(e,t,n){var r=w[e];n||(n={});var u={type:r,dataType:"json"};return n.url||(u.url=x(t,"url")||T()),!n.data&&t&&(e=="create"||e=="update")&&(u.contentType="application/json",u.data=JSON.stringify(t.toJSON())),i.emulateJSON&&(u.contentType="application/x-www-form-urlencoded",u.data=u.data?{model:u.data}:{}),i.emulateHTTP&&(r==="PUT"||r==="DELETE")&&(i.emulateJSON&&(u.data._method=r),u.type="POST",u.beforeSend=function(e){e.setRequestHeader("X-HTTP-Method-Override",r)}),u.type!=="GET"&&!i.emulateJSON&&(u.processData=!1),o.ajax(s.extend(u,n))},i.wrapError=function(e,t,n){return function(r,i){i=r===t?i:r,e?e(t,i,n):t.trigger("error",t,i,n)}};var E=function(){},S=function(e,t,n){var r;return t&&t.hasOwnProperty("constructor")?r=t.constructor:r=function(){e.apply(this,arguments)},s.extend(r,e),E.prototype=e.prototype,r.prototype=new E,t&&s.extend(r.prototype,t),n&&s.extend(r,n),r.prototype.constructor=r,r.__super__=e.prototype,r},x=function(e,t){return!e||!e[t]?null:s.isFunction(e[t])?e[t]():e[t]},T=function(){throw new Error('A "url" property or function must be specified')}}).call(this);// Knockout JavaScript library v2.1.0
// (c) Steven Sanderson - http://knockoutjs.com/
// License: MIT (http://www.opensource.org/licenses/mit-license.php)
(function(e,t,n,r){var i;if(typeof require!="undefined")try{i=require("lodash")}catch(s){i=require("underscore")}else i=e._;i&&i.hasOwnProperty("_")&&(i=i._);var o=!0;!function(t){if(typeof require=="function"&&typeof exports=="object"&&typeof module=="object"){var n=module.exports||exports;t(n)}else typeof define=="function"&&define.amd?define(["exports"],t):t(e.ko={})}(function(s){function a(e){var t=this;if(e)for(var n in e){var r=u.extenders[n];typeof r=="function"&&(t=r(t,e[n]))}return t}function d(e,t,n){n&&t!==u.selectExtensions.readValue(e)&&u.selectExtensions.writeValue(e,t),t!==u.selectExtensions.readValue(e)&&u.utils.triggerEvent(e,"change")}var u=typeof s!="undefined"?s:{};u.exportSymbol=function(e,t){var n=e.split("."),r=u;for(var i=0;i<n.length-1;i++)r=r[n[i]];r[n[n.length-1]]=t},u.exportProperty=function(e,t,n){e[t]=n},u.version="2.1.0",u.exportSymbol("version",u.version),u.utils=new function(){function y(e,t){if(u.utils.tagNameLower(e)!=="input"||!e.type)return!1;if(t.toLowerCase()!="click")return!1;var n=e.type;return n=="checkbox"||n=="radio"}var s=/^(\s|\u00A0)+|(\s|\u00A0)+$/g,o={},a={},f=/Firefox\/2/i.test(n.userAgent)?"KeyboardEvent":"UIEvents";o[f]=["keyup","keydown","keypress"],o.MouseEvents=["click","dblclick","mousedown","mouseup","mousemove","mouseover","mouseout","mouseenter","mouseleave"];for(var l in o){var c=o[l];if(c.length)for(var h=0,p=c.length;h<p;h++)a[c[h]]=l}var d={propertychange:!0},v=function(){var e=3,n=t.createElement("div"),i=n.getElementsByTagName("i");while(n.innerHTML="<!--[if gt IE "+ ++e+"]><i></i><![endif]-->",i[0]);return e>4?e:r}(),m=v===6,g=v===7;return{fieldsIncludedWithJsonPost:["authenticity_token",/^__RequestVerificationToken(_.*)?$/],arrayForEach:i.each,arrayIndexOf:i.indexOf,arrayFirst:function(e,t,n){for(var r=0,i=e.length;r<i;r++)if(t.call(n,e[r]))return e[r];return null},arrayRemoveItem:function(e,t){var n=u.utils.arrayIndexOf(e,t);n>=0&&e.splice(n,1)},arrayGetDistinctValues:i.uniq,arrayMap:i.map,arrayFilter:i.filter,arrayPushAll:function(e,t){if(t instanceof Array)e.push.apply(e,t);else for(var n=0,r=t.length;n<r;n++)e.push(t[n]);return e},extend:i.extend,emptyDomNode:function(e){while(e.firstChild)u.removeNode(e.firstChild)},moveCleanedNodesToContainerElement:function(e){var n=u.utils.makeArray(e),r=t.createElement("div");for(var i=0,s=n.length;i<s;i++)u.cleanNode(n[i]),r.appendChild(n[i]);return r},setDomNodeChildren:function(e,t){u.utils.emptyDomNode(e);if(t)for(var n=0,r=t.length;n<r;n++)e.appendChild(t[n])},replaceDomNodes:function(e,t){var n=e.nodeType?[e]:e;if(n.length>0){var r=n[0],i=r.parentNode;for(var s=0,o=t.length;s<o;s++)i.insertBefore(t[s],r);for(var s=0,o=n.length;s<o;s++)u.removeNode(n[s])}},setOptionNodeSelectionState:function(e,t){n.userAgent.indexOf("MSIE 6")>=0?e.setAttribute("selected",t):e.selected=t},stringTrim:function(e){return(e||"").replace(s,"")},stringTokenize:function(e,t){var n=[],r=(e||"").split(t);for(var i=0,s=r.length;i<s;i++){var o=u.utils.stringTrim(r[i]);o!==""&&n.push(o)}return n},stringStartsWith:function(e,t){return e=e||"",t.length>e.length?!1:e.substring(0,t.length)===t},buildEvalWithinScopeFunction:function(e,t){var n="return ("+e+")";for(var r=0;r<t;r++)n="with(sc["+r+"]) { "+n+" } ";return new Function("sc",n)},domNodeIsContainedBy:function(e,t){if(t.compareDocumentPosition)return(t.compareDocumentPosition(e)&16)==16;while(e!=null){if(e==t)return!0;e=e.parentNode}return!1},domNodeIsAttachedToDocument:function(e){return u.utils.domNodeIsContainedBy(e,e.ownerDocument)},tagNameLower:function(e){return e&&e.tagName&&e.tagName.toLowerCase()},registerEventHandler:function(e,t,n){var r=v&&d[t];if(!r&&typeof jQuery!="undefined"){if(y(e,t)){var i=n;n=function(e,t){var n=this.checked;t&&(this.checked=t.checkedStateBeforeEvent!==!0),i.call(this,e),this.checked=n}}jQuery(e).bind(t,n)}else if(!r&&typeof e.addEventListener=="function")e.addEventListener(t,n,!1);else{if(typeof e.attachEvent=="undefined")throw new Error("Browser doesn't support addEventListener or attachEvent");e.attachEvent("on"+t,function(t){n.call(e,t)})}},triggerEvent:function(n,r){if(!n||!n.nodeType)throw new Error("element must be a DOM node when calling triggerEvent");if(typeof jQuery!="undefined"){var i=[];y(n,r)&&i.push({checkedStateBeforeEvent:n.checked}),jQuery(n).trigger(r,i)}else if(typeof t.createEvent=="function"){if(typeof n.dispatchEvent!="function")throw new Error("The supplied element doesn't support dispatchEvent");var s=a[r]||"HTMLEvents",o=t.createEvent(s);o.initEvent(r,!0,!0,e,0,0,0,0,0,!1,!1,!1,!1,0,n),n.dispatchEvent(o)}else{if(typeof n.fireEvent=="undefined")throw new Error("Browser doesn't support triggering events");y(n,r)&&(n.checked=n.checked!==!0),n.fireEvent("on"+r)}},unwrapObservable:function(e){return u.isObservable(e)?e():e},toggleDomNodeCssClass:function(e,t,n){var r=(e.className||"").split(/\s+/),i=u.utils.arrayIndexOf(r,t)>=0;if(n&&!i)e.className+=(r[0]?" ":"")+t;else if(i&&!n){var s="";for(var o=0;o<r.length;o++)r[o]!=t&&(s+=r[o]+" ");e.className=u.utils.stringTrim(s)}},setTextContent:function(e,t){var n=u.utils.unwrapObservable(t);if(n===null||n===r)n="";"innerText"in e?e.innerText=n:e.textContent=n,v>=9&&(e.style.display=e.style.display)},ensureSelectElementIsRenderedCorrectly:function(e){if(v>=9){var t=e.style.width;e.style.width=0,e.style.width=t}},range:function(e,t){e=u.utils.unwrapObservable(e),t=u.utils.unwrapObservable(t);var n=[];for(var r=e;r<=t;r++)n.push(r);return n},makeArray:function(e){var t=[];for(var n=0,r=e.length;n<r;n++)t.push(e[n]);return t},isIe6:m,isIe7:g,ieVersion:v,getFormFields:function(e,t){var n=u.utils.makeArray(e.getElementsByTagName("input")).concat(u.utils.makeArray(e.getElementsByTagName("textarea"))),r=typeof t=="string"?function(e){return e.name===t}:function(e){return t.test(e.name)},i=[];for(var s=n.length-1;s>=0;s--)r(n[s])&&i.push(n[s]);return i}}},u.exportSymbol("utils",u.utils),u.exportSymbol("utils.arrayForEach",u.utils.arrayForEach),u.exportSymbol("utils.arrayFirst",u.utils.arrayFirst),u.exportSymbol("utils.arrayFilter",u.utils.arrayFilter),u.exportSymbol("utils.arrayGetDistinctValues",u.utils.arrayGetDistinctValues),u.exportSymbol("utils.arrayIndexOf",u.utils.arrayIndexOf),u.exportSymbol("utils.arrayMap",u.utils.arrayMap),u.exportSymbol("utils.arrayPushAll",u.utils.arrayPushAll),u.exportSymbol("utils.arrayRemoveItem",u.utils.arrayRemoveItem),u.exportSymbol("utils.extend",u.utils.extend),u.exportSymbol("utils.fieldsIncludedWithJsonPost",u.utils.fieldsIncludedWithJsonPost),u.exportSymbol("utils.getFormFields",u.utils.getFormFields),u.exportSymbol("utils.postJson",u.utils.postJson),u.exportSymbol("utils.parseJson",u.utils.parseJson),u.exportSymbol("utils.registerEventHandler",u.utils.registerEventHandler),u.exportSymbol("utils.stringifyJson",u.utils.stringifyJson),u.exportSymbol("utils.range",u.utils.range),u.exportSymbol("utils.toggleDomNodeCssClass",u.utils.toggleDomNodeCssClass),u.exportSymbol("utils.triggerEvent",u.utils.triggerEvent),u.exportSymbol("utils.unwrapObservable",u.utils.unwrapObservable),Function.prototype.bind||(Function.prototype.bind=function(e){var t=this,n=Array.prototype.slice.call(arguments),e=n.shift();return function(){return t.apply(e,n.concat(Array.prototype.slice.call(arguments)))}}),u.utils.domData=new function(){var e=0,t="__ko__"+(new Date).getTime(),n={};return{get:function(e,t){var n=u.utils.domData.getAll(e,!1);return n===r?r:n[t]},set:function(e,t,n){if(n===r&&u.utils.domData.getAll(e,!1)===r)return;var i=u.utils.domData.getAll(e,!0);i[t]=n},getAll:function(i,s){var o=i[t],u=o&&o!=="null";if(!u){if(!s)return r;o=i[t]="ko"+e++,n[o]={}}return n[o]},clear:function(e){var r=e[t];r&&(delete n[r],e[t]=null)}}},u.exportSymbol("utils.domData",u.utils.domData),u.exportSymbol("utils.domData.clear",u.utils.domData.clear),u.utils.domNodeDisposal=new function(){function i(t,n){var i=u.utils.domData.get(t,e);return i===r&&n&&(i=[],u.utils.domData.set(t,e,i)),i}function s(t){u.utils.domData.set(t,e,r)}function o(e){var t=i(e,!1);if(t){t=t.slice(0);for(var r=0;r<t.length;r++)t[r](e)}u.utils.domData.clear(e),typeof jQuery=="function"&&typeof jQuery["cleanData"]=="function"&&jQuery.cleanData([e]),n[e.nodeType]&&a(e)}function a(e){var t,n=e.firstChild;while(t=n)n=t.nextSibling,t.nodeType===8&&o(t)}var e="__ko_domNodeDisposal__"+(new Date).getTime(),t={1:!0,8:!0,9:!0},n={1:!0,9:!0};return{addDisposeCallback:function(e,t){if(typeof t!="function")throw new Error("Callback must be a function");i(e,!0).push(t)},removeDisposeCallback:function(e,t){var n=i(e,!1);n&&(u.utils.arrayRemoveItem(n,t),n.length==0&&s(e))},cleanNode:function(e){if(t[e.nodeType]){o(e);if(n[e.nodeType]){var r=[];u.utils.arrayPushAll(r,e.getElementsByTagName("*"));for(var i=0,s=r.length;i<s;i++)o(r[i])}}},removeNode:function(e){u.cleanNode(e),e.parentNode&&e.parentNode.removeChild(e)}}},u.cleanNode=u.utils.domNodeDisposal.cleanNode,u.removeNode=u.utils.domNodeDisposal.removeNode,u.exportSymbol("cleanNode",u.cleanNode),u.exportSymbol("removeNode",u.removeNode),u.exportSymbol("utils.domNodeDisposal",u.utils.domNodeDisposal),u.exportSymbol("utils.domNodeDisposal.addDisposeCallback",u.utils.domNodeDisposal.addDisposeCallback),u.exportSymbol("utils.domNodeDisposal.removeDisposeCallback",u.utils.domNodeDisposal.removeDisposeCallback),function(){function i(n){var r=u.utils.stringTrim(n).toLowerCase(),i=t.createElement("div"),s=r.match(/^<(thead|tbody|tfoot)/)&&[1,"<table>","</table>"]||!r.indexOf("<tr")&&[2,"<table><tbody>","</tbody></table>"]||(!r.indexOf("<td")||!r.indexOf("<th"))&&[3,"<table><tbody><tr>","</tr></tbody></table>"]||[0,"",""],o="ignored<div>"+s[1]+n+s[2]+"</div>";typeof e["innerShiv"]=="function"?i.appendChild(e.innerShiv(o)):i.innerHTML=o;while(s[0]--)i=i.lastChild;return u.utils.makeArray(i.lastChild.childNodes)}function s(e){var t=jQuery.clean([e]);if(t&&t[0]){var n=t[0];while(n.parentNode&&n.parentNode.nodeType!==11)n=n.parentNode;n.parentNode&&n.parentNode.removeChild(n)}return t}var n=/^(\s*)<!--(.*?)-->/;u.utils.parseHtmlFragment=function(e){return typeof jQuery!="undefined"?s(e):i(e)},u.utils.setHtml=function(e,t){u.utils.emptyDomNode(e);if(t!==null&&t!==r){typeof t!="string"&&(t=t.toString());if(typeof jQuery!="undefined")jQuery(e).html(t);else{var n=u.utils.parseHtmlFragment(t);for(var i=0;i<n.length;i++)e.appendChild(n[i])}}}}(),u.exportSymbol("utils.parseHtmlFragment",u.utils.parseHtmlFragment),u.exportSymbol("utils.setHtml",u.utils.setHtml),u.memoization=function(){function t(){return((1+Math.random())*4294967296|0).toString(16).substring(1)}function n(){return t()+t()}function i(e,t){if(!e)return;if(e.nodeType==8){var n=u.memoization.parseMemoText(e.nodeValue);n!=null&&t.push({domNode:e,memoId:n})}else if(e.nodeType==1)for(var r=0,s=e.childNodes,o=s.length;r<o;r++)i(s[r],t)}var e={};return{memoize:function(t){if(typeof t!="function")throw new Error("You can only pass a function to ko.memoization.memoize()");var r=n();return e[r]=t,"<!--[ko_memo:"+r+"]-->"},unmemoize:function(t,n){var i=e[t];if(i===r)throw new Error("Couldn't find any memo with ID "+t+". Perhaps it's already been unmemoized.");try{return i.apply(null,n||[]),!0}finally{delete e[t]}},unmemoizeDomNodeAndDescendants:function(e,t){var n=[];i(e,n);for(var r=0,s=n.length;r<s;r++){var o=n[r].domNode,a=[o];t&&u.utils.arrayPushAll(a,t),u.memoization.unmemoize(n[r].memoId,a),o.nodeValue="",o.parentNode&&o.parentNode.removeChild(o)}},parseMemoText:function(e){var t=e.match(/^\[ko_memo\:(.*?)\]$/);return t?t[1]:null}}}(),u.exportSymbol("memoization",u.memoization),u.exportSymbol("memoization.memoize",u.memoization.memoize),u.exportSymbol("memoization.unmemoize",u.memoization.unmemoize),u.exportSymbol("memoization.parseMemoText",u.memoization.parseMemoText),u.exportSymbol("memoization.unmemoizeDomNodeAndDescendants",u.memoization.unmemoizeDomNodeAndDescendants),u.extenders={throttle:function(e,t){e.throttleEvaluation=t;var n=null;return u.dependentObservable({read:e,write:function(r){clearTimeout(n),n=setTimeout(function(){e(r)},t)}})},notify:function(e,t){return e.equalityComparer=t=="always"?function(){return!1}:u.observable.fn.equalityComparer,e}},u.exportSymbol("extenders",u.extenders),u.subscription=function(e,t,n){this.target=e,this.callback=t,this.disposeCallback=n,u.exportProperty(this,"dispose",this.dispose)},u.subscription.prototype.dispose=function(){this.isDisposed=!0,this.disposeCallback()},u.subscribable=function(){this._subscriptions={},u.utils.extend(this,u.subscribable.fn),u.exportProperty(this,"subscribe",this.subscribe),u.exportProperty(this,"extend",this.extend),u.exportProperty(this,"getSubscriptionsCount",this.getSubscriptionsCount)};var f="change";u.subscribable.fn={subscribe:function(e,t,n){n=n||f;var r=t?e.bind(t):e,i=new u.subscription(this,r,function(){u.utils.arrayRemoveItem(this._subscriptions[n],i)}.bind(this));return this._subscriptions[n]||(this._subscriptions[n]=[]),this._subscriptions[n].push(i),i},notifySubscribers:function(e,t){t=t||f,this._subscriptions[t]&&u.utils.arrayForEach(this._subscriptions[t].slice(0),function(t){t&&t.isDisposed!==!0&&t.callback(e)})},getSubscriptionsCount:function(){var e=0;for(var t in this._subscriptions)this._subscriptions.hasOwnProperty(t)&&(e+=this._subscriptions[t].length);return e},extend:a},u.isSubscribable=function(e){return typeof e.subscribe=="function"&&typeof e["notifySubscribers"]=="function"},u.exportSymbol("subscribable",u.subscribable),u.exportSymbol("isSubscribable",u.isSubscribable),u.dependencyDetection=function(){var e=[];return{begin:function(t){e.push({callback:t,distinctDependencies:[]})},end:function(){e.pop()},registerDependency:function(t){if(!u.isSubscribable(t))throw new Error("Only subscribable things can act as dependencies");if(e.length>0){var n=e[e.length-1];if(u.utils.arrayIndexOf(n.distinctDependencies,t)>=0)return;n.distinctDependencies.push(t),n.callback(t)}}}}();var l={"undefined":!0,"boolean":!0,number:!0,string:!0};u.observable=function(e){function n(){if(arguments.length>0){if(!n.equalityComparer||!n.equalityComparer(t,arguments[0]))n.valueWillMutate(),t=arguments[0],o&&(n._latestValue=t),n.valueHasMutated();return this}return u.dependencyDetection.registerDependency(n),t}var t=e;return o&&(n._latestValue=t),u.subscribable.call(n),n.valueHasMutated=function(){n.notifySubscribers(t)},n.valueWillMutate=function(){n.notifySubscribers(t,"beforeChange")},u.utils.extend(n,u.observable.fn),u.exportProperty(n,"valueHasMutated",n.valueHasMutated),u.exportProperty(n,"valueWillMutate",n.valueWillMutate),n},u.observable.fn={equalityComparer:function(t,n){var r=t===null||typeof t in l;return r?t===n:!1}};var c=u.observable.protoProperty="__ko_proto__";u.observable.fn[c]=u.observable,u.hasPrototype=function(e,t){return e===null||e===r||e[c]===r?!1:e[c]===t?!0:u.hasPrototype(e[c],t)},u.isObservable=function(e){return u.hasPrototype(e,u.observable)},u.isWriteableObservable=function(e){return typeof e=="function"&&e[c]===u.observable?!0:typeof e=="function"&&e[c]===u.dependentObservable&&e.hasWriteFunction?!0:!1},u.exportSymbol("observable",u.observable),u.exportSymbol("isObservable",u.isObservable),u.exportSymbol("isWriteableObservable",u.isWriteableObservable),u.observableArray=function(e){arguments.length==0&&(e=[]);if(e===null||e===r||"length"in e){var t=u.observable(e);return u.utils.extend(t,u.observableArray.fn),t}throw new Error("The argument passed when initializing an observable array must be an array, or null, or undefined.")},u.observableArray.fn={remove:function(e){var t=this(),n=[],r=typeof e=="function"?e:function(t){return t===e};for(var i=0;i<t.length;i++){var s=t[i];r(s)&&(n.length===0&&this.valueWillMutate(),n.push(s),t.splice(i,1),i--)}return n.length&&this.valueHasMutated(),n},removeAll:function(e){if(e===r){var t=this(),n=t.slice(0);return this.valueWillMutate(),t.splice(0,t.length),this.valueHasMutated(),n}return e?this.remove(function(t){return u.utils.arrayIndexOf(e,t)>=0}):[]},destroy:function(e){var t=this(),n=typeof e=="function"?e:function(t){return t===e};this.valueWillMutate();for(var r=t.length-1;r>=0;r--){var i=t[r];n(i)&&(t[r]._destroy=!0)}this.valueHasMutated()},destroyAll:function(e){return e===r?this.destroy(function(){return!0}):e?this.destroy(function(t){return u.utils.arrayIndexOf(e,t)>=0}):[]},indexOf:function(e){var t=this();return u.utils.arrayIndexOf(t,e)},replace:function(e,t){var n=this.indexOf(e);n>=0&&(this.valueWillMutate(),this()[n]=t,this.valueHasMutated())}},u.utils.arrayForEach(["pop","push","reverse","shift","sort","splice","unshift"],function(e){u.observableArray.fn[e]=function(){var t=this();this.valueWillMutate();var n=t[e].apply(t,arguments);return this.valueHasMutated(),n}}),u.utils.arrayForEach(["slice"],function(e){u.observableArray.fn[e]=function(){var t=this();return t[e].apply(t,arguments)}}),u.exportSymbol("observableArray",u.observableArray),u.dependentObservable=function(e,t,n){function h(){u.utils.arrayForEach(c,function(e){e.dispose()}),c=[]}function y(){var e=w.throttleEvaluation;e&&e>=0?(clearTimeout(g),g=setTimeout(b,e)):b()}function b(){if(a)return;if(s&&v()){p();return}a=!0;try{var e=u.utils.arrayMap(c,function(e){return e.target});u.dependencyDetection.begin(function(t){var n;(n=u.utils.arrayIndexOf(e,t))>=0?e[n]=r:c.push(t.subscribe(y))});var n=f.call(t);for(var l=e.length-1;l>=0;l--)e[l]&&c.splice(l,1)[0].dispose();s=!0,w.notifySubscribers(i,"beforeChange"),i=n,o&&(w._latestValue=i)}finally{u.dependencyDetection.end()}w.notifySubscribers(i),a=!1}function w(){if(!(arguments.length>0))return S();E.apply(w,arguments)}function E(){if(typeof l!="function")throw new Error("Cannot write a value to a ko.computed unless you specify a 'write' option. If you wish to read the current value, don't pass any parameters.");l.apply(t,arguments)}function S(){return s||b(),u.dependencyDetection.registerDependency(w),i}var i,s=!1,a=!1,f=e;f&&typeof f=="object"?(n=f,f=n.read):(n=n||{},f||(f=n.read));if(typeof f!="function")throw new Error("Pass a function that returns the value of the ko.computed");var l=n.write;t||(t=n.owner);var c=[],p=h,d=typeof n["disposeWhenNodeIsRemoved"]=="object"?n.disposeWhenNodeIsRemoved:null,v=n.disposeWhen||function(){return!1};if(d){p=function(){u.utils.domNodeDisposal.removeDisposeCallback(d,arguments.callee),h()},u.utils.domNodeDisposal.addDisposeCallback(d,p);var m=v;v=function(){return!u.utils.domNodeIsAttachedToDocument(d)||m()}}var g=null;return w.getDependenciesCount=function(){return c.length},w.hasWriteFunction=typeof n.write=="function",w.dispose=function(){p()},u.subscribable.call(w),u.utils.extend(w,u.dependentObservable.fn),n.deferEvaluation!==!0&&b(),u.exportProperty(w,"dispose",w.dispose),u.exportProperty(w,"getDependenciesCount",w.getDependenciesCount),w},u.isComputed=function(e){return u.hasPrototype(e,u.dependentObservable)};var h=u.observable.protoProperty;u.dependentObservable[h]=u.observable,u.dependentObservable.fn={},u.dependentObservable.fn[h]=u.dependentObservable,u.exportSymbol("dependentObservable",u.dependentObservable),u.exportSymbol("computed",u.dependentObservable),u.exportSymbol("isComputed",u.isComputed),function(){var e="__ko__hasDomDataOptionValue__";u.selectExtensions={readValue:function(t){switch(u.utils.tagNameLower(t)){case"option":if(t[e]===!0)return u.utils.domData.get(t,u.bindingHandlers.options.optionValueDomDataKey);return t.getAttribute("value");case"select":return t.selectedIndex>=0?u.selectExtensions.readValue(t.options[t.selectedIndex]):r;default:return t.value}},writeValue:function(t,n){switch(u.utils.tagNameLower(t)){case"option":switch(typeof n){case"string":u.utils.domData.set(t,u.bindingHandlers.options.optionValueDomDataKey,r),e in t&&delete t[e],t.value=n;break;default:u.utils.domData.set(t,u.bindingHandlers.options.optionValueDomDataKey,n),t[e]=!0,t.value=typeof n=="number"?n:""}break;case"select":for(var i=t.options.length-1;i>=0;i--)if(u.selectExtensions.readValue(t.options[i])==n){t.selectedIndex=i;break}break;default:if(n===null||n===r)n="";t.value=n}}}}(),u.exportSymbol("selectExtensions",u.selectExtensions),u.exportSymbol("selectExtensions.readValue",u.selectExtensions.readValue),u.exportSymbol("selectExtensions.writeValue",u.selectExtensions.writeValue),u.jsonExpressionRewriting=function(){function r(t,n){var r=null;while(t!=r)r=t,t=t.replace(e,function(e,t){return n[t]});return t}function i(e){return u.utils.arrayIndexOf(n,u.utils.stringTrim(e).toLowerCase())>=0?!1:e.match(t)!==null}function s(e){var t=u.utils.stringTrim(e);switch(t.length&&t.charAt(0)){case"'":case'"':return e;default:return"'"+t+"'"}}var e=/\@ko_token_(\d+)\@/g,t=/^[\_$a-z][\_$a-z0-9]*(\[.*?\])*(\.[\_$a-z][\_$a-z0-9]*(\[.*?\])*)*$/i,n=["true","false"];return{bindingRewriteValidators:[],parseObjectLiteral:function(e){var t=u.utils.stringTrim(e);if(t.length<3)return[];t.charAt(0)==="{"&&(t=t.substring(1,t.length-1));var n=[],i=null,s;for(var o=0;o<t.length;o++){var a=t.charAt(o);if(i===null)switch(a){case'"':case"'":case"/":i=o,s=a}else if(a==s&&t.charAt(o-1)!=="\\"){var f=t.substring(i,o+1);n.push(f);var l="@ko_token_"+(n.length-1)+"@";t=t.substring(0,i)+l+t.substring(o+1),o-=f.length-l.length,i=null}}i=null,s=null;var c=0,h=null;for(var o=0;o<t.length;o++){var a=t.charAt(o);if(i===null)switch(a){case"{":i=o,h=a,s="}";break;case"(":i=o,h=a,s=")";break;case"[":i=o,h=a,s="]"}if(a===h)c++;else if(a===s){c--;if(c===0){var f=t.substring(i,o+1);n.push(f);var l="@ko_token_"+(n.length-1)+"@";t=t.substring(0,i)+l+t.substring(o+1),o-=f.length-l.length,i=null}}}var p=[],d=t.split(",");for(var v=0,m=d.length;v<m;v++){var g=d[v],y=g.indexOf(":");if(y>0&&y<g.length-1){var b=g.substring(0,y),w=g.substring(y+1);p.push({key:r(b,n),value:r(w,n)})}else p.push({unknown:r(g,n)})}return p},insertPropertyAccessorsIntoJson:function(e){var t=typeof e=="string"?u.jsonExpressionRewriting.parseObjectLiteral(e):e,n=[],r=[],o;for(var a=0;o=t[a];a++){n.length>0&&n.push(",");if(o.key){var f=s(o.key),l=o.value;n.push(f),n.push(":"),n.push(l),i(u.utils.stringTrim(l))&&(r.length>0&&r.push(", "),r.push(f+" : function(__ko_value) { "+l+" = __ko_value; }"))}else o.unknown&&n.push(o.unknown)}var c=n.join("");if(r.length>0){var h=r.join("");c=c+", '_ko_property_writers' : { "+h+" } "}return c},keyValueArrayContainsKey:function(e,t){for(var n=0;n<e.length;n++)if(u.utils.stringTrim(e[n]["key"])==t)return!0;return!1},writeValueToProperty:function(e,t,n,r,i){if(!e||!u.isWriteableObservable(e)){var s=t()._ko_property_writers;s&&s[n]&&s[n](r)}else(!i||e()!==r)&&e(r)}}}(),u.exportSymbol("jsonExpressionRewriting",u.jsonExpressionRewriting),u.exportSymbol("jsonExpressionRewriting.bindingRewriteValidators",u.jsonExpressionRewriting.bindingRewriteValidators),u.exportSymbol("jsonExpressionRewriting.parseObjectLiteral",u.jsonExpressionRewriting.parseObjectLiteral),u.exportSymbol("jsonExpressionRewriting.insertPropertyAccessorsIntoJson",u.jsonExpressionRewriting.insertPropertyAccessorsIntoJson),function(){function s(t){return t.nodeType==8&&(e?t.text:t.nodeValue).match(n)}function o(t){return t.nodeType==8&&(e?t.text:t.nodeValue).match(r)}function a(e,t){var n=e,r=1,i=[];while(n=n.nextSibling){if(o(n)){r--;if(r===0)return i}i.push(n),s(n)&&r++}if(!t)throw new Error("Cannot find closing comment tag to match: "+e.nodeValue);return null}function f(e,t){var n=a(e,t);return n?n.length>0?n[n.length-1].nextSibling:e.nextSibling:null}function l(e){var t=e.firstChild,n=null;if(t)do if(n)n.push(t);else if(s(t)){var r=f(t,!0);r?t=r:n=[t]}else o(t)&&(n=[t]);while(t=t.nextSibling);return n}var e=t.createComment("test").text==="<!--test-->",n=e?/^<!--\s*ko\s+(.*\:.*)\s*-->$/:/^\s*ko\s+(.*\:.*)\s*$/,r=e?/^<!--\s*\/ko\s*-->$/:/^\s*\/ko\s*$/,i={ul:!0,ol:!0};u.virtualElements={allowedBindings:{},childNodes:function(e){return s(e)?a(e):e.childNodes},emptyNode:function(e){if(!s(e))u.utils.emptyDomNode(e);else{var t=u.virtualElements.childNodes(e);for(var n=0,r=t.length;n<r;n++)u.removeNode(t[n])}},setDomNodeChildren:function(e,t){if(!s(e))u.utils.setDomNodeChildren(e,t);else{u.virtualElements.emptyNode(e);var n=e.nextSibling;for(var r=0,i=t.length;r<i;r++)n.parentNode.insertBefore(t[r],n)}},prepend:function(e,t){s(e)?e.parentNode.insertBefore(t,e.nextSibling):e.firstChild?e.insertBefore(t,e.firstChild):e.appendChild(t)},insertAfter:function(e,t,n){s(e)?e.parentNode.insertBefore(t,n.nextSibling):n.nextSibling?e.insertBefore(t,n.nextSibling):e.appendChild(t)},firstChild:function(e){return s(e)?!e.nextSibling||o(e.nextSibling)?null:e.nextSibling:e.firstChild},nextSibling:function(e){return s(e)&&(e=f(e)),e.nextSibling&&o(e.nextSibling)?null:e.nextSibling},virtualNodeBindingValue:function(e){var t=s(e);return t?t[1]:null},normaliseVirtualElementDomStructure:function(e){if(!i[u.utils.tagNameLower(e)])return;var t=e.firstChild;if(t)do if(t.nodeType===1){var n=l(t);if(n){var r=t.nextSibling;for(var s=0;s<n.length;s++)r?e.insertBefore(n[s],r):e.appendChild(n[s])}}while(t=t.nextSibling)}}}(),u.exportSymbol("virtualElements",u.virtualElements),u.exportSymbol("virtualElements.allowedBindings",u.virtualElements.allowedBindings),u.exportSymbol("virtualElements.emptyNode",u.virtualElements.emptyNode),u.exportSymbol("virtualElements.insertAfter",u.virtualElements.insertAfter),u.exportSymbol("virtualElements.prepend",u.virtualElements.prepend),u.exportSymbol("virtualElements.setDomNodeChildren",u.virtualElements.setDomNodeChildren),function(){function t(e,t,r){var i=t+"_"+e;return r[i]||(r[i]=n(e,t))}function n(e,t){var n=" { "+u.jsonExpressionRewriting.insertPropertyAccessorsIntoJson(e)+" } ";return u.utils.buildEvalWithinScopeFunction(n,t)}var e="data-bind";u.bindingProvider=function(){this.bindingCache={}},u.utils.extend(u.bindingProvider.prototype,{nodeHasBindings:function(t){switch(t.nodeType){case 1:return t.getAttribute(e)!=null;case 8:return u.virtualElements.virtualNodeBindingValue(t)!=null;default:return!1}},getBindings:function(e,t){var n=this.getBindingsString(e,t);return n?this.parseBindingsString(n,t):null},getBindingsString:function(t,n){switch(t.nodeType){case 1:return t.getAttribute(e);case 8:return u.virtualElements.virtualNodeBindingValue(t);default:return null}},parseBindingsString:function(e,n){try{var r=n.$data,i=typeof r=="object"&&r!=null?[r,n]:[n],s=t(e,i.length,this.bindingCache);return s(i)}catch(o){throw new Error("Unable to parse bindings.\nMessage: "+o+";\nBindings value: "+e)}}}),u.bindingProvider.instance=new u.bindingProvider}(),u.exportSymbol("bindingProvider",u.bindingProvider),function(){function t(e){var t=u.virtualElements.allowedBindings[e];if(!t)throw new Error("The binding '"+e+"' cannot be used with virtual elements")}function n(e,t,n){var r,s=u.virtualElements.firstChild(t);while(r=s)s=u.virtualElements.nextSibling(r),i(e,r,n)}function i(e,t,r){var i=!0,o=t.nodeType===1;o&&u.virtualElements.normaliseVirtualElementDomStructure(t);var a=o&&r||u.bindingProvider.instance.nodeHasBindings(t);a&&(i=s(t,null,e,r).shouldBindDescendants),i&&n(e,t,!o)}function s(e,n,i,s){function f(e){return function(){return a[e]}}function l(){return a}var o=0,a,c;return u.dependentObservable(function(){var h=i&&i instanceof u.bindingContext?i:new u.bindingContext(u.utils.unwrapObservable(i)),p=h.$data;s&&u.storedBindingContextForNode(e,h);var d=typeof n=="function"?n():n;a=d||u.bindingProvider.instance.getBindings(e,h);if(a){if(o===0){o=1;for(var v in a){var m=u.bindingHandlers[v];m&&e.nodeType===8&&t(v);if(m&&typeof m["init"]=="function"){var g=m.init,y=g(e,f(v),l,p,h);if(y&&y.controlsDescendantBindings){if(c!==r)throw new Error("Multiple bindings ("+c+" and "+v+") are trying to control descendant bindings of the same element. You cannot use these bindings together on the same element.");c=v}}}o=2}if(o===2)for(var v in a){var m=u.bindingHandlers[v];if(m&&typeof m["update"]=="function"){var b=m.update;b(e,f(v),l,p,h)}}}},null,{disposeWhenNodeIsRemoved:e}),{shouldBindDescendants:c===r}}u.bindingHandlers={},u.bindingContext=function(e,t){t?(u.utils.extend(this,t),this.$parentContext=t,this.$parent=t.$data,this.$parents=(t.$parents||[]).slice(0),this.$parents.unshift(this.$parent)):(this.$parents=[],this.$root=e),this.$data=e},u.bindingContext.prototype.createChildContext=function(e){return new u.bindingContext(e,this)},u.bindingContext.prototype.extend=function(e){var t=u.utils.extend(new u.bindingContext,this);return u.utils.extend(t,e)};var o="__ko_bindingContext__";u.storedBindingContextForNode=function(e,t){if(arguments.length!=2)return u.utils.domData.get(e,o);u.utils.domData.set(e,o,t)},u.applyBindingsToNode=function(e,t,n){return e.nodeType===1&&u.virtualElements.normaliseVirtualElementDomStructure(e),s(e,t,n,!0)},u.applyBindingsToDescendants=function(e,t){(t.nodeType===1||t.nodeType===8)&&n(e,t,!0)},u.applyBindings=function(t,n){if(n&&n.nodeType!==1&&n.nodeType!==8)throw new Error("ko.applyBindings: first parameter should be your view model; second parameter should be a DOM node");n=n||e.document.body,i(t,n,!0)},u.contextFor=function(e){switch(e.nodeType){case 1:case 8:var t=u.storedBindingContextForNode(e);if(t)return t;if(e.parentNode)return u.contextFor(e.parentNode)}return r},u.dataFor=function(e){var t=u.contextFor(e);return t?t.$data:r},u.exportSymbol("bindingHandlers",u.bindingHandlers),u.exportSymbol("applyBindings",u.applyBindings),u.exportSymbol("applyBindingsToDescendants",u.applyBindingsToDescendants),u.exportSymbol("applyBindingsToNode",u.applyBindingsToNode),u.exportSymbol("contextFor",u.contextFor),u.exportSymbol("dataFor",u.dataFor)}();var p=["click"];u.utils.arrayForEach(p,function(e){u.bindingHandlers[e]={init:function(t,n,r,i){var s=function(){var t={};return t[e]=n(),t};return u.bindingHandlers.event.init.call(this,t,s,r,i)}}}),u.bindingHandlers.event={init:function(e,t,n,r){var i=t()||{};for(var s in i)(function(){var i=s;typeof i=="string"&&u.utils.registerEventHandler(e,i,function(e){var s,o=t()[i];if(!o)return;var a=n();try{var f=u.utils.makeArray(arguments);f.unshift(r),s=o.apply(r,f)}finally{s!==!0&&(e.preventDefault?e.preventDefault():e.returnValue=!1)}var l=a[i+"Bubble"]!==!1;l||(e.cancelBubble=!0,e.stopPropagation&&e.stopPropagation())})})()}},u.bindingHandlers.submit={init:function(e,t,n,r){if(typeof t()!="function")throw new Error("The value for a submit binding must be a function");u.utils.registerEventHandler(e,"submit",function(n){var i,s=t();try{i=s.call(r,e)}finally{i!==!0&&(n.preventDefault?n.preventDefault():n.returnValue=!1)}})}},u.bindingHandlers.visible={update:function(e,t){var n=u.utils.unwrapObservable(t()),r=e.style.display!="none";n&&!r?e.style.display="":!n&&r&&(e.style.display="none")}},u.bindingHandlers.enable={update:function(e,t){var n=u.utils.unwrapObservable(t());n&&e.disabled?e.removeAttribute("disabled"):!n&&!e.disabled&&(e.disabled=!0)}},u.bindingHandlers.disable={update:function(e,t){u.bindingHandlers.enable.update(e,function(){return!u.utils.unwrapObservable(t())})}},u.bindingHandlers.value={init:function(e,t,n){var r=["change"],i=n().valueUpdate;i&&(typeof i=="string"&&(i=[i]),u.utils.arrayPushAll(r,i),r=u.utils.arrayGetDistinctValues(r));var s=function(){var r=t(),i=u.selectExtensions.readValue(e);u.jsonExpressionRewriting.writeValueToProperty(r,n,"value",i,!0)},o=u.utils.ieVersion&&e.tagName.toLowerCase()=="input"&&e.type=="text"&&e.autocomplete!="off"&&(!e.form||e.form.autocomplete!="off");if(o&&u.utils.arrayIndexOf(r,"propertychange")==-1){var a=!1;u.utils.registerEventHandler(e,"propertychange",function(){a=!0}),u.utils.registerEventHandler(e,"blur",function(){a&&(a=!1,s())})}u.utils.arrayForEach(r,function(t){var n=s;u.utils.stringStartsWith(t,"after")&&(n=function(){setTimeout(s,0)},t=t.substring("after".length)),u.utils.registerEventHandler(e,t,n)})},update:function(e,t){var n=u.utils.tagNameLower(e)==="select",r=u.utils.unwrapObservable(t()),i=u.selectExtensions.readValue(e),s=r!=i;r===0&&i!==0&&i!=="0"&&(s=!0);if(s){var o=function(){u.selectExtensions.writeValue(e,r)};o();var a=n;a&&setTimeout(o,0)}n&&e.length>0&&d(e,r,!1)}},u.bindingHandlers.options={update:function(e,n,i){if(u.utils.tagNameLower(e)!=="select")throw new Error("options binding applies only to SELECT elements");var s=e.length==0,o=u.utils.arrayMap(u.utils.arrayFilter(e.childNodes,function(e){return e.tagName&&u.utils.tagNameLower(e)==="option"&&e.selected}),function(e){return u.selectExtensions.readValue(e)||e.innerText||e.textContent}),a=e.scrollTop,f=u.utils.unwrapObservable(n()),l=e.value;while(e.length>0)u.cleanNode(e.options[0]),e.remove(0);if(f){var c=i();typeof f.length!="number"&&(f=[f]);if(c.optionsCaption){var h=
t.createElement("option");u.utils.setHtml(h,c.optionsCaption),u.selectExtensions.writeValue(h,r),e.appendChild(h)}for(var p=0,v=f.length;p<v;p++){var h=t.createElement("option"),m=typeof c["optionsValue"]=="string"?f[p][c.optionsValue]:f[p];m=u.utils.unwrapObservable(m),u.selectExtensions.writeValue(h,m);var g=c.optionsText,y;typeof g=="function"?y=g(f[p]):typeof g=="string"?y=f[p][g]:y=m;if(y===null||y===r)y="";u.utils.setTextContent(h,y),e.appendChild(h)}var b=e.getElementsByTagName("option"),w=0;for(var p=0,v=b.length;p<v;p++)u.utils.arrayIndexOf(o,u.selectExtensions.readValue(b[p]))>=0&&(u.utils.setOptionNodeSelectionState(b[p],!0),w++);e.scrollTop=a,s&&"value"in c&&d(e,u.utils.unwrapObservable(c.value),!0),u.utils.ensureSelectElementIsRenderedCorrectly(e)}}},u.bindingHandlers.options.optionValueDomDataKey="__ko.optionValueDomData__",u.bindingHandlers.selectedOptions={getSelectedValuesFromSelectNode:function(e){var t=[],n=e.childNodes;for(var r=0,i=n.length;r<i;r++){var s=n[r],o=u.utils.tagNameLower(s);if(o=="option"&&s.selected)t.push(u.selectExtensions.readValue(s));else if(o=="optgroup"){var a=u.bindingHandlers.selectedOptions.getSelectedValuesFromSelectNode(s);Array.prototype.splice.apply(t,[t.length,0].concat(a))}}return t},init:function(e,t,n){u.utils.registerEventHandler(e,"change",function(){var e=t(),r=u.bindingHandlers.selectedOptions.getSelectedValuesFromSelectNode(this);u.jsonExpressionRewriting.writeValueToProperty(e,n,"value",r)})},update:function(e,t){if(u.utils.tagNameLower(e)!="select")throw new Error("values binding applies only to SELECT elements");var n=u.utils.unwrapObservable(t());if(n&&typeof n.length=="number"){var r=e.childNodes;for(var i=0,s=r.length;i<s;i++){var o=r[i];u.utils.tagNameLower(o)==="option"&&u.utils.setOptionNodeSelectionState(o,u.utils.arrayIndexOf(n,u.selectExtensions.readValue(o))>=0)}}}},u.bindingHandlers.text={update:function(e,t){u.utils.setTextContent(e,t())}},u.bindingHandlers.html={init:function(){return{controlsDescendantBindings:!0}},update:function(e,t){var n=u.utils.unwrapObservable(t());u.utils.setHtml(e,n)}},u.bindingHandlers.css={update:function(e,t){var n=u.utils.unwrapObservable(t()||{});for(var r in n)if(typeof r=="string"){var i=u.utils.unwrapObservable(n[r]);u.utils.toggleDomNodeCssClass(e,r,i)}}},u.bindingHandlers.style={update:function(e,t){var n=u.utils.unwrapObservable(t()||{});for(var r in n)if(typeof r=="string"){var i=u.utils.unwrapObservable(n[r]);e.style[r]=i||""}}},u.bindingHandlers.uniqueName={init:function(e,n){n()&&(e.name="ko_unique_"+ ++u.bindingHandlers.uniqueName.currentIndex,(u.utils.isIe6||u.utils.isIe7)&&e.mergeAttributes(t.createElement("<input name='"+e.name+"'/>"),!1))}},u.bindingHandlers.uniqueName.currentIndex=0,u.bindingHandlers.checked={init:function(e,t,n){var r=function(){var r;if(e.type=="checkbox")r=e.checked;else{if(e.type!="radio"||!e.checked)return;r=e.value}var i=t();if(e.type=="checkbox"&&u.utils.unwrapObservable(i)instanceof Array){var s=u.utils.arrayIndexOf(u.utils.unwrapObservable(i),e.value);e.checked&&s<0?i.push(e.value):!e.checked&&s>=0&&i.splice(s,1)}else u.jsonExpressionRewriting.writeValueToProperty(i,n,"checked",r,!0)};u.utils.registerEventHandler(e,"click",r),e.type=="radio"&&!e.name&&u.bindingHandlers.uniqueName.init(e,function(){return!0})},update:function(e,t){var n=u.utils.unwrapObservable(t());e.type=="checkbox"?n instanceof Array?e.checked=u.utils.arrayIndexOf(n,e.value)>=0:e.checked=n:e.type=="radio"&&(e.checked=e.value==n)}};var v={"class":"className","for":"htmlFor"};u.bindingHandlers.attr={update:function(e,t,n){var i=u.utils.unwrapObservable(t())||{};for(var s in i)if(typeof s=="string"){var o=u.utils.unwrapObservable(i[s]),a=o===!1||o===null||o===r;a&&e.removeAttribute(s),u.utils.ieVersion<=8&&s in v?(s=v[s],a?e.removeAttribute(s):e[s]=o):a||e.setAttribute(s,o.toString())}}},u.bindingHandlers.hasfocus={init:function(e,t,n){var r=function(e){var r=t();u.jsonExpressionRewriting.writeValueToProperty(r,n,"hasfocus",e,!0)};u.utils.registerEventHandler(e,"focus",function(){r(!0)}),u.utils.registerEventHandler(e,"focusin",function(){r(!0)}),u.utils.registerEventHandler(e,"blur",function(){r(!1)}),u.utils.registerEventHandler(e,"focusout",function(){r(!1)})},update:function(e,t){var n=u.utils.unwrapObservable(t());n?e.focus():e.blur(),u.utils.triggerEvent(e,n?"focusin":"focusout")}},u.bindingHandlers["with"]={makeTemplateValueAccessor:function(e){return function(){var t=e();return{"if":t,data:t,templateEngine:u.nativeTemplateEngine.instance}}},init:function(e,t,n,r,i){return u.bindingHandlers.template.init(e,u.bindingHandlers["with"].makeTemplateValueAccessor(t))},update:function(e,t,n,r,i){return u.bindingHandlers.template.update(e,u.bindingHandlers["with"].makeTemplateValueAccessor(t),n,r,i)}},u.jsonExpressionRewriting.bindingRewriteValidators["with"]=!1,u.virtualElements.allowedBindings["with"]=!0,u.bindingHandlers["if"]={makeTemplateValueAccessor:function(e){return function(){return{"if":e(),templateEngine:u.nativeTemplateEngine.instance}}},init:function(e,t,n,r,i){return u.bindingHandlers.template.init(e,u.bindingHandlers["if"].makeTemplateValueAccessor(t))},update:function(e,t,n,r,i){return u.bindingHandlers.template.update(e,u.bindingHandlers["if"].makeTemplateValueAccessor(t),n,r,i)}},u.jsonExpressionRewriting.bindingRewriteValidators["if"]=!1,u.virtualElements.allowedBindings["if"]=!0,u.bindingHandlers.ifnot={makeTemplateValueAccessor:function(e){return function(){return{ifnot:e(),templateEngine:u.nativeTemplateEngine.instance}}},init:function(e,t,n,r,i){return u.bindingHandlers.template.init(e,u.bindingHandlers.ifnot.makeTemplateValueAccessor(t))},update:function(e,t,n,r,i){return u.bindingHandlers.template.update(e,u.bindingHandlers.ifnot.makeTemplateValueAccessor(t),n,r,i)}},u.jsonExpressionRewriting.bindingRewriteValidators.ifnot=!1,u.virtualElements.allowedBindings.ifnot=!0,u.bindingHandlers.foreach={makeTemplateValueAccessor:function(e){return function(){var t=u.utils.unwrapObservable(e());return!t||typeof t.length=="number"?{foreach:t,templateEngine:u.nativeTemplateEngine.instance}:{foreach:t.data,includeDestroyed:t.includeDestroyed,afterAdd:t.afterAdd,beforeRemove:t.beforeRemove,afterRender:t.afterRender,templateEngine:u.nativeTemplateEngine.instance}}},init:function(e,t,n,r,i){return u.bindingHandlers.template.init(e,u.bindingHandlers.foreach.makeTemplateValueAccessor(t))},update:function(e,t,n,r,i){return u.bindingHandlers.template.update(e,u.bindingHandlers.foreach.makeTemplateValueAccessor(t),n,r,i)}},u.jsonExpressionRewriting.bindingRewriteValidators.foreach=!1,u.virtualElements.allowedBindings.foreach=!0,u.templateEngine=function(){},u.templateEngine.prototype.renderTemplateSource=function(e,t,n){throw new Error("Override renderTemplateSource")},u.templateEngine.prototype.createJavaScriptEvaluatorBlock=function(e){throw new Error("Override createJavaScriptEvaluatorBlock")},u.templateEngine.prototype.makeTemplateSource=function(e,n){if(typeof e=="string"){n=n||t;var r=n.getElementById(e);if(!r)throw new Error("Cannot find template with ID "+e);return new u.templateSources.domElement(r)}if(e.nodeType==1||e.nodeType==8)return new u.templateSources.anonymousTemplate(e);throw new Error("Unknown template type: "+e)},u.templateEngine.prototype.renderTemplate=function(e,t,n,r){var i=this.makeTemplateSource(e,r);return this.renderTemplateSource(i,t,n)},u.templateEngine.prototype.isTemplateRewritten=function(e,n){if(this.allowTemplateRewriting===!1)return!0;var r=n&&n!=t;return!r&&this.knownRewrittenTemplates&&this.knownRewrittenTemplates[e]?!0:this.makeTemplateSource(e,n).data("isRewritten")},u.templateEngine.prototype.rewriteTemplate=function(e,n,r){var i=this.makeTemplateSource(e,r),s=n(i.text());i.text(s),i.data("isRewritten",!0);var o=r&&r!=t;!o&&typeof e=="string"&&(this.knownRewrittenTemplates=this.knownRewrittenTemplates||{},this.knownRewrittenTemplates[e]=!0)},u.exportSymbol("templateEngine",u.templateEngine),u.templateRewriting=function(){function n(e){var t=u.jsonExpressionRewriting.bindingRewriteValidators;for(var n=0;n<e.length;n++){var r=e[n].key;if(t.hasOwnProperty(r)){var i=t[r];if(typeof i=="function"){var s=i(e[n].value);if(s)throw new Error(s)}else if(!i)throw new Error("This template engine does not support the '"+r+"' binding within its templates")}}}function r(e,t,r){var i=u.jsonExpressionRewriting.parseObjectLiteral(e);n(i);var s=u.jsonExpressionRewriting.insertPropertyAccessorsIntoJson(i),o="ko.templateRewriting.applyMemoizedBindingsToNextSibling(function() {             return (function() { return { "+s+" } })()         })";return r.createJavaScriptEvaluatorBlock(o)+t}var e=/(<[a-z]+\d*(\s+(?!data-bind=)[a-z0-9\-]+(=(\"[^\"]*\"|\'[^\']*\'))?)*\s+)data-bind=(["'])([\s\S]*?)\5/gi,t=/<!--\s*ko\b\s*([\s\S]*?)\s*-->/g;return{ensureTemplateIsRewritten:function(e,t,n){t.isTemplateRewritten(e,n)||t.rewriteTemplate(e,function(e){return u.templateRewriting.memoizeBindingAttributeSyntax(e,t)},n)},memoizeBindingAttributeSyntax:function(n,i){return n.replace(e,function(){return r(arguments[6],arguments[1],i)}).replace(t,function(){return r(arguments[1],"<!-- ko -->",i)})},applyMemoizedBindingsToNextSibling:function(e){return u.memoization.memoize(function(t,n){t.nextSibling&&u.applyBindingsToNode(t.nextSibling,e,n)})}}}(),u.exportSymbol("templateRewriting",u.templateRewriting),u.exportSymbol("templateRewriting.applyMemoizedBindingsToNextSibling",u.templateRewriting.applyMemoizedBindingsToNextSibling),function(){u.templateSources={},u.templateSources.domElement=function(e){this.domElement=e},u.templateSources.domElement.prototype.text=function(){var e=u.utils.tagNameLower(this.domElement),t=e==="script"?"text":e==="textarea"?"value":"innerHTML";if(arguments.length==0)return this.domElement[t];var n=arguments[0];t==="innerHTML"?u.utils.setHtml(this.domElement,n):this.domElement[t]=n},u.templateSources.domElement.prototype.data=function(e){if(arguments.length===1)return u.utils.domData.get(this.domElement,"templateSourceData_"+e);u.utils.domData.set(this.domElement,"templateSourceData_"+e,arguments[1])};var e="__ko_anon_template__";u.templateSources.anonymousTemplate=function(e){this.domElement=e},u.templateSources.anonymousTemplate.prototype=new u.templateSources.domElement,u.templateSources.anonymousTemplate.prototype.text=function(){if(arguments.length==0){var t=u.utils.domData.get(this.domElement,e)||{};return t.textData===r&&t.containerData&&(t.textData=t.containerData.innerHTML),t.textData}var n=arguments[0];u.utils.domData.set(this.domElement,e,{textData:n})},u.templateSources.domElement.prototype.nodes=function(){if(arguments.length==0){var t=u.utils.domData.get(this.domElement,e)||{};return t.containerData}var n=arguments[0];u.utils.domData.set(this.domElement,e,{containerData:n})},u.exportSymbol("templateSources",u.templateSources),u.exportSymbol("templateSources.domElement",u.templateSources.domElement),u.exportSymbol("templateSources.anonymousTemplate",u.templateSources.anonymousTemplate)}(),function(){function t(e,t,n){var r,i=e,s=u.virtualElements.nextSibling(t);while(i&&(r=i)!==s)i=u.virtualElements.nextSibling(r),(r.nodeType===1||r.nodeType===8)&&n(r)}function n(e,n){if(e.length){var r=e[0],i=e[e.length-1];t(r,i,function(e){u.applyBindings(n,e)}),t(r,i,function(e){u.memoization.unmemoizeDomNodeAndDescendants(e,[n])})}}function i(e){return e.nodeType?e:e.length>0?e[0]:null}function s(t,r,s,o,a){a=a||{};var f=t&&i(t),l=f&&f.ownerDocument,c=a.templateEngine||e;u.templateRewriting.ensureTemplateIsRewritten(s,c,l);var h=c.renderTemplate(s,o,a,l);if(typeof h.length!="number"||h.length>0&&typeof h[0].nodeType!="number")throw new Error("Template engine must return an array of DOM nodes");var p=!1;switch(r){case"replaceChildren":u.virtualElements.setDomNodeChildren(t,h),p=!0;break;case"replaceNode":u.utils.replaceDomNodes(t,h),p=!0;break;case"ignoreTargetNode":break;default:throw new Error("Unknown renderMode: "+r)}return p&&(n(h,o),a.afterRender&&a.afterRender(h,o.$data)),h}function a(e,t){var n=u.utils.domData.get(e,o);n&&typeof n.dispose=="function"&&n.dispose(),u.utils.domData.set(e,o,t)}var e;u.setTemplateEngine=function(t){if(!(t==r||t instanceof u.templateEngine))throw new Error("templateEngine must inherit from ko.templateEngine");e=t},u.renderTemplate=function(t,n,o,a,f){o=o||{};if((o["templateEngine"]||e)==r)throw new Error("Set a template engine before calling renderTemplate");f=f||"replaceChildren";if(a){var l=i(a),c=function(){return!l||!u.utils.domNodeIsAttachedToDocument(l)},h=l&&f=="replaceNode"?l.parentNode:l;return u.dependentObservable(function(){var e=n&&n instanceof u.bindingContext?n:new u.bindingContext(u.utils.unwrapObservable(n)),r=typeof t=="function"?t(e.$data):t,c=s(a,f,r,e,o);f=="replaceNode"&&(a=c,l=i(a))},null,{disposeWhen:c,disposeWhenNodeIsRemoved:h})}return u.memoization.memoize(function(e){u.renderTemplate(t,n,o,e,"replaceNode")})},u.renderTemplateForEach=function(e,t,i,o,a){var f,l=function(t,n){var r=typeof e=="function"?e(t):e;return f=a.createChildContext(u.utils.unwrapObservable(t)),f.$index=n,s(null,"ignoreTargetNode",r,f,i)},c=function(e,t,r){n(t,f),i.afterRender&&i.afterRender(t,e)};return u.dependentObservable(function(){var e=u.utils.unwrapObservable(t)||[];typeof e.length=="undefined"&&(e=[e]);var n=u.utils.arrayFilter(e,function(e){return i.includeDestroyed||e===r||e===null||!u.utils.unwrapObservable(e._destroy)});u.utils.setDomNodeChildrenFromArrayMapping(o,n,l,i,c)},null,{disposeWhenNodeIsRemoved:o})};var o="__ko__templateSubscriptionDomDataKey__";u.bindingHandlers.template={init:function(e,t){var n=u.utils.unwrapObservable(t());if(typeof n!="string"&&!n.name&&(e.nodeType==1||e.nodeType==8)){var r=e.nodeType==1?e.childNodes:u.virtualElements.childNodes(e),i=u.utils.moveCleanedNodesToContainerElement(r);(new u.templateSources.anonymousTemplate(e)).nodes(i)}return{controlsDescendantBindings:!0}},update:function(e,t,n,r,i){var s=u.utils.unwrapObservable(t()),o,f=!0;typeof s=="string"?o=s:(o=s.name,"if"in s&&(f=f&&u.utils.unwrapObservable(s["if"])),"ifnot"in s&&(f=f&&!u.utils.unwrapObservable(s.ifnot)));var l=null;if(typeof s=="object"&&"foreach"in s){var c=f&&s.foreach||[];l=u.renderTemplateForEach(o||e,c,s,e,i)}else if(f){var h=typeof s=="object"&&"data"in s?i.createChildContext(u.utils.unwrapObservable(s.data)):i;l=u.renderTemplate(o||e,h,s,e)}else u.virtualElements.emptyNode(e);a(e,l)}},u.jsonExpressionRewriting.bindingRewriteValidators.template=function(e){var t=u.jsonExpressionRewriting.parseObjectLiteral(e);return t.length==1&&t[0].unknown?null:u.jsonExpressionRewriting.keyValueArrayContainsKey(t,"name")?null:"This template engine does not support anonymous templates nested within its templates"},u.virtualElements.allowedBindings.template=!0}(),u.exportSymbol("setTemplateEngine",u.setTemplateEngine),u.exportSymbol("renderTemplate",u.renderTemplate),function(){function e(e,t,n){var i=[];for(var s=0;s<=t.length;s++)i[s]=[];for(var s=0,o=Math.min(e.length,n);s<=o;s++)i[0][s]=s;for(var s=1,o=Math.min(t.length,n);s<=o;s++)i[s][0]=s;var u,a=e.length,f,l=t.length,c,h;for(u=1;u<=a;u++){var p=Math.max(1,u-n),d=Math.min(l,u+n);for(f=p;f<=d;f++)if(e[u-1]===t[f-1])i[f][u]=i[f-1][u-1];else{var v=i[f-1][u]===r?Number.MAX_VALUE:i[f-1][u]+1,m=i[f][u-1]===r?Number.MAX_VALUE:i[f][u-1]+1;i[f][u]=Math.min(v,m)}}return i}function t(e,t,n){var i=t.length,s=n.length,o=[],u=e[s][i];if(u===r)return null;while(i>0||s>0){var a=e[s][i],f=s>0?e[s-1][i]:u+1,l=i>0?e[s][i-1]:u+1,c=s>0&&i>0?e[s-1][i-1]:u+1;if(f===r||f<a-1)f=u+1;if(l===r||l<a-1)l=u+1;c<a-1&&(c=u+1),f<=l&&f<c?(o.push({status:"added",value:n[s-1]}),s--):l<f&&l<c?(o.push({status:"deleted",value:t[i-1]}),i--):(o.push({status:"retained",value:t[i-1]}),s--,i--)}return o.reverse()}u.utils.compareArrays=function(n,i,s){if(s===r)return u.utils.compareArrays(n,i,1)||u.utils.compareArrays(n,i,10)||u.utils.compareArrays(n,i,Number.MAX_VALUE);n=n||[],i=i||[];var o=e(n,i,s);return t(o,n,i)}}(),u.exportSymbol("utils.compareArrays",u.utils.compareArrays),function(){function e(e){if(e.length>2){var t=e[0],n=e[e.length-1],r=[t];while(t!==n){t=t.nextSibling;if(!t)return;r.push(t)}Array.prototype.splice.apply(e,[0,e.length].concat(r))}}function t(t,n,r,i,s){var o=[],a=u.dependentObservable(function(){var t=n(r,s)||[];o.length>0&&(e(o),u.utils.replaceDomNodes(o,t),i&&i(r,t)),o.splice(0,o.length),u.utils.arrayPushAll(o,t)},null,{disposeWhenNodeIsRemoved:t,disposeWhen:function(){return o.length==0||!u.utils.domNodeIsAttachedToDocument(o[0])}});return{mappedNodes:o,dependentObservable:a}}var n="setDomNodeChildrenFromArrayMapping_lastMappingResult";u.utils.setDomNodeChildrenFromArrayMapping=function(i,s,o,a,f){s=s||[],a=a||{};var l=u.utils.domData.get(i,n)===r,c=u.utils.domData.get(i,n)||[],h=u.utils.arrayMap(c,function(e){return e.arrayEntry}),p=u.utils.compareArrays(h,s),d=[],v=0,m=[],g=0,y=[],b=null;for(var w=0,E=p.length;w<E;w++)switch(p[w].status){case"retained":var S=c[v];S.indexObservable(g),g=d.push(S),S.domNodes.length>0&&(b=S.domNodes[S.domNodes.length-1]),v++;break;case"deleted":c[v].dependentObservable.dispose(),e(c[v].domNodes),u.utils.arrayForEach(c[v].domNodes,function(e){m.push({element:e,index:w,value:p[w].value}),b=e}),v++;break;case"added":var x=p[w].value,T=u.observable(g),N=t(i,o,x,f,T),C=N.mappedNodes;g=d.push({arrayEntry:p[w].value,domNodes:C,dependentObservable:N.dependentObservable,indexObservable:T});for(var k=0,L=C.length;k<L;k++){var A=C[k];y.push({element:A,index:w,value:p[w].value}),b==null?u.virtualElements.prepend(i,A):u.virtualElements.insertAfter(i,A,b),b=A}f&&f(x,C,T)}u.utils.arrayForEach(m,function(e){u.cleanNode(e.element)});var O=!1;if(!l){if(a.afterAdd)for(var w=0;w<y.length;w++)a.afterAdd(y[w].element,y[w].index,y[w].value);if(a.beforeRemove){for(var w=0;w<m.length;w++)a.beforeRemove(m[w].element,m[w].index,m[w].value);O=!0}}if(!O&&m.length)for(var w=0;w<m.length;w++){var M=m[w].element;M.parentNode&&M.parentNode.removeChild(M)}u.utils.domData.set(i,n,d)}}(),u.exportSymbol("utils.setDomNodeChildrenFromArrayMapping",u.utils.setDomNodeChildrenFromArrayMapping),u.nativeTemplateEngine=function(){this.allowTemplateRewriting=!1},u.nativeTemplateEngine.prototype=new u.templateEngine,u.nativeTemplateEngine.prototype.renderTemplateSource=function(e,t,n){var r=!(u.utils.ieVersion<9),i=r?e.nodes:null,s=i?e.nodes():null;if(s)return u.utils.makeArray(s.cloneNode(!0).childNodes);var o=e.text();return u.utils.parseHtmlFragment(o)},u.nativeTemplateEngine.instance=new u.nativeTemplateEngine,u.setTemplateEngine(u.nativeTemplateEngine.instance),u.exportSymbol("nativeTemplateEngine",u.nativeTemplateEngine),function(){u.jqueryTmplTemplateEngine=function(){function n(){if(e<2)throw new Error("Your version of jQuery.tmpl is too old. Please upgrade to jQuery.tmpl 1.0.0pre or later.")}function r(e,t,n){return jQuery.tmpl(e,t,n)}var e=this.jQueryTmplVersion=function(){if(typeof jQuery=="undefined"||!jQuery.tmpl)return 0;try{if(jQuery.tmpl.tag.tmpl.open.toString().indexOf("__")>=0)return 2}catch(e){}return 1}();this.renderTemplateSource=function(e,i,s){s=s||{},n();var o=e.data("precompiled");if(!o){var u=e.text()||"";u="{{ko_with $item.koBindingContext}}"+u+"{{/ko_with}}",o=jQuery.template(null,u),e.data("precompiled",o)}var a=[i.$data],f=jQuery.extend({koBindingContext:i},s.templateOptions),l=r(o,a,f);return l.appendTo(t.createElement("div")),jQuery.fragments={},l},this.createJavaScriptEvaluatorBlock=function(e){return"{{ko_code ((function() { return "+e+" })()) }}"},this.addTemplate=function(e,n){t.write("<script type='text/html' id='"+e+"'>"+n+"</script>")},e>0&&(jQuery.tmpl.tag.ko_code={open:"__.push($1 || '');"},jQuery.tmpl.tag.ko_with={open:"with($1) {",close:"} "})},u.jqueryTmplTemplateEngine.prototype=new u.templateEngine;var e=new u.jqueryTmplTemplateEngine;e.jQueryTmplVersion>0&&u.setTemplateEngine(e),u.exportSymbol("jqueryTmplTemplateEngine",u.jqueryTmplTemplateEngine)}()})})(window,document,navigator);// Generated by CoffeeScript 1.3.3
/*
  knockback.js 0.16.0beta2
  (c) 2011, 2012 Kevin Malakoff.
  Knockback.js is freely distributable under the MIT license.
  See the following for full license details:
    https://github.com/kmalakoff/knockback/blob/master/LICENSE
  Dependencies: Knockout.js, Backbone.js, and Underscore.js.
    Optional dependency: Backbone.ModelRef.js.
*/(function(){var e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w=function(e,t){return function(){return e.apply(t,arguments)}},E={}.hasOwnProperty,S=function(e,t){function r(){this.constructor=e}for(var n in t)E.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};o=c=this.Knockback=this.kb=typeof exports!="undefined"?exports:{},c.VERSION="0.16.0beta2";if(typeof require!="undefined")try{m=require("lodash")}catch(x){m=require("underscore")}else m=this._;m&&m.hasOwnProperty("_")&&(m=m._),c._=m,c.Backbone=e=!this.Backbone&&typeof require!="undefined"?require("backbone"):this.Backbone,c.ko=h=!this.ko&&typeof require!="undefined"?require("knockout"):this.ko,c.TYPE_UNKNOWN=s=0,c.TYPE_SIMPLE=i=1,c.TYPE_ARRAY=t=2,c.TYPE_MODEL=r=3,c.TYPE_COLLECTION=n=4,d=function(e,t){throw""+e.constructor.name+": "+t+" is missing"},v=function(e,t){throw""+e.constructor.name+": "+t+" is unexpected"},p=function(e,t,n){var r;return c._legacy_warnings||(c._legacy_warnings={}),(r=c._legacy_warnings)[e]||(r[e]=0),c._legacy_warnings[e]++,console.warn("warning: '"+e+"' has been deprecated (will be removed in Knockback after "+t+"). "+n+".")},a=Array.prototype.slice,f=Array.prototype.splice,l=function(e){var t;t=m.clone(e);while(e.options)m.defaults(t,e.options),e=e.options;return delete t.options,t},c.renderAutoReleasedTemplate=function(e,t,n){var r,i;return n==null&&(n={}),r=document.createElement("div"),i=h.renderTemplate(e,t,n,r,"replaceChildren"),r.children.length===1&&(r=r.children[0]),c.releaseOnNodeRemove(t,r),i.dispose(),r},c.releaseOnNodeRemove=function(e,t){return e||v(this,"missing view model"),t||v(this,"missing node"),h.utils.domNodeDisposal.addDisposeCallback(t,function(){return c.release(e)})},c.applyBindings=function(e,t,n){h.applyBindings(e,t);if(arguments.length===2||!n)return c.releaseOnNodeRemove(e,t)},c.release=function(t,r){var i,s,o,u,a,f,l,p;if(!t||t!==Object(t)||typeof t=="function"&&!h.isObservable(t)||t.__kb_destroyed||t instanceof e.Model||t instanceof e.Collection)return this;if(m.isArray(t)){i=t.splice(0,t.length);for(a=0,l=i.length;a<l;a++)s=i[a],c.release(s);return this}t.__kb_destroyed=!0,!r||r();if(h.isObservable(t)||typeof t.dispose=="function"||typeof t.destroy=="function"||typeof t.release=="function")if(h.isObservable(t)&&m.isArray(i=t())){if(t.__kb_is_co||t.__kb_is_o&&t.valueType()===n)t.destroy?t.destroy():t.dispose&&t.dispose();else if(i.length){u=i.slice(0),i.splice(0,i.length);for(f=0,p=u.length;f<p;f++)o=u[f],c.release(o)}}else t.release?t.release():t.destroy?t.destroy():t.dispose&&t.dispose();else c.releaseKeys(t);return this},c.releaseKeys=function(e){var t,n;for(t in e)n=e[t],t==="__kb"||c.release(n,function(){return e[t]=null});return this},c.locale_manager=void 0,b=function(e,t,n){return arguments.length===2?e&&e.__kb&&e.__kb.hasOwnProperty(t)?e.__kb[t]:void 0:(e||v(this,"no obj for wrapping "+t),e.__kb||(e.__kb={}),e.__kb[t]=n,n)},g=function(e,t){return f.call(e,1,0,t),e},y=function(e){var t,n,r;if(!e)return e;if(e.__kb)return"object"in e.__kb?e.__kb.object:e;if(m.isArray(e))return m.map(e,function(e){return y(e)});if(m.isObject(e)&&!h.isObservable(e)){n={};for(t in e)r=e[t],n[t]=y(r);return n}return e},c.utils={},c.utils.wrappedDestroy=function(e){var t;if(!e.__kb)return;return e.__kb.model_watcher&&e.__kb.model_watcher.releaseCallbacks(e),t=e.__kb,e.__kb=null,t.observable&&(t.observable.destroy=t.observable.release=null,c.utils.wrappedDestroy(t.observable),t.observable=null),t.factory=null,t.model_watcher_is_owned&&t.model_watcher.destroy(),t.model_watcher=null,t.store_is_owned&&t.store.destroy(),t.store=null},c.utils.wrappedModel=function(e,t){return arguments.length===1?(t=b(e,"object"),m.isUndefined(t)?e:t):b(e,"object",t)},c.utils.wrappedObservable=function(e,t){return b.apply(this,g(arguments,"observable"))},c.utils.wrappedObject=function(e,t){return b.apply(this,g(arguments,"object"))},c.utils.wrappedStore=function(e,t){return b.apply(this,g(arguments,"store"))},c.utils.wrappedStoreIsOwned=function(e,t){return b.apply(this,g(arguments,"store_is_owned"))},c.utils.wrappedFactory=function(e,t){return b.apply(this,g(arguments,"factory"))},c.utils.wrappedModelWatcher=function(e,t){return b.apply(this,g(arguments,"model_watcher"))},c.utils.wrappedModelWatcherIsOwned=function(e,t){return b.apply(this,g(arguments,"model_watcher_is_owned"))},c.utils.setToDefault=function(e){var t,n;if(!e)return;if(h.isObservable(e))typeof e.setToDefault=="function"&&e.setToDefault();else if(m.isObject(e))for(t in e)n=e[t],n&&(h.isObservable(n)||typeof n!="function")&&(t[0]!=="_"||t.search("__kb"))&&c.utils.setToDefault(n);return e},c.utils.valueType=function(o){return o?o.__kb_is_o?o.valueType():o.__kb_is_co||o instanceof e.Collection?n:o instanceof c.ViewModel||o instanceof e.Model?r:m.isArray(o)?t:i:s},c.utils.pathJoin=function(e,t){return(e?e[e.length-1]!=="."?""+e+".":e:"")+t},c.utils.optionsPathJoin=function(e,t){return m.defaults({path:c.utils.pathJoin(e.path,t)},e)},c.utils.inferCreator=function(t,n,r,i,s){var o,u;n&&(o=n.creatorForPath(t,r));if(o)return o;if(i&&e.RelationalModel&&i instanceof e.RelationalModel){s=h.utils.unwrapObservable(s),u=m.find(i.getRelations(),function(e){return e.key===s});if(u)return u.collectionType||m.isArray(u.keyContents)?c.CollectionObservable:c.ViewModel}return t?t instanceof e.Model?c.ViewModel:t instanceof e.Collection?c.CollectionObservable:null:null},c.utils.createDefaultObservable=function(t,n){return t instanceof e.Model?c.viewModel(t,n):t instanceof e.Collection?c.collectionObservable(t,n):m.isArray(t)?h.observableArray(t):h.observable(t)},c.utils.release=function(e){return p("kb.utils.release","0.16.0","Please use kb.release instead"),c.release(e)},c.Factory=function(){function e(e){this.parent_factory=e,this.paths={}}return e.useOptionsOrCreate=function(e,t,n){var r;return e.factory&&!e.factories?r=c.utils.wrappedFactory(t,e.factory):r=c.utils.wrappedFactory(t,new c.Factory(e.factory)),e.factories&&r.addPathMappings(e.factories,n),r},e.prototype.hasPath=function(e){return this.paths.hasOwnProperty(e)||this.parent_factory&&this.parent_factory.hasPath(e)},e.prototype.addPathMapping=function(e,t){return this.paths[e]=t},e.prototype.addPathMappings=function(e,t){var n,r;for(r in e)n=e[r],this.paths[c.utils.pathJoin(t,r)]=n;return this},e.prototype.creatorForPath=function(e,t){var n;if(n=this.paths[t])return n.view_model?n.view_model:n;if(this.parent_factory)if(n=this.parent_factory.creatorForPath(e,t))return n;return null},e}(),c.Store=function(){function t(){this.observable_records=[],this.replaced_observables=[]}return t.useOptionsOrCreate=function(e,t,n){return e.store?(e.store.register(t,n,e),c.utils.wrappedStore(n,e.store)):(c.utils.wrappedStoreIsOwned(n,!0),c.utils.wrappedStore(n,new c.Store))},t.prototype.destroy=function(){var e,t,n,r,i,s,o,u;o=this.observable_records;for(n=0,i=o.length;n<i;n++)t=o[n],c.release(t.observable);u=this.replaced_observables;for(r=0,s=u.length;r<s;r++)e=u[r],c.release(e);return this.observable_records=null,this.replaced_observables=null},t.prototype.register=function(e,t,n){var r;if(!t)return;if(h.isObservable(t)||t.__kb_is_co)return;return c.utils.wrappedObject(t,e),e||(t.__kb_null=!0),r=n.creator?n.creator:n.path&&n.factory?n.factory.creatorForPath(e,n.path):null,r||(r=t.constructor),this.observable_records.push({obj:e,observable:t,creator:r}),t},t.prototype.findIndex=function(t,n){var r,i,s;if(!t||t instanceof e.Model){s=this.observable_records;for(r in s){i=s[r];if(!i.observable)continue;if(i.observable.__kb_destroyed){i.obj=null,i.observable=null;continue}if(!t&&!i.observable.__kb_null||t&&(i.observable.__kb_null||i.obj!==t))continue;if(i.creator===n||i.creator.create&&i.creator.create===n.create)return r}}return-1},t.prototype.find=function(e,t){var n;return(n=this.findIndex(e,t))<0?null:this.observable_records[n].observable},t.prototype.isRegistered=function(e){var t,n,r,i;i=this.observable_records;for(n=0,r=i.length;n<r;n++){t=i[n];if(t.observable===e)return!0}return!1},t.prototype.findOrCreate=function(t,n){var r,i;return n.store=this,n.creator||(n.creator=c.utils.inferCreator(t,n.factory,n.path)),!n.creator&&t instanceof e.Model&&(n.creator=kv.ViewModel),r=n.creator,r?r.models_only?t:(r&&(i=this.find(t,r)),i?i:(r.create?i=r.create(t,n):i=new r(t,n),i||(i=h.observable(null)),h.isObservable(i)||this.isRegistered(i)||this.register(t,i,n),i)):c.utils.createDefaultObservable(t,n)},t.prototype.findOrReplace=function(e,t,n){var r,i;return e||raiseUnexpected("obj missing"),(r=this.findIndex(e,t))<0?this.register(e,n,{creator:t}):(i=this.observable_records[r],c.utils.wrappedObject(i.observable)===e||v(this,"different object"),i.observable!==n&&(i.observable.constructor===n.constructor||v(this,"replacing different type"),this.replaced_observables.push(i.observable),i.observable=n),n)},t}(),u=function(e,t,n){return!c.statistics||c.statistics.addModelEvent({name:t,model:e,key:n.key,path:n.path})},c.ModelWatcher=function(){function t(e,t,n){this._onModelUnloaded=w(this._onModelUnloaded,this),this._onModelLoaded=w(this._onModelLoaded,this),this.__kb||(this.__kb={}),this.__kb.callbacks={},this.__kb._onModelLoaded=m.bind(this._onModelLoaded,this),this.__kb._onModelUnloaded=m.bind(this._onModelUnloaded,this),n&&this.registerCallbacks(t,n),e?this.model(e):this.m=null}return t.useOptionsOrCreate=function(e,t,n,r){return e.model_watcher?(e.model_watcher.model()!==t&&e.model_watcher.model_ref!==t&&v(this,"model not matching"),c.utils.wrappedModelWatcher(n,e.model_watcher).registerCallbacks(n,r)):(c.utils.wrappedModelWatcherIsOwned(n,!0),c.utils.wrappedModelWatcher(n,new c.ModelWatcher(t)).registerCallbacks(n,r))},t.prototype.destroy=function(){return this.model(null),this.__kb.callbacks=null,c.utils.wrappedDestroy(this)},t.prototype.model=function(t){var n,r,i,s,o,u,a,f;if(arguments.length===0||this.m===t)return this.m;this.model_ref&&(this.model_ref.unbind("loaded",this.__kb._onModelLoaded),this.model_ref.unbind("unloaded",this.__kb._onModelUnloaded),this.model_ref.release(),this.model_ref=null),e.ModelRef&&t instanceof e.ModelRef?(this.model_ref=t,this.model_ref.retain(),this.model_ref.bind("loaded",this.__kb._onModelLoaded),this.model_ref.bind("unloaded",this.__kb._onModelUnloaded),t=this.model_ref.model()):delete this.model_ref,o=this.m,this.m=t,f=this.__kb.callbacks;for(r in f){n=f[r],o&&o.unbind(r,n.fn),t&&t.bind(r,n.fn),s=n.list;for(u=0,a=s.length;u<a;u++)i=s[u],i.model&&i.model(t)}return t},t.prototype.registerCallbacks=function(t,n){var r,i,s,o;return t||d(this,"obj"),n||d(this,"info"),i=n.event_name?n.event_name:"change",r=this.__kb.callbacks[i],r||(o=[],r={list:o,fn:function(e){var t,n,r;for(n=0,r=o.length;n<r;n++){t=o[n];if(t.update&&!t.rel_fn){if(e&&t.key&&e.hasChanged&&!e.hasChanged(h.utils.unwrapObservable(t.key)))continue;!c.statistics||u(e,i,t),t.update()}}return null}},this.__kb.callbacks[i]=r,this.m&&this.m.bind(i,r.fn)),s=m.defaults({obj:t},n),r.list.push(s),this.m&&(e.RelationalModel&&this.m instanceof e.RelationalModel&&this._modelBindRelatationalInfo(i,s),s.model(this.m)&&s.model),this},t.prototype.releaseCallbacks=function(e){var t,n,r,i,s,o;if(!this.__kb.callbacks)return;s=this.__kb.callbacks;for(n in s){t=s[n],o=t.list;for(r in o){i=o[r];if(i.obj===e){t.list.splice(r,1),i.rel_fn&&this._modelUnbindRelatationalInfo(n,i),i.model&&i.model(null);return}}}},t.prototype._onModelLoaded=function(t){var n,r,i,s,o,u,a,f;s=e.RelationalModel&&t instanceof e.RelationalModel,this.m=t,f=this.__kb.callbacks;for(r in f){n=f[r],t.bind(r,n.fn),o=n.list;for(u=0,a=o.length;u<a;u++)i=o[u],s&&this._modelBindRelatationalInfo(r,i),i.model&&i.model(t)}return this},t.prototype._onModelUnloaded=function(e){var t,n,r,i,s,o,u;this.m=null,u=this.__kb.callbacks;for(n in u){t=u[n],e.unbind(n,t.fn),i=t.list;for(s=0,o=i.length;s<o;s++)r=i[s],r.rel_fn&&this._modelUnbindRelatationalInfo(n,r),r.model&&r.model(null)}return this},t.prototype._modelBindRelatationalInfo=function(e,t){var n,r;if(e==="change"&&t.key&&t.update){n=h.utils.unwrapObservable(t.key),r=m.find(this.m.getRelations(),function(e){return e.key===n});if(!r)return;t.rel_fn=function(n){return!c.statistics||u(n,""+e+" (relational)",t),t.update()},r.collectionType||m.isArray(r.keyContents)?(t.is_collection=!0,this.m.bind("add:"+t.key,t.rel_fn),this.m.bind("remove:"+t.key,t.rel_fn)):this.m.bind("update:"+t.key,t.rel_fn)}return this},t.prototype._modelUnbindRelatationalInfo=function(e,t){if(!t.rel_fn)return;return t.is_collection?(this.m.unbind("add:"+t.key,t.rel_fn),this.m.unbind("remove:"+t.key,t.rel_fn)):this.m.unbind("update:"+t.key,t.rel_fn),t.rel_fn=null,this},t}(),c.modelObservable=function(e,t){return new c.ModelWatcher(e,t)},c.CollectionObservable=function(){function t(t,n){var r,i,s;return!t||t instanceof e.Collection||v(this,"not a collection"),n||(n={}),s=c.utils.wrappedObservable(this,h.observableArray([])),s.__kb_is_co=!0,this.in_edit=0,this.__kb||(this.__kb={}),this.__kb._onCollectionChange=m.bind(this._onCollectionChange,this),n=l(n),this.sort_attribute=n.sort_attribute,this.sorted_index=n.sorted_index,this.filters=m.isArray(n.filters)?n.filters:n.filters?[n.filters]:void 0,r=this.create_options={store:c.Store.useOptionsOrCreate(n,t,s)},this.path=n.path,i=r.factory=c.utils.wrappedFactory(s,new c.Factory(n.factory)),n.factories&&i.addPathMappings(n.factories,n.path),r.path=c.utils.pathJoin(n.path,"models"),r.creator=i.creatorForPath(null,r.path),r.creator?this.models_only=r.creator.models_only:(n.hasOwnProperty("models_only")?n.models_only?(i.addPathMapping(r.path,{models_only:n.models_only}),this.models_only=n.models_only):i.addPathMapping(r.path,c.ViewModel):n.view_model?i.addPathMapping(r.path,n.view_model):n.create?i.addPathMapping(r.path,{create:n.create}):i.addPathMapping(r.path,c.ViewModel),r.creator=i.creatorForPath(null,r.path)),s.destroy=m.bind(this.destroy,this),s.shareOptions=m.bind(this.shareOptions,this),s.collection=m.bind(this.collection,this),s.viewModelByModel=m.bind(this.viewModelByModel,this),s.sortedIndex=m.bind(this.sortedIndex,this),s.sortAttribute=m.bind(this.sortAttribute,this),s.hasViewModels=m.bind(this.hasViewModels,this),s.bind=m.bind(this.bind,this),s.unbind=m.bind(this.unbind,this),s.trigger=m.bind(this.trigger,this),c.utils.wrappedObject(s,null),t&&this.collection(t,{silent:!0,defer:n.defer}),s.subscribe(m.bind(this._onObservableArrayChange,this)),!c.statistics||c.statistics.register("CollectionObservable",this),s}return t.extend=e.Model.extend,t.prototype.destroy=function(){var e,t;return t=c.utils.wrappedObservable(this),e=c.utils.wrappedObject(t),e&&(e.unbind("all",this.__kb._onCollectionChange),this._clear(!0),c.utils.wrappedObject(t,null)),this.filters=null,this.sorted_index,this.create_options=null,c.utils.wrappedDestroy(this),!c.statistics||c.statistics.unregister("CollectionObservable",this)},t.prototype.shareOptions=function(){var e;return e=c.utils.wrappedObservable(this),{store:c.utils.wrappedStore(e),factory:c.utils.wrappedFactory(e)}},t.prototype.collection=function(e,t){var n,r;return n=c.utils.wrappedObservable(this),r=c.utils.wrappedObject(n),arguments.length===0||e===r?(n(),r):(e&&typeof e.retain=="function"&&e.retain(),r&&(r.unbind("all",this.__kb._onCollectionChange),typeof r.release=="function"&&r.release()),c.utils.wrappedObject(n,e),e?(e.bind("all",this.__kb._onCollectionChange),this.sortedIndex(this.sorted_index,this.sort_attribute,t)):this._clear(),e)},t.prototype.sortedIndex=function(e,t,n){var r,i=this;return n||(n={}),e?(this.sorted_index=e,this.sort_attribute=t):t?(this.sort_attribute=t,this.sorted_index=this._sortAttributeFn(t)):(this.sort_attribute=null,this.sorted_index=null),r=function(){var e,t;t=c.utils.wrappedObservable(i),e=c.utils.wrappedObject(t);if(e.models.length===0&&t().length===0)return;i._collectionResync(!0);if(!n.silent)return i.trigger("resort",t())},n.defer?m.defer(r):r(),this},t.prototype.sortAttribute=function(e,t,n){return this.sortedIndex(t,e,n)},t.prototype.viewModelByModel=function(e){var t;return this.models_only?null:(t=e.hasOwnProperty(e.idAttribute)?e.idAttribute:"cid",m.find(c.utils.wrappedObservable(this)(),function(n){return n.__kb.object[t]===e[t]}))},t.prototype.hasViewModels=function(){return!this.models_only},t.prototype._onCollectionChange=function(e,t){var n,r,i,s;if(this.in_edit)return;switch(e){case"reset":return this._collectionResync();case"resort":return!this.sorted_index;case"new":case"add":if(this._modelIsFiltered(t))return;return i=c.utils.wrappedObservable(this),r=c.utils.wrappedObject(i),s=this._createViewModel(t),n=this.sorted_index?this.sorted_index(i(),s):r.indexOf(t),this.in_edit++,i.splice(n,0,s),this.in_edit--,this.trigger("add",s,i());case"remove":case"destroy":return this._onModelRemove(t);case"change":return this._onModelChange(t)}},t.prototype._onModelRemove=function(e){var t,n;n=this.models_only?e:this.viewModelByModel(e);if(!n)return;return t=c.utils.wrappedObservable(this),this.in_edit++,t.remove(n),this.in_edit--,this.trigger("remove",n,t)},t.prototype._onModelChange=function(e){if(this._modelIsFiltered(e))return this._onModelRemove(e);if(this.sorted_index&&(!this.sort_attribute||e.hasChanged(this.sort_attribute)))return this._onModelResort(e)},t.prototype._onModelResort=function(e){var t,n,r,i,s,o;r=c.utils.wrappedObservable(this),t=c.utils.wrappedObject(r),o=this.models_only?e:this.viewModelByModel(e),i=r.indexOf(o),this.sorted_index?(s=m.clone(r()),s.splice(i,1),n=this.sorted_index(s,o)):n=t.indexOf(e);if(i===n)return;return this.in_edit++,r.splice(i,1),r.splice(n,0,o),this.in_edit--,this.trigger("resort",o,r(),n)},t.prototype._onObservableArrayChange=function(t){var n,r,i,s,o,u,a,f,l,h=this;if(this.in_edit)return;s=c.utils.wrappedObservable(this),n=c.utils.wrappedObject(s);if(!this.models_only){for(u=0,f=t.length;u<f;u++){o=t[u];if(o&&!(o instanceof e.Model)){r=!0;break}}if(r)for(a=0,l=t.length;a<l;a++)o=t[a],this.create_options.store.findOrReplace(c.utils.wrappedObject(o),this.create_options.creator,o)}i=m.map(t,function(e){return c.utils.wrappedModel(e)}),this.filters&&(i=m.filter(i,function(e){return!h._modelIsFiltered(e)}));if(i.length!==t.length||m.difference(n.models,i).length)return this.in_edit++,n.reset(i),this.in_edit--},t.prototype._clear=function(e){var t,n;return n=c.utils.wrappedObservable(this),e||this.trigger("remove",n()),e?(t=n(),t.splice(0,t.length)):(this.in_edit++,n.removeAll(),this.in_edit--),this},t.prototype._collectionResync=function(e){var t,n,r,i,s,o,u,a,f,l,h=this;o=c.utils.wrappedObservable(this),r=c.utils.wrappedObject(o),e||this.trigger("remove",o()),n=o(),n.splice(0,n.length),this.filters?s=m.filter(r.models,function(e){return!h._modelIsFiltered(e)}):s=r.models;if(this.sorted_index){a=[];for(f=0,l=s.length;f<l;f++)i=s[f],u=this._createViewModel(i),t=this.sorted_index(a,u),a.splice(t,0,u)}else a=this.models_only?this.filters?s:m.clone(s):m.map(s,function(e){return h._createViewModel(e)});this.in_edit++,o(a),this.in_edit--;if(!e)return this.trigger("add",o())},t.prototype._sortAttributeFn=function(e){return this.models_only?function(t,n){return m.sortedIndex(t,n,function(t){return t.get(e)})}:function(t,n){return m.sortedIndex(t,n,function(t){return c.utils.wrappedModel(t).get(e)})}},t.prototype._createViewModel=function(e){return this.models_only?e:this.create_options.store.findOrCreate(e,this.create_options)},t.prototype._modelIsFiltered=function(e){var t,n,r,i;if(this.filters){i=this.filters;for(n=0,r=i.length;n<r;n++){t=i[n],t=h.utils.unwrapObservable(t);if(typeof t=="function"&&t(e)||e&&e.id===t)return!0}}return!1},t}(),S(c.CollectionObservable.prototype,e.Events),c.collectionObservable=function(e,t){return new c.CollectionObservable(e,t)},c.sortedIndexWrapAttr=c.siwa=function(e,t){return function(n,r){return m.sortedIndex(n,r,function(n){return new t(c.utils.wrappedModel(n).get(e))})}},c.DefaultWrapper=function(){function e(e,t){var n,r=this;return this.dv=t,n=c.utils.wrappedObservable(this,h.dependentObservable({read:function(){var t;return(t=h.utils.unwrapObservable(e()))?t:h.utils.unwrapObservable(r.dv)},write:function(t){return e(t)}})),n.destroy=m.bind(this.destroy,this),n.setToDefault=m.bind(this.setToDefault,this),n}return e.prototype.destroy=function(){return c.utils.wrappedDestroy(this)},e.prototype.setToDefault=function(){return c.utils.wrappedObservable(this)(this.dv)},e}(),c.defaultWrapper=function(e,t){return new c.DefaultWrapper(e,t)},c.toFormattedString=function(e){var t,n,r,i,s,o;s=e.slice(),n=a.call(arguments,1);for(r in n){t=n[r],o=h.utils.unwrapObservable(t),o||(o=""),i=e.indexOf("{"+r+"}");while(i>=0)s=s.replace("{"+r+"}",o),i=e.indexOf("{"+r+"}",i+1)}return s},c.parseFormattedString=function(e,t){var n,r,i,s,o,u,a,f,l,c,h,p,d;c=t.slice(),i=0,u=0,f={};while(c.search("\\{"+i+"\\}")>=0){a=t.indexOf("{"+i+"}");while(a>=0)c=c.replace("{"+i+"}","(.*)"),f[a]=i,u++,a=t.indexOf("{"+i+"}",a+1);i++}n=i,l=new RegExp(c),o=l.exec(e),o&&o.shift();if(!o||o.length!==u){h=[];while(n-->0)h.push("");return h}d=m.sortBy(m.keys(f),function(e,t){return parseInt(e,10)}),r={};for(s in d){a=d[s],i=f[a];if(r.hasOwnProperty(i))continue;r[i]=s}p=[],i=0;while(i<n)p.push(o[r[i]]),i++;return p},c.FormattedObservable=function(){function e(e,t){var n,r;return m.isArray(t)?(e=e,r=t):r=a.call(arguments,1),n=c.utils.wrappedObservable(this,h.dependentObservable({read:function(){var n,i,s;t=[h.utils.unwrapObservable(e)];for(i=0,s=r.length;i<s;i++)n=r[i],t.push(h.utils.unwrapObservable(n));return c.toFormattedString.apply(null,t)},write:function(t){var n,i,s;i=c.parseFormattedString(t,h.utils.unwrapObservable(e)),s=Math.min(r.length,i.length),n=0;while(n<s)r[n](i[n]),n++;return this}})),n}return e.prototype.destroy=function(){return c.utils.wrappedDestroy(this)},e}(),c.formattedObservable=function(e,t){return new c.FormattedObservable(e,a.call(arguments,1))},c.LocalizedObservable=function(){function t(e,t,n){var r,i=this;return this.value=e,this.vm=n,t||(t={}),this.vm||(this.vm={}),this.read||d(this,"read"),c.locale_manager||d(this,"kb.locale_manager"),this.__kb||(this.__kb={}),this.__kb._onLocaleChange=m.bind(this._onLocaleChange,this),this.__kb._onChange=t.onChange,this.value&&(e=h.utils.unwrapObservable(this.value)),this.vo=h.observable(e?this.read(e,null):null),r=c.utils.wrappedObservable(this,h.dependentObservable({read:function(){return i.value&&h.utils.unwrapObservable(i.value),i.vo(),i.read(h.utils.unwrapObservable(i.value))},write:function(e){i.write||v(i,"writing to read-only"),i.write(e,h.utils.unwrapObservable(i.value)),i.vo(e);if(i.__kb._onChange)return i.__kb._onChange(e)},owner:this.vm})),r.destroy=m.bind(this.destroy,this),r.observedValue=m.bind(this.observedValue,this),r.resetToCurrent=m.bind(this.resetToCurrent,this),c.locale_manager.bind("change",this.__kb._onLocaleChange),t.hasOwnProperty("default")&&(r=h.defaultWrapper(r,t["default"])),r}return t.extend=e.Model.extend,t.prototype.destroy=function(){return c.locale_manager.unbind("change",this.__kb._onLocaleChange),this.vm=null,c.utils.wrappedDestroy(this)},t.prototype.resetToCurrent=function(){var e,t;t=c.utils.wrappedObservable(this),e=this.value?this.read(h.utils.unwrapObservable(this.value)):null;if(t()===e)return;return t(e)},t.prototype.observedValue=function(e){return arguments.length===0?this.value:(this.value=e,this._onLocaleChange(),this)},t.prototype._onLocaleChange=function(){var e;e=this.read(h.utils.unwrapObservable(this.value)),this.vo(e);if(this.__kb._onChange)return this.__kb._onChange(e)},t}(),c.localizedObservable=function(e,t,n){return new c.LocalizedObservable(e,t,n)},c.Observable=function(){function e(e,t,n){var r,i,s,o=this;return this.vm=n,t||d(this,"options"),this.vm||(this.vm={}),m.isString(t)||h.isObservable(t)?r=this.create_options={key:t}:r=this.create_options=l(t),this.key=r.key,delete r.key,this.key||d(this,"key"),!r.args||(this.args=r.args,delete r.args),!r.read||(this.read=r.read,delete r.read),!r.write||(this.write=r.write,delete r.write),i=r.model_watcher,delete r.model_watcher,this.vo=h.observable(null),s=c.utils.wrappedObservable(this,h.dependentObservable({read:function(){var e,t,n,r,i,s;t=[h.utils.unwrapObservable(o.key)];if(o.args)if(m.isArray(o.args)){s=o.args;for(r=0,i=s.length;r<i;r++)e=s[r],t.push(h.utils.unwrapObservable(e))}else t.push(h.utils.unwrapObservable(o.args));return o.m&&(n=o.read?o.read.apply(o.vm,t):o.m.get.apply(o.m,t),o.update(n)),h.utils.unwrapObservable(o.vo())},write:function(e){var t,n,r,i,s,u,a;i=y(e),r={},r[h.utils.unwrapObservable(o.key)]=i,n=o.write?[i]:[r];if(o.args)if(m.isArray(o.args)){a=o.args;for(s=0,u=a.length;s<u;s++)t=a[s],n.push(h.utils.unwrapObservable(t))}else n.push(h.utils.unwrapObservable(o.args));return o.m&&(o.write?o.write.apply(o.vm,n):o.m.set.apply(o.m,n)),o.update(e)},owner:this.vm})),s.__kb_is_o=!0,r.store=c.utils.wrappedStore(s,r.store),r.path=c.utils.pathJoin(r.path,this.key),r.factories&&(typeof r.factories=="function"||r.factories.create)?(r.factory=c.utils.wrappedFactory(s,new c.Factory(r.factory)),r.factory.addPathMapping(r.path,r.factories)):r.factory=c.Factory.useOptionsOrCreate(r,s,r.path),delete r.factories,s.value=m.bind(this.value,this),s.valueType=m.bind(this.valueType,this),s.destroy=m.bind(this.destroy,this),c.ModelWatcher.useOptionsOrCreate({model_watcher:i},e,this,{model:m.bind(this.model,this),update:m.bind(this.update,this),key:this.key,path:r.path}),this.__kb_value||this.update(),r.localizer&&(s=new r.localizer(s),delete r.localizer),r.hasOwnProperty("default")&&(s=c.defaultWrapper(s,r["default"]),delete r["default"]),s}return e.prototype.destroy=function(){return this.__kb_destroyed=!0,c.release(this.__kb_value),this.__kb_value=null,this.vm=null,this.create_options=null,c.utils.wrappedDestroy(this)},e.prototype.value=function(){return this.__kb_value},e.prototype.valueType=function(){var e;return e=this.m?this.m.get(this.key):null,this.value_type||this._updateValueObservable(e),this.value_type},e.prototype.setToDefault=function(){var e;return(e=this.__kb_value)!=null&&typeof e.setToDefault=="function"&&e.setToDefault(),this},e.prototype.model=function(e){return arguments.length===0||this.m===e?this.m:(this.m=e,this.__kb_destroyed||this.update())},e.prototype.update=function(e){var i,o;this.m&&!arguments.length&&(e=this.m.get(h.utils.unwrapObservable(this.key))),e||(e=null),i=c.utils.valueType(e);if(!this.__kb_value||this.__kb_value.__kb_destroyed||this.__kb_value.__kb_null&&e)this.__kb_value=null,this.value_type=void 0;o=this.__kb_value;if(m.isUndefined(this.value_type)||this.value_type!==i&&i!==s)return this.value_type===n&&i===t?o(e):this._updateValueObservable(e);if(this.value_type===r){if(typeof o.model=="function"){if(o.model()!==e)return o.model(e)}else if(c.utils.wrappedObject(o)!==e)return this._updateValueObservable(e)}else if(this.value_type===n){if(o.collection()!==e)return o.collection(e)}else if(o()!==e)return o(e)},e.prototype._updateValueObservable=function(e){var t,o,u,a;return t=this.create_options,t.creator=c.utils.inferCreator(e,t.factory,t.path,this.m,this.key),this.value_type=s,o=t.creator,u=this.__kb_value,this.__kb_value=null,u&&c.release(u),o?t.store?a=t.store.findOrCreate(e,t):o.models_only?(a=e,this.value_type=i):o.create?a=o.create(e,t):a=new o(e,t):(this.value_type=i,m.isArray(e)?a=h.observableArray(e):a=h.observable(e)),this.value_type===s&&(h.isObservable(a)?a.__kb_is_co?this.value_type=n:this.value_type=i:(this.value_type=r,typeof a.model!="function"&&c.utils.wrappedObject(a,e))),this.__kb_value=a,this.vo(a)},e}(),c.observable=function(e,t,n){return new c.Observable(e,t,n)},c.TriggeredObservable=function(){function e(e,t){var n,r=this;return this.event_name=t,e||d(this,"model"),this.event_name||d(this,"event_name"),this.vo=h.observable(),n=c.utils.wrappedObservable(this,h.dependentObservable(function(){return r.vo()})),n.destroy=m.bind(this.destroy,this),c.utils.wrappedModelWatcher(this,new c.ModelWatcher(e,this,{model:m.bind(this.model,this),update:m.bind(this.update,this),event_name:this.event_name})),n}return e.prototype.destroy=function(){return c.utils.wrappedDestroy(this)},e.prototype.model=function(e){if(arguments.length===0||this.m===e)return this.m;if(this.m=e)return this.update()},e.prototype.update=function(){if(!this.m)return;return this.vo()!==this.m?this.vo(this.m):this.vo.valueHasMutated()},e}(),c.triggeredObservable=function(e,t){return new c.TriggeredObservable(e,t)},c.ViewModel=function(){function t(t,n,r){var i,s,o,u,a,f,h,p;!t||t instanceof e.Model||typeof t.get=="function"&&typeof t.bind=="function"||v(this,"not a model"),n||(n={}),r||(r={}),m.isArray(n)?n={keys:n}:n=l(n),this.__kb||(this.__kb={}),this.__kb.vm_keys={},this.__kb.model_keys={},this.__kb.view_model=m.isUndefined(r)?this:r,!n.internals||(this.__kb.internals=n.internals),!n.excludes||(this.__kb.excludes=n.excludes),c.Store.useOptionsOrCreate(n,t,this),this.__kb.path=n.path,c.Factory.useOptionsOrCreate(n,this,n.path),f=c.utils.wrappedModelWatcher(this,new c.ModelWatcher(t,this,{model:m.bind(this.model,this)})),n.requires&&m.isArray(n.requires)&&(o=m.clone(n.requires)),this.__kb.internals&&(o=o?m.union(o,this.__kb.internals):m.clone(this.__kb.internals));if(n.keys)if(m.isArray(n.keys))this.__kb.keys=n.keys,o=o?m.union(o,n.keys):m.clone(n.keys);else{u={},p=n.keys;for(h in p)a=p[h],u[m.isString(a)?a:a.key?a.key:h]=!0;this.__kb.keys=m.keys(u)}else s=f.model(),s&&s.attributes&&(i=m.keys(s.attributes),o=o?m.union(o,i):i);o&&this.__kb.excludes&&(o=m.difference(o,this.__kb.excludes)),m.isObject(n.keys)&&!m.isArray(n.keys)&&this._mapObservables(t,n.keys),m.isObject(n.requires)&&!m.isArray(n.requires)&&this._mapObservables(t,n.requires),!n.mappings||this._mapObservables(t,n.mappings),!o||this._createObservables(t,o),!c.statistics||c.statistics.register("ViewModel",this)}return t.extend=e.Model.extend,t.prototype.destroy=function(){var e;if(this.__kb.view_model!==this)for(e in this.__kb.vm_keys)this.__kb.view_model[e]=null;return this.__kb.view_model=null,c.releaseKeys(this),c.utils.wrappedDestroy(this),!c.statistics||c.statistics.unregister("ViewModel",this)},t.prototype.shareOptions=function(){return{store:c.utils.wrappedStore(this),factory:c.utils.wrappedFactory(this)}},t.prototype.model=function(e){var t,n,r;n=c.utils.wrappedObject(this);if(arguments.length===0||n===e)return n;if(this.__kb_null){!e||v(this,"model set on shared null");return}c.utils.wrappedObject(this,e),r=c.utils.wrappedModelWatcher(this);if(!r)return;r.model(e);if(this.__kb.keys||!e||!e.attributes)return;t=m.difference(m.keys(e.attributes),m.keys(this.__kb.model_keys));if(t)return this._createObservables(e,t)},t.prototype.setToDefault=function(){var e,t;for(e in this.__kb.vm_keys)(t=this[e])!=null&&typeof t.setToDefault=="function"&&t.setToDefault();return this},t.prototype._createObservables=function(e,t){var n,r,i,s,o;n={store:c.utils.wrappedStore(this),factory:c.utils.wrappedFactory(this),path:this.__kb.path,model_watcher:c.utils.wrappedModelWatcher(this)};for(s=0,o=t.length;s<o;s++){r=t[s],i=this.__kb.internals&&m.contains(this.__kb.internals,r)?"_"+r:r;if(this[i])continue;this.__kb.vm_keys[i]=!0,this.__kb.model_keys[r]=!0,n.key=r,this[i]=this.__kb.view_model[i]=c.observable(e,n,this)}return this},t.prototype._mapObservables=function(e,t){var n,r,i;n={store:c.utils.wrappedStore(this),factory:c.utils.wrappedFactory(this),path:this.__kb.path,model_watcher:c.utils.wrappedModelWatcher(this)};for(i in t){r=t[i];if(this[i])continue;r=m.isString(r)?{key:r}:m.clone(r),r.key||(r.key=i),this.__kb.vm_keys[i]=!0,this.__kb.model_keys[r.key]=!0,this[i]=this.__kb.view_model[i]=c.observable(e,m.defaults(r,n),this)}return this},t}(),c.viewModel=function(e,t,n){return new c.ViewModel(e,t,n)},c.observables=function(e,t,n){return p("ko.observables","0.16.0","Please use kb.viewModel instead"),new c.ViewModel(e,t,n)}}).call(this);